$.jGrowl.defaults.position="center";$.jGrowl.defaults.theme="jgrowlblack";var tipologiaGift={virtual:0,code:1},tipologiaCart={cart:0,wishlist:1,comparator:2},tipologiaCartMain={cart:0,cartcustom:1},tipologiaWishlistMain={wishlist:0,wishlistcustom:1},tipologiaRmaMain={rma:0,rmacustom:1},tipoStepGACheckout={init:0,shipping:1,payment:2,confirm:3},tipologiaCheckout={StepAccordion:0,SenzaStep:1,SenzaStepAffiancato:2,StepAccordionOrizzontale:3},tipologiaRefresh={catalog:0,cart:1,minicart:2,popularity:3,orders:4,checkout:5,cms:6,giftselection:7,checkoutOnePage:8,sitesearch:9,cmsdetail:10,catalogsearch:11},tipologiaForm={generic:0,userRegistration:1,userProfile:2,contact:3,login:4,changePassword:5,searchCatalog:6,search:7,mailchimpSubscribe:8,logout:9},__carouselState={},Site=function(){var o=function(){},ti,b,hi,dt,ei,nt,u,p,d,ii,r,ci,vt,oi,at,ot,ut,ri,ct,rt,ft,l,st,g,yt,h,lt,w,et,a,k,ht,si,pt,wt,tt,y,v,t,ui,bt,kt,e,it,fi,gt,ni,li;return o.updateHash=!1,o.lastHash=null,o.hashElements=[],o.lasthashElements=[],o.update=function(n){if(n!=null&&n.length>0){var r=n[0],e=t.getParamsId($(r).attr("id")).id,i=o.getIdentifier($(r),e),u=o.hashElements["p"+i]!=null?o.hashElements["p"+i]:1,f=o.hashElements["o"+i]!=null?o.hashElements["o"+i]:0,s=o.lasthashElements["p"+i]!=null?o.lasthashElements["p"+i]:1,h=o.lasthashElements["o"+i]!=null?o.lasthashElements["o"+i]:0;n.splice(0,1);(o.lasthashElements["p"+i]!=null||$(r).hasClass("jsloadpage"))&&u==s&&f==h?o.update(n):o.changePage($(r),u,f,null,function(){o.update(n)})}else o.updateHash=!1,o.lastHash=history.pushState?location.search:location.hash},o.check=function(){if(o.updateHash)o.updateHash=!1,o.lastHash=history.pushState?location.search:location.hash;else{o.hashElements=history.pushState?o.getQueryStringParams(location.search):o.getHashParams(location.hash);o.lasthashElements=history.pushState?o.getQueryStringParams(o.lastHash):o.getHashParams(o.lastHash);var n=[];$(".jspagination").each(function(t,i){n.push(i)});o.update(n)}},o.getHashParams=function(n){var u={},i,r,t;if(n!=null&&(i=n.replace(/.*?\#/,""),i.length)){r=i.split("&");for(pairNum in r)t=r[pairNum].split("="),t.length==2&&(u[t[0]]=t[1])}return u},o.getQueryStringParams=function(n){var u={},r,t,i,f;if(n!=null&&$.trim(n)!="")for(n.startsWith("?")&&(n=n.substring(1)),r=n.split("&"),i=0,f=r.length;i<f;i++)t=r[i].split("="),$.trim(t[0])!=""&&t[0]!="pwbapp"&&(u[t[0]]=t[1]);return u},o.changePage=function(n,i,r,u,f){var s;if(i!=0){u==undefined&&(u={});var c=t.getParamsId($(n).attr("id")).id,h=o.getIdentifier(n,c),l=o.getQueryStringParams(location.search);l["p"+h]=i;l["o"+h]=r;s=history.pushState?o.getQueryStringParams(location.search):o.getHashParams(location.hash);(i!=1||i==1&&s["p"+h]!=null)&&(s["p"+h]=i);(r!=0||r==0&&s["o"+h]!=null)&&(s["o"+h]=r);Object.keys(s).length>0&&(history.pushState?("?"+$.param(s)!=location.search&&history.pushState(s,null,"?"+$.param(s)),o.lastHash=location.search):(o.updateHash=!0,window.location.hash=$.param(s)));$(n).hasClass("jspagination")&&u.showMore!=1&&$(n).find("[name=goto_"+c+"]").length>0&&t.scrollTo($($(n).find("[name=goto_"+c+"]")).offset().top);e.refreshComponent(n,$.extend(l,u),null,f)}},o.getShowMorePage=function(n,t){var r=parseInt(n.find(".showmorecells").data("numberpageshowmore"),10),i=r+1;return i>t?0:i},o.lazyLoading=function(){$(".paginationlazy").each(function(){$(this).height()-$(this).offset().top<=$(window).scrollTop()+$(window).height()&&$(this).parent().find(".showMoreResponsiveContainer").is(":visible")&&!$(this).hasClass("paginationprogress")&&($(this).addClass("paginationprogress"),$(this).parent().find(".showMoreResponsive").click())})},o.getIdentifier=function(n,t){return n.data("identifier")==undefined||n.data("identifier")==null?t:n.data("identifier")},o.registerHandlers=function(){try{if(history.pushState)$(window).on("popstate",o.check);else $(window).hashchange(o.check)}catch(n){}$(document).off("scroll",o.lazyLoading);$(document).on("scroll",o.lazyLoading)},o.changeElementForPage=function(n,i){var h=t.getParamsId($(i).attr("id")).id,u=o.getIdentifier(i,h),f=o.getQueryStringParams(location.search),s,r;f["p"+u]=1;f["ep"+u]=n;$("#"+$(i).attr("id")).find('[data-action="elementforpageCatalog"]').length>0&&(s=$("#"+$(i).attr("id")).find('[data-action="elementforpageCatalog"]'),f.q=$(s).data("search-text"));r=history.pushState?o.getQueryStringParams(location.search):o.getHashParams(location.hash);r["p"+u]!=null&&(r["p"+u]=1);Object.keys(r).length>0&&(history.pushState?("?"+$.param(r)!=location.search&&history.pushState(r,null,"?"+$.param(r)),o.lastHash=location.search):(o.updateHash=!0,window.location.hash=$.param(r)));e.refreshComponent(i,f,null,null)},o.filter=function(n){var r=!1,i=history.pushState?o.getQueryStringParams(location.search):o.getHashParams(location.hash);for(c=0;c<n.length;c++)$("."+n[c]).each(function(){var u=t.getParamsId($(this).attr("id")).id,n=o.getIdentifier($(this),u);i["p"+n]!=null&&(r=!0,i["p"+n]=1)});r&&(history.pushState?("?"+$.param(i)!=location.search&&history.pushState(i,null,"?"+$.param(i)),o.lastHash=location.search):(o.updateHash=!0,window.location.hash=$.param(i)))},o.getElementValue=function(n){var t=history.pushState?o.getQueryStringParams(location.search):o.getHashParams;return t[n]},ti=function(){},ti.init=function(){_isResponsive||setTimeout(function(){$(".accordionComp-accordion").accordion({heightStyle:"content"});$(".accordionComp-accordion").accordion("refresh")},150)},b=function(){},b.addAddress=function(n){var i=$(n).closest(".useraddressbookComp").attr("id");$("#"+i+" .addresses-panel").find("li").length==0?$("#"+i+" #divaddress-contact").hide():$("#"+i+" #divaddress-contact").show();$("#"+i+" #address-id").val(0);$("#"+i+" .edit-form").show();$("#"+i+" #address-add-legend").show();$("#"+i+" #address-edit-legend").hide();$("#"+i+" #address-add-submit").show();$("#"+i+" #address-edit-submit").hide();$("#"+i+" .edit-form input[type=text]").val("");_isResponsive&&$(document).width()<768&&t.scrollTo($("#"+i+" .edit-form").first().offset().top);b.formatCAP($("#"+i+" #address-state").val(),$("#"+i+" #address-postalCode"))},b.getParamsId=function(n){var t=/^address_([0-9]+)$/.exec(n);return t!=null?{htmlId:t[0],id:t[1]}:null},b.editAddress=function(n){var r=b.getParamsId($(n).parents("li").first().attr("id")).id,i=$(n).closest(".useraddressbookComp").attr("id");$("#"+i+" .edit-form").show();_isResponsive&&$(document).width()<768&&t.scrollTo($("#"+i+" .edit-form").first().offset().top);$.ajax({type:"POST",url:"/Async/AddressBook/Get",data:{_addressId:r},dataType:"json",error:t.onAsyncError,success:function(n){n.primario?$("#"+i+" #divaddress-contact").hide():$("#"+i+" #divaddress-contact").show();$("#"+i+" .edit-form").show();$("#"+i+" #address-id").val(r);$("#"+i+" #address-contact").length>0&&$("#"+i+" #address-contact").val(n.contact);$("#"+i+" #address-address").val(n.address);$("#"+i+" #address-city").val(n.city);$("#"+i+" #address-mail").length>0&&$("#"+i+" #address-mail").val(n.mail);$("#"+i+" #address-phone").length>0&&$("#"+i+" #address-phone").val(n.phone_number);$("#"+i+" #address-fax").length>0&&$("#"+i+" #address-fax").val(n.fax_number);$("#"+i+" #address-postalCode").val(n.postalCode);$("#"+i+' #address-state option[temp="1"]').remove();n.stateAddress!=null&&$("#"+i+' #address-state option[value="'+n.stateAddress.valore+'"]').length==0&&($("#"+i+" #address-state").append($("<option><\/option>").attr("value",n.stateAddress.valore).text(n.stateAddress.testo)),n.stateUsed||$("#"+i+' #address-state option[value="'+n.stateAddress.valore+'"]').attr("temp","1"));$("#"+i+' #address-state option[value="'+n.state+'"]').prop("selected",!0);b.getDistrict(n.state,n.province,$("#"+i+" #address-province"),!1);b.formatCAP(n.state,$("#"+i+" #address-postalCode"));$("#"+i+" #address-add-legend").hide();$("#"+i+" #address-edit-legend").show();$("#"+i+" #address-add-submit").hide();$("#"+i+" #address-edit-submit").show()}})},b.confirmAddress=function(n,i){var r=$(n).closest(".useraddressbookComp").attr("id");if(!$("#"+r+" #address-postalCode")[0].checkValidity())return!1;i.preventDefault();i.stopPropagation();i.stopImmediatePropagation();$("#"+r+" .edit-form").hide();$.ajax({type:"POST",url:"/Async/AddressBook/Confirm",data:{_componentId:t.getParamsId(r).id,_addressId:$("#"+r+" #address-id").val(),_contact:$("#"+r+" #address-contact").length>0?$("#"+r+" #address-contact").val():null,_address:$("#"+r+" #address-address").val(),_city:$("#"+r+" #address-city").val(),_postalCode:$("#"+r+" #address-postalCode").val(),_province:$("#"+r+" #address-province").val()!=null?$("#"+r+" #address-province").val():$("#"+r+" #address-province option:first").val(),_state:$("#"+r+" #address-state").val(),_mail:$("#"+r+" #address-mail").length>0?$("#"+r+" #address-mail").val():null,_phone:$("#"+r+" #address-phone").length>0?$("#"+r+" #address-phone").val():null,_fax:$("#"+r+" #address-fax").length>0?$("#"+r+" #address-fax").val():null},dataType:"json",error:t.onAsyncError,success:function(n){$("#"+r+" #err-address-address").html("");$("#"+r+" #err-address-city").html("");$("#"+r+" #err-address-postalCode").html("");n.esito?(Site.updaters.refreshComponent($("#"+r),null,null,null),n.isPrimario&&$(".userprofileComp").each(function(n,t){e.refreshComponent($(t),null,null,null)})):($("#"+r+" .edit-form").show(),$.each(n.campi,function(n,t){$("#"+r+" #err-address-"+n).html(t.errore);t.valore!=null&&$("#"+r+" #address-"+n).val(t.valore)}))}})},b.confirmCancelAddress=function(n,t){var i=$(n).closest(".useraddressbookComp").attr("id");$("#"+i+" #err-address-address").html("");$("#"+i+" #err-address-city").html("");$("#"+i+" #err-address-postalCode").html("");t.preventDefault();t.stopPropagation();t.stopImmediatePropagation();$("#"+i+" .edit-form").hide()},b.removeAddress=function(n){var i=$(n).closest(".useraddressbookComp").attr("id");$("#"+i+" .edit-form").hide();$.ajax({type:"POST",url:"/Async/AddressBook/Remove",data:{_addressId:t.getParamsId($(n).parents("li").first().attr("id")).id},dataType:"json",error:t.onAsyncError,success:function(n){n!=null&&Site.updaters.refreshComponent($("#"+i),null,null,null)}})},b.close=function(){},b.formatCAP=function(n,i){$.ajax({type:"POST",url:"/Async/AddressBook/GetFormatCAPByNationId",data:{_nation:n},dataType:"json",error:t.onAsyncError,success:function(n){parseInt($(i).attr("maxlength"),10)>parseInt(n.length,10)&&$(i).val().length>parseInt(n.length,10)&&$(i).val("");$(i).attr("maxlength",n.length);$(i).attr("pattern",n.regex);$(i).attr("title",n.example)}})},b.getDistrict=function(n,i,r,u){$.ajax({type:"POST",url:"/Async/AddressBook/GetDistrictByNationId",data:{_nation:n,_province:i,_selected:!1},dataType:"json",error:t.onAsyncError,success:function(n){var t,i;for($(r).find("option").remove(),u&&$(r).append($("<option><\/option>").attr("value","").text("")),t=0;t<n.length;t++)i=$("<option><\/option>").attr("value",n[t].entry_id).text(n[t].entry_text),n[t].entry_selected&&i.attr("selected","selected"),$(r).append(i)}})},b.handleAction=function(n){switch($(this).data("action")){case"addAddress":b.addAddress(this);break;case"editAddress":b.editAddress(this);break;case"confirmAddress":b.confirmAddress(this,n);break;case"removeAddress":b.removeAddress(this);break;case"confirmCancelAddress":b.confirmCancelAddress(this,n)}},b.registerHandlers=function(){$(document).on("click",".useraddressbookComp [data-action]",b.handleAction);$(document).on("change",".useraddressbookComp #address-state",function(){var n=$(this).val();b.formatCAP(n,$(this).closest(".useraddressbookComp").find("#address-postalCode"));b.getDistrict(n,"",$(this).closest(".useraddressbookComp").find("#address-province"),!1)})},hi=function(){},hi.registerHandlers=function(){$(document).on("submit",".ecAddressSwitcherComp-form",function(n){n.preventDefault();var t=!1;if($(this).find(".formfield_error").hide(),$(this).find(".requiredfield").each(function(){$(this).is(":visible")&&$.trim($(this).val())==""&&(t=!0,$("#"+$(this).attr("id")+"_error").show())}),t)return!1;l.submit($(this).attr("id"),$(this).data("class")+"_"+$(this).data("identifier"),$(this).data("identifier"),$(this).data("pageid"))});$(document).on("change",".ecAddressSwitcherComp #delivery-state",function(){var n=$(this).val();b.formatCAP(n,$(this).closest(".ecAddressSwitcherComp").find("#delivery-postalCode"));b.getDistrict(n,"",$(this).closest(".ecAddressSwitcherComp").find("#delivery-province"),!1)});$(document).on("change",".ecAddressSwitcherComp #delivery-address",function(){var n=$(this);$(n).val()!=""&&$.ajax({type:"POST",url:"/Async/AddressBook/Get",data:{_addressId:$(n).val()},dataType:"json",error:t.onAsyncError,success:function(t){var i=$(n).closest(".ecAddressSwitcherComp");$(i).find("#delivery-city").val(t.city);$(i).find("#delivery-postalCode").val(t.postalCode);$(i).find('#delivery-state option[value="'+t.state+'"]').prop("selected",!0);b.getDistrict(t.state,t.province,$(i).find("#delivery-province"),!1);b.formatCAP(t.state,$(i).find("#delivery-postalCode"))}})})},dt=function(){},dt.refreshPrice=function(n,i,r){if(n!=null&&n.length>0){var u=n[0],e=u.data("identifier"),o=t.getParamsId($("body").attr("id")).id,s=t.getParamsId(u.attr("id")).id,h=st.getOptions(e),c=a.getStructure(e,null),f=u.data("collector");t.addLoadingPanel(u);$.ajax({type:"POST",url:"/Async/RefreshPrice",data:{_collector:f,_article:u.data("productid"),_options:h,_componentId:s,_pageId:o,_structure:c,_indiceCella:u.data("indicecella"),_indicePromo:u.data("indicepromo"),_quantity:r},dataType:"json",async:!1,error:function(n,i,r){t.removeLoadingPanel(u);t.onAsyncError(n,i,r)},success:function(e){t.removeLoadingPanel(u);e.returnedCode=="success"&&u.replaceWith(e.data);n.splice(0,1);n.length>0?dt.refreshPrice(n,i,r):(f.indexOf("ecSetproductsbox")!=-1&&i&&a.updateInfoBox(f),$(".ecFieldpaymentComp").each(function(n,t){Site.updaters.refreshComponent($(t),null,null,null)}))}})}},ei=function(){},ei.refreshAvailability=function(n){if(n!=null&&n.length>0){var i=n[0],r=t.getParamsId($("body").attr("id")).id,u=t.getParamsId(i.attr("id")).id,f=i.data("collector");t.addLoadingPanel(i);$.ajax({type:"POST",url:"/Async/RefreshAvailability",data:{_collector:f,_article:i.data("productid"),_componentId:u,_pageId:r},dataType:"json",async:!1,error:function(n,r,u){t.removeLoadingPanel(i);t.onAsyncError(n,r,u)},success:function(r){t.removeLoadingPanel(i);r.returnedCode=="success"&&i.replaceWith(r.data);n.splice(0,1);n.length>0&&ei.refreshAvailability(n)}})}},nt=function(){},nt.changeQty=function(n,t,i,r,u,f){var c=0,h=0,o=1;u!=null&&(u=parseFloat(u),isNaN(u)&&(u=null));switch(i){case 0:o=u!=null?u:1;break;case 1:o=u!=null?u:1;break;case 4:o=u!=null?u:r==1?1:.1;h=1;break;case 5:o=u!=null?u:r==1?1:.01;h=2;break;case 6:o=u!=null?u:r==1?1:.001;h=3;break;case 7:o=u!=null?u:r==1?1:.0001;h=4;break;case 8:o=u!=null?u:r==1?1:1e-5;h=5;break;case 9:o=u!=null?u:r==1?1:1e-6;h=6}var l=$(n).val().replace(",","."),e=l==""?0:parseFloat(l),s=Math.pow(10,h);switch(t){case"up":e=e+o;e.toFixed(h)>999999999&&(e=999999999);o>1&&(e*s).toFixed(0)%(o*s).toFixed(0)!=0&&(e=Math.trunc((e*s).toFixed(0)/(o*s).toFixed(0))*(o*s).toFixed(0)/s);e=Number(e.toFixed(h))+"";e=e.replace(".",",");break;case"down":e=e-o;e.toFixed(h)<c&&(e=c);o>1&&(e*s).toFixed(0)%(o*s).toFixed(0)!=0&&(e=Math.trunc((e*s).toFixed(0)/(o*s).toFixed(0))*(o*s).toFixed(0)/s);e=Number(e.toFixed(h))+"";e=e.replace(".",",")}$(n).data("is-qty-cart-custom")?($("."+$(n).attr("id").split("_")[2]).each(function(n,t){$(t).val(e)}),f&&$(n).change()):$("."+$(n).attr("id")).each(function(n,t){$(t).val(e);f&&$(t).change()})},nt.handleAction=function(){switch($(this).data("action")){case"qtyminus":nt.changeQty($("#"+$(this).data("identifier-quantity")),"down",$(this).data("decimal"),$(this).data("step"),$(this).data("pack"),$(this).data("changevalue"));break;case"qtyplus":nt.changeQty($("#"+$(this).data("identifier-quantity")),"up",$(this).data("decimal"),$(this).data("step"),$(this).data("pack"),$(this).data("changevalue"));break;case"changeimageselect":nt.changeSizeImage($(this).attr("id"),$(this).data("identifiercontrol"),$("#"+$(this).attr("id")+" option:selected").attr("img"),$("#"+$(this).attr("id")+" option:selected").attr("imgzoom"),$("#"+$(this).attr("id")+" option:selected").val());break;case"changeimagelabel":return Site.product.changeImage($(this).attr("img"),$(this).attr("imgzoom")),Site.imagegallery.change($(this).data("identifiercontrol")+"_size_"+$(this).data("identifier")),!1;case"addtocart":Site.cart.tryAddItem($(this).data("productid"),$(this).data("identifiercontrol"),$(this).data("has-size"),$(this).data("is-sizeminimal"),$(this).data("has-structure"),$(this).data("parentid"),$(this).data("has-box"),$(this).data("boxid"),$(this).data("has-options"),$(this).data("redirect"),$(this).data("animationcolor"),$(this).data("message"),$(this).data("timeoutmessage"),$(this).data("gestioneriga"),$(this).data("autocomplete"),$(this).data("promotion"),$(this).data("carid"),$(this).data("rowid"));break;case"paypalexpress":Site.reservation.gotoPayPalCheckoutExpress($(this).data("productid"))}},nt.ddslickSelection=function(n){nt.changeSizeImage(n.original.attr("id"),n.original.data("identifiercontrol"),n.selectedData.img,n.selectedData.imgzoom,n.selectedData.value)},nt.changeSizeImage=function(n,t,i,r,u){var f=$("#"+n);return i==undefined&&(i=$(f.parents('.ecFieldaddtocartComp[data-has-selectedimage="true"]').first()).data("selectedimage"),r=$(f.parents('.ecFieldaddtocartComp[data-has-selectedimage="true"]').first()).data("selectedimagezoom")),Site.product.changeImage(i,r,t),Site.imagegallery.change(t+"_size_"+u),!1},nt.registerHandlers=function(){$(document).on("click",".ecFieldaddtocartComp [data-action]:not(select)",nt.handleAction);$(document).on("click",".ecFieldautocompleteComp [data-action]",nt.handleAction);$(document).on("change",".ecFieldaddtocartComp [data-action]",nt.handleAction);$(document).on("click",".ecFieldquantityComp [data-action]",nt.handleAction);$(document).on("change",".ecFieldaddtocartComp .quantity",function(){var n=$(this).closest(".ecFieldaddtocartComp"),t,i;if(n.length>0){t=$(n).data("identifierid");a.checkQuantity(this,n,t);var r=[],u=$(".cellid_"+t).hasClass("ecProductComp")?".changeprimarypricequantityproduct":".changeprimarypricequantity",f=null,e=$(n).closest(".ecQuickViewComp");f=e.length>0?$(e).find(u+":visible"):$(".cellid_"+t+" "+u+":visible");f.each(function(){r.push($(this).closest(".ecFieldpriceComp"))});i=0;$(n).find("input[name^='"+t+"_quantity']").each(function(){i+=parseFloat($(this).val())});setTimeout(function(){dt.refreshPrice(r,!1,i)},100)}})},nt.init=function(){$(".ecFieldaddtocartComp .quantity").each(function(n,t){$(t).limitkeypress({numberRexp:$(t).attr("data-regexnumber"),stepType:$(t).attr("data-step"),stepPack:$(t).attr("data-pack"),change:$(t).attr("data-changevalue")})});$('.ecFieldaddtocartComp[data-has-selectedimage="true"]:visible').each(function(n,t){Site.product.changeImage($(t).data("selectedimage"),$(t).data("selectedimagezoom"))});$('.ecFieldaddtocartComp[data-has-size="true"]:visible').each(function(n,t){Site.imagegallery.change($(t).data("size-identifier"))})},u=function(){},u.isUpdated=0,u.stores_map=null,u.stores_markers=[],u.stores_infowindow=null,u.stores_bounds=null,u.accordionStates=[],u.addItemFromWishlist=function(n,i,r,f){$.ajax({type:"POST",url:"/Async/WishList/AddWishlistItemToCart",data:{_wishlist:n,_wishlistItem:i,_tipologia:f},dataType:"html",error:t.onAsyncError,success:function(n){if(n!=null){var t=$.parseJSON(n);t.errore?t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio):(e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],f),null,!0,u.collectAccordionsState(),null),t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio),TrackerPW.TP.productToCart(t,f))}}})},u.tryAddItem=function(n,t,i,r,f,e,o,s,h,c,l,v,y,p,w,b,k,d){var g=a.qtaArticle(t,i,r,f,o,h,l,!0);g.success&&u.addItem(n,g.quantity,g.size,g.structure,e,g.options,g.articles,s,t,tipologiaCart.cart,c,v,y,p,w,b,null,k,d)},u.addItem=function(n,i,r,f,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){if(i!=null&&i!=""&&i!=0||r==null){(i==null||i=="")&&(i=1);var rt=!1,it=null,tt=null;switch(a){case tipologiaCart.cart:it="ecMinicartComp";tt="cart";break;case tipologiaCart.wishlist:it="ecMiniwishlistComp";tt="wishlist";break;case tipologiaCart.comparator:it="ecMinicomparatorComp";tt="comparator"}$.ajax({type:"POST",url:"/Async/Cart/Add",data:{_id:n,_quantity:i,_size:JSON.stringify(r),_structure:f,_idPadreStruttura:o,_options:s,_articles:JSON.stringify(h),_boxId:c,_tipologia:a,_gestioneRiga:w,_promotion:k,_wishlist:d,_carid:g,_rowid:nt},dataType:"json",error:t.onAsyncError,success:function(t){if(t!=null)if(t.errore)t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio);else{a==tipologiaCart.cart?$(".cell_"+n).addClass("incart"):a==tipologiaCart.wishlist&&d!=null&&$.inArray("0",d)!=-1&&$(".cell_"+n).addClass("inwishlist");var i=b?[tipologiaRefresh.minicart,tipologiaRefresh.giftselection]:[tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection,tipologiaRefresh.checkout];a==tipologiaCart.cart&&i.push(tipologiaRefresh.popularity);b?e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],a),null,!1,function(){$("#"+l+"_"+tt+" input").focus();e.collectListComponent(e.collectClassesComponent(i,a),null,!1,u.collectAccordionsState(),null)}):e.collectListComponent(e.collectClassesComponent(i,a),null,!0,u.collectAccordionsState(),null);(a!=tipologiaCart.cart||t.qtaOk)&&rt?v!=null&&setTimeout(function(){window.location.href="/"+v},1e3):(y&&t.messaggio!=null&&t.messaggio!=""&&(p!=null?$.jGrowl(t.messaggio,{life:p}):$.jGrowl(t.messaggio,{sticky:!0})),v!=null&&setTimeout(function(){window.location.href="/"+v},1e3));t.qtaOk&&a==tipologiaCart.cart&&$("[data-initqty]").each(function(){$(this).val($(this).data("initqty"))});TrackerPW.TP.productToCart(t,a)}}})}},u.addProduct=function(n,i,r,f,o,s,h){$.ajax({type:"POST",url:"/Async/Cart/AddProduct",data:{_code:n,_quantity:i,_size:r,_discount:f,_price:o,_checkUserLogged:h!=undefined?h:null},dataType:"json",error:t.onAsyncError,success:function(n){if(n!=null){if(n.errore)n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio);else{var t=[tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection,tipologiaRefresh.popularity];e.collectListComponent(e.collectClassesComponent(t,tipologiaCart.cart),null,!0,u.collectAccordionsState(),null);n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio,{sticky:!0});n.qtaOk&&TrackerPW.TP.productToCart(n,tipologiaCart.cart)}s!=undefined&&s&&typeof s=="function"&&s(n)}}})},u.addItemFromMatrice=function(n,i){$.ajax({type:"POST",url:"/Async/Matrice/AddItemToCartFromMatrice",data:{_idRigaOrdine:n,_tipologia:i},dataType:"html",error:t.onAsyncError,success:function(n){if(n!=null){var t=$.parseJSON(n);t.errore?t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio):(e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],i),null,!0,u.collectAccordionsState(),null),t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio),TrackerPW.TP.productToCart(t,i))}}})},u.addWholeWishlist=function(n,i,r){$.ajax({type:"POST",url:"/Async/WishList/AddWishlistToCart",data:{_wishlist:n,_tipologia:i,_removeAfterAddToCart:r},dataType:"json",error:t.onAsyncError,success:function(n){n.products.length>0&&TrackerPW.TP.productToCart(n,i);n.errore||n.redirect==null?n.messaggio!=null&&n.messaggio!=""&&(e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],i),null,!0,u.collectAccordionsState(),null),$.jGrowl(n.messaggio)):window.location.href="/"+n.redirect}})},u.removeItem=function(n){n!=0&&$.ajax({type:"POST",url:"/Async/Cart/Remove",data:{_id:n,_tipologia:tipologiaCart.cart},error:t.onAsyncError,dataType:"json",success:function(n){n!=null&&(n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio),TrackerPW.TP.productToCart(n,tipologiaCart.cart),n.rimosso&&$(".cell_"+n.articolo).removeClass("incart"));e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection,tipologiaRefresh.popularity,tipologiaRefresh.checkout],tipologiaCart.cart),{cartremove:!0},!0,u.collectAccordionsState(),null)}})},u.changeItemQty=function(n,i,r,f,o,s,h,c,l){i==""&&(i=1);$.ajax({type:"POST",url:"/Async/Cart/ChangeQuantity",data:{_id:n,_quantity:i,_size:JSON.stringify(r),_note:f,_discount:o,_price:s,_expiry:h,_updatecart:c},dataType:"json",async:!1,error:t.onAsyncError,success:function(n){n!=null&&(n.messaggio!=null&&n.messaggio!=""&&(n.errore&&$.jGrowl(n.messaggio),u.isUpdated++),c&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],tipologiaCart.cart),null,l,u.collectAccordionsState(),null),TrackerPW.TP.productToCart(n,tipologiaCart.cart))}})},u.empty=function(n,i,r){$.ajax({type:"POST",url:"/Async/Cart/EmptyCart",data:{_tipologia:n,_id:i},dataType:"json",error:t.onAsyncError,success:function(t){t!=null&&(t.messaggio!=null&&t.messaggio!=""&&$.jGrowl(t.messaggio),TrackerPW.TP.productToCart(t,tipologiaCart.cart));n==tipologiaCart.cart?$(".incart").removeClass("incart"):n==tipologiaCart.wishlist&&r&&$(".inwishlist").removeClass("inwishlist");var i=[tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection];n==tipologiaCart.cart&&i.push(tipologiaRefresh.popularity);e.collectListComponent(e.collectClassesComponent(i,n),null,!0,u.collectAccordionsState(),null)}})},u.update=function(n,t,i,r,f){if(u.isUpdated=$("#"+r+"_"+n).find(".blockedError:visible").length>0?$("#"+r+"_"+n).find(".blockedError:visible").length:0,!f||f&&$("#"+r+"_"+n).hasClass("modified")){var o=$("#"+r+"_"+n+" ."+r+"Comp-cartTableRow.editable:visible").length,e=0;$("#"+r+"_"+n+" ."+r+"Comp-cartTableRow.editable:visible").each(function(n,r){e++;u.updateRow(r,t?e==o:!1,t?e==o:!1,i)});$("#"+r+"_"+n).removeClass("modified")}},u.updateRow=function(n,t,i,r){var h="",c=null,l=null,a="",f=null,e=$(n).attr("id"),o,s;r==tipologiaCartMain.cart?(f=$(n).next(".ecCartComp-cartTableRowAgente").find(".ecCartComp-cartNoteCol"),f.length>0&&(h=f.children("textarea").val()),f=$(n).next(".ecCartComp-cartTableRowAgente").find(".ecCartComp-cartPriceCol"),f.length>0&&(c=$.trim(f.children("input[type=text]").val())),f=$(n).next(".ecCartComp-cartTableRowAgente").find(".ecCartComp-cartDiscountCol"),f.length>0&&(l=$.trim(f.children("input[type=text]").val())),f=$(n).next(".ecCartComp-cartTableRowAgente").find(".ecCartComp-cartScadenzaCol"),f.length>0&&(a=$.trim(f.children("input[type=text]").val()))):(f=$(n).find("[name=nota-"+e+"]:visible"),f.length>0&&($(f).attr("placeholdervalue")==null||$(f).attr("placeholdervalue")!=null&&$(f).attr("placeholdervalue")!=f.val())&&(h=f.val()),f=$(n).find("[name=prezzo-"+e+"]:visible"),f.length>0&&($(f).attr("placeholdervalue")==null||$(f).attr("placeholdervalue")!=null&&$(f).attr("placeholdervalue")!=f.val())&&(c=$.trim(f.val())),f=$(n).find("[name=sconto-"+e+"]:visible"),f.length>0&&($(f).attr("placeholdervalue")==null||$(f).attr("placeholdervalue")!=null&&$(f).attr("placeholdervalue")!=f.val())&&(l=$.trim(f.val())),f=$(n).find("[name=dataScadenza-"+e+"]:visible"),f.length>0&&(a=$.trim(f.val())));o=[];s=0;$(n).find(".rowQty:visible").each(function(n,t){var i=$(t).val();(i==null||i=="")&&(i=1);$(t).hasClass("rowQtySize")?(s+=parseInt(i),o.push([u.getParamsSize($(t).attr("id")).sizeId,i])):(s=i,o=null)});u.changeItemQty(e,s,o,h,l,c,a,t,i)},u.updateAgentRow=function(n){var t=_isResponsive?$(n).parents(".Comp-cartTableRowAgente").first().prev():$(n).parent().parent().parent().parent().parent().parent().prev();u.updateRow(t,!0,!1,0)},u.getShippingModes=function(n,r){var f=!1;if($("."+n+"Comp-containerShippingQuote .formfield_error").hide(),$("."+n+"Comp-containerShippingQuote .requiredfield").each(function(){$(this).is(":visible")&&$.trim($(this).val())==""&&(f=!0,$("#"+$(this).attr("id")+"_error").show())}),f)return!1;if(!$("#capShippingQuote")[0].checkValidity())return $("#capShippingQuote")[0].reportValidity(),!1;r==null&&(r=!1);$.ajax({type:"POST",url:"/Async/Cart/GetShippingQuote",data:{_country:$("#countryShippingQuote option:selected").val(),_region:$("#regionShippingQuote").val(),_cap:$("#capShippingQuote").val(),_classComponent:n,_showGoogleMap:r,_isMobile:!1},dataType:"json",error:t.onAsyncError,success:function(f){if(f!="")if($("#"+n+"Comp-itemsShippingQuote").children().remove(),$("."+n+"Comp-itemsErrorShippingQuote").html(""),f[1]==""){$("."+n+"Comp-itemsErrorShippingQuote").hide();var e=0;for(i=0;i<f[0].spedizioni.length;i++)$(f[0].spedizioni[i].template_list).appendTo("#"+n+"Comp-itemsShippingQuote"),f[0].spedizioni[i].selected&&(e=i);if(f[0].spedizioni.length==0?($("."+n+"Comp-resultShippingQuote").hide(),$("."+n+"Comp-linkUpdateTotalShippingQuote").hide()):($("."+n+"Comp-resultShippingQuote").show(),$("."+n+"Comp-linkUpdateTotalShippingQuote").show()),f[0].spedizioni.length>0){u.addHadlerEventListStores(n);$(document).on("click","."+n+"Comp-itemShippingQuote input[type=radio]",function(){$(this).parents("li").hasClass("selectedShipping")||($("."+n+"Comp-itemShippingQuote").removeClass("selectedShipping"),$(this).parents("li").addClass("selectedShipping"),$("."+n+"Comp-ShippingChargesQuote").hide("slow"),$(this).parent().find("."+n+"Comp-ShippingChargesQuote").show("slow"),$("."+n+"Comp-ShippingStoresQuote").hide("slow"),$(this).parent().find("."+n+"Comp-ShippingStoresQuote").show("slow"),$(this).parent().data("shipping-pickup")&&($("#regionShippingQuote").val()!=""&&$(this).parent().find(".regionStore option[value="+$("#regionShippingQuote").val()+"]").length>0?$(this).parent().find(".regionStore").val($("#regionShippingQuote").val()).trigger("change"):$(this).parent().find(".regionStore").val()!=""?$(this).parent().find(".regionStore").val($(this).parent().find(".regionStore").val()).trigger("change"):$(this).parent().find(".regionStore").val("").trigger("change")))});$("."+n+"Comp-itemShippingQuote").on("change",".regionStore",function(){$.ajax({type:"POST",url:"/Async/Cart/SearchStore",data:{_shipping:$("#"+n+"Comp-itemsShippingQuote input:radio:checked").val()!=null?$("#"+n+"Comp-itemsShippingQuote input:radio:checked").val():null,_country:$(this).attr("data-nation"),_region:$("#regionShippingQuote").length>0&&$("#regionShippingQuote").val()!=""?$("#regionShippingQuote").val():null,_regionStore:$(this).val(),_classComponent:n,_showGoogleMap:r,_isMobile:!1,_localita:"",_cap:""},dataType:"json",error:t.onAsyncError,success:function(t){$("."+n+"Comp-itemsShippingStoresQuote").html("");$("."+n+"Comp-itemsShippingStoresQuote").html(t[1]);u.addHadlerEventListStores(n);r.toLowerCase()=="true"?setTimeout(function(){google.maps.event.addDomListener(window,"resize",u.addGoogleMapStores(n));google.maps.event.addDomListener(window,"load",u.addGoogleMapStores(n))},600):$("."+n+"Comp-itemShippingStores").each(function(n,t){$(t).find(".store_description").show()});$("."+n+"Comp-ShippingStoresQuote ."+n+"Comp-itemShippingStores.selectedStore").length>0&&$($("."+n+"Comp-ShippingStoresQuote ."+n+"Comp-itemShippingStores.selectedStore")[0]).find(".store_selection").click()}})});$('input[name="shippingQuote"]')[e].checked=!0;$('input[name="shippingQuote"]')[e].click()}}else $("."+n+"Comp-resultShippingQuote").show(),$("."+n+"Comp-linkUpdateTotalShippingQuote").hide(),$("."+n+"Comp-itemsErrorShippingQuote").html(f[1]),$("."+n+"Comp-itemsErrorShippingQuote").show()}})},u.resetShippingModes=function(n){$("."+n+"Comp-resultShippingQuote").hide("slow");$("."+n+"Comp-linkUpdateTotalShippingQuote").hide("slow");$("#"+n+"Comp-itemsShippingQuote").children().remove();$("."+n+"Comp-itemsErrorShippingQuote").html("")},u.addHadlerEventListStores=function(n){$(document).on("click","."+n+"Comp-itemShippingStores",function(){var t=$(this).attr("data-marker-index");$("."+n+"Comp-itemShippingStores").removeClass("activeStore");$(this).addClass("activeStore");u.stores_map!=null&&google.maps.event.trigger(u.stores_markers[t],"click",{})});$(document).on("click","."+n+"Comp-itemShippingStores .store_selection",function(){var t=$(this).closest("."+n+"Comp-itemShippingStores").attr("data-marker-index");$("."+n+"Comp-itemShippingStores").removeClass("selectedStore");$("."+n+"Comp-itemShippingStores[data-marker-index="+t+"]").addClass("selectedStore");$("."+n+"Comp-itemsErrorShipping").html("");$("."+n+"Comp-itemsErrorShipping").hide()})},u.addGoogleMapStores=function(n){var t,i;for(u.stores_map=new google.maps.Map(document.getElementById("cart_store_map"),{disableDoubleClickZoom:!0,scrollwheel:!1,panControl:!1,rotateControl:!1,zoom:10}),u.stores_markers=[],u.stores_markers.length=0,$("."+n+"Comp-itemShippingStores").each(function(t,i){var r,f,e;$(i).find(".store_description").hide();r=new google.maps.Marker;$(i).data("latitude")==""&&$(i).data("store-code")==0?(f=new google.maps.Geocoder,f.geocode({address:$(i).data("address")},function(n,t){t==google.maps.GeocoderStatus.OK&&t!=google.maps.GeocoderStatus.ZERO_RESULTS?(u.stores_map.setCenter(n[0].geometry.location),u.stores_map.fitBounds(n[0].geometry.viewport)):u.stores_map.setCenter(new google.maps.LatLng(41.87194,12.56738))})):$(i).data("latitude")==""&&$(i).data("store-code")!=0?(f=new google.maps.Geocoder,f.geocode({address:$(i).data("address")},function(t,f){if(f==google.maps.GeocoderStatus.OK&&f!=google.maps.GeocoderStatus.ZERO_RESULTS){var e=new google.maps.LatLng(t[0].geometry.location.lat,t[0].geometry.location.lng);r.setMap(u.stores_map);r.setPosition(e);r.setLabel($(i).data("marker-index")+1+"");u.stores_markers.push(r);r.info=new google.maps.InfoWindow({content:$(i).find(".store_description").html()!=""?$(i).find(".store_description").html():$(i).find(".store_name").html()});google.maps.event.addListener(r,"click",function(){var i=r.info.getMap(),t,f;if(!(i!==null&&typeof i!="undefined"))for(u.stores_infowindow&&u.stores_infowindow.close(),u.stores_infowindow=r.info,u.stores_infowindow.open(u.stores_map,r),t=0,f=u.stores_markers.length;t<f;t++)u.stores_markers[t]==r&&($("."+n+"Comp-itemShippingStores").removeClass("activeStore"),$("."+n+"Comp-itemShippingStores").eq(t).addClass("activeStore"),$("."+n+"Comp-resultsShippingStoresQuote").scrollTop($("."+n+"Comp-resultsShippingStoresQuote").scrollTop()+$("."+n+"Comp-itemShippingStores").eq(t).position().top-$("."+n+"Comp-itemShippingStores").parent().position().top-$("."+n+"Comp-resultsShippingStoresQuote").height()/2+$("."+n+"Comp-itemShippingStores").eq(t).height()/2))})}else console.log("Il Negozio con id: "+$(i).data("store-code")+" non trovato")})):$(i).data("latitude")!=""?(e=new google.maps.LatLng($(i).data("latitude"),$(i).data("longitude")),r.setMap(u.stores_map),r.setPosition(e),r.setLabel($(i).data("marker-index")+1+""),u.stores_markers.push(r),r.info=new google.maps.InfoWindow({content:$(i).find(".store_description").html()!=""?$(i).find(".store_description").html():$(i).find(".store_name").html()}),google.maps.event.addListener(r,"click",function(){var i=r.info.getMap(),t,f;if(!(i!==null&&typeof i!="undefined"))for(u.stores_infowindow&&u.stores_infowindow.close(),u.stores_infowindow=r.info,u.stores_infowindow.open(u.stores_map,r),t=0,f=u.stores_markers.length;t<f;t++)u.stores_markers[t]==r&&($("."+n+"Comp-itemShippingStores").removeClass("activeStore"),$("."+n+"Comp-itemShippingStores").eq(t).addClass("activeStore"),$("."+n+"Comp-resultsShippingStoresQuote").scrollTop($("."+n+"Comp-resultsShippingStoresQuote").scrollTop()+$("."+n+"Comp-itemShippingStores").eq(t).position().top-$("."+n+"Comp-itemShippingStores").parent().position().top-$("."+n+"Comp-resultsShippingStoresQuote").height()/2+$("."+n+"Comp-itemShippingStores").eq(t).height()/2))})):console.log("Il Negozio con id: "+$(i).data("store-code")+" ha dati mancanti")}),u.stores_bounds=new google.maps.LatLngBounds,t=0;t<u.stores_markers.length;t++)u.stores_bounds.extend(u.stores_markers[t].position),u.stores_map.fitBounds(u.stores_bounds);u.stores_map.setCenter(u.stores_bounds.getCenter());u.stores_map.setZoom(u.stores_map.getZoom()-1);i=google.maps.event.addListener(u.stores_map,"idle",function(){u.stores_map.getZoom()>12&&u.stores_map.setZoom(12);google.maps.event.trigger(u.stores_map,"resize");google.maps.event.removeListener(i)})},u.updateShippingModes=function(n){var i=$("#"+n+"Comp-itemsShippingQuote input:radio:checked").val()!=null?$("#"+n+"Comp-itemsShippingQuote input:radio:checked").val():null,f=[],r=null;if(i!=null&&($("#itemsShippingChargesQuote_"+i+" input[type='checkbox']").each(function(n,t){$(t).is(":checked")&&f.push($(t).val())}),$("#itemsShippingStores_"+i+" li").length>0&&($("#itemsShippingStores_"+i+" li.selectedStore").each(function(n,t){r=u.getParamsStore($(t).attr("id")).storeId}),r==null)))return $("."+n+"Comp-itemsErrorShippingQuote").html($("."+n+"Comp-itemsShippingQuote .selectedShipping").attr("data-error-message")),$("."+n+"Comp-itemsErrorShippingQuote").show(),!1;$.ajax({type:"POST",url:"/Async/Cart/UpdateShippingModes",data:{_shipping:i,_charges:JSON.stringify(f),_store:r,_country:$("#countryShippingQuote option:selected").val(),_region:$("#regionShippingQuote").val(),_cap:$("#capShippingQuote").val()},dataType:"json",error:t.onAsyncError,success:function(){$("#"+n+"Comp-itemsShippingQuote").children().remove();$("."+n+"Comp-itemsErrorShippingQuote").html("");e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)}})},u.collectAccordionsState=function(){return _isResponsive?(u.accordionStates=[],$(".ecCartCustomComp [data-toggle='collapse']").each(function(n,t){u.accordionStates.push({href:$(t).attr("href"),state:$(t).attr("aria-expanded")})}),u.accordionStates.length>0)?u.setAccordionState:null:null},u.setAccordionState=function(){for(var t,i,n=0;n<u.accordionStates.length;n++)t=u.accordionStates[n],i=$(".ecCartCustomComp [data-toggle='collapse'][href='"+t.href+"']"),i.attr("aria-expanded")!=t.state&&i.click();u.accordionStates=[]},u.updateBillingModes=function(n){$("#"+n+"Comp-itemsBillingQuote input[name=billingQuote]:radio:checked").val()!=null&&$.ajax({type:"POST",url:"/Async/Cart/UpdateBillingModes",data:{_billing:$("#"+n+"Comp-itemsBillingQuote input[name=billingQuote]:radio:checked").val()},dataType:"json",error:t.onAsyncError,success:function(){e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)}})},u.applyVoucherQuote=function(n){var i=$("#voucherquote").val();i!=null&&$.ajax({type:"POST",url:"/Async/Cart/VerifyVoucher",data:{_voucher:i},dataType:"json",error:t.onAsyncError,success:function(t){t?($("."+n+"Comp-errorVoucherQuote").hide(),e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)):$("."+n+"Comp-errorVoucherQuote").show();e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.giftselection],null),null,!1,null,null)}})},u.applyPointsQuote=function(){$.ajax({type:"POST",url:"/Async/Cart/VerifyPoints",data:{_pointsbalance:$("#pointsbalance").is(":checked")},dataType:"json",error:t.onAsyncError,success:function(n){n&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)}})},u.applyGiftCardQuote=function(){$.ajax({type:"POST",url:"/Async/Cart/VerifyGiftCard",data:{_giftcardbalance:$("#giftcardbalance").is(":checked")},dataType:"json",error:t.onAsyncError,success:function(n){n&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)}})},u.manageOptions=function(n,i){$.ajax({type:"POST",url:"/Async/Cart/GetOptionsRow",data:{_rowId:n,_componentId:i},dataType:"json",error:t.onAsyncError,success:function(t){$("#ecCartCustom_"+i+" .configoptionsform").hide("blind",1e3);$("#ecCartCustom_"+i+" .setoptionsform").html("");$(".cartErrorRow_"+n+" .setoptionsform").html(t.data);$(".cartErrorRow_"+n+" .manageoptions").hide();$(".cartErrorRow_"+n+" .configoptionsform").show("blind",1e3);st.registerHandlers()}})},u.confirmOptions=function(n,i,r){var o=$(r).closest(".cart_error_row_"+n).find("form"),s=$(o).data("cellidentifier"),f=st.sumbitForm(s);f!=null&&$.ajax({type:"POST",url:"/Async/Cart/ChangeOptions",data:{_rowId:n,_options:f},dataType:"json",error:t.onAsyncError,success:function(){e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart],tipologiaCart.cart),null,!0,u.collectAccordionsState(),null)}})},u.getParamsSize=function(n){var t=/^([\w]+)-([0-9]+)-([0-9]+)$/.exec(n);return t!=null?{htmlId:t[0],"class":t[1],rowId:t[2],sizeId:t[3]}:null},u.getParamsStore=function(n){var t=/^([A-Za-z]+)_([0-9]+)_([0-9]+)$/.exec(n);return t!=null?{htmlId:t[0],"class":t[1],shippingId:t[2],storeId:t[3]}:null},u.handleAction=function(){var n=_isReact;switch($(this).data("action")){case"addItemFromWishlist":u.addItemFromWishlist($(this).data("cartid"),$(this).data("rowid"),$(this).data("rowproductid"),1);break;case"addWholeWishlist":u.addWholeWishlist($(this).data("cartid"),1,!1);break;case"applyPointsQuote":u.applyPointsQuote($(this).data("class"));break;case"applyGiftCardQuote":u.applyGiftCardQuote($(this).data("class"));break;case"applyVoucherQuote":u.applyVoucherQuote($(this).data("class"));break;case"cancelModify":Site.orders.cancelModify($(this).data("orderid"));break;case"countryShippingQuote":$(this).val()!=""?(b.formatCAP($(this).val(),$("#capShippingQuote")),b.getDistrict($(this).val(),"",$("#regionShippingQuote"),!1)):$("#regionShippingQuote").empty();u.resetShippingModes($(this).data("class"));break;case"empty":u.empty(0,null,!1);break;case"gotoPayPalCheckoutExpress":Site.checkout.gotoPayPalCheckoutExpress();break;case"getShippingModes":u.getShippingModes($(this).data("class"),$(this).data("showgmap"));break;case"regionShippingQuote":u.resetShippingModes($(this).data("class"));break;case"removeItem":u.removeItem($(this).data("rowid"));break;case"update":u.update($(this).data("identifier"),$(this).data("animation"),$(this).data("typecart"),$(this).data("class"),$(this).data("checkupdate"));u.isUpdated==0&&$(this).data("checkoutpermalink")!=undefined&&(window.location.href=$(this).data("checkoutpermalink"));break;case"updateBillingModes":u.updateBillingModes($(this).data("class"));break;case"updateRow":$(this).data("typeupdate")==0?$("#"+$(this).data("cart-identifier")).addClass("modified"):u.updateRow($("[id="+$(this).data("rowid")+"]:visible"),!0,$(this).data("updateanimation"),$(this).data("typecart"));break;case"updateAgentRow":$(this).data("typeupdate")==0?$("#"+$(this).data("cart-identifier")).addClass("modified"):u.updateAgentRow($(this));break;case"updateRowButton":u.updateRow($("[id="+$(this).data("rowid")+"]:visible"),!0,$(this).data("updateanimation"),$(this).data("typecart"));break;case"updateShippingModes":u.updateShippingModes($(this).attr("data-class"));break;case"manageOptions":u.manageOptions($(this).data("rowid"),$(this).data("componentid"));break;case"confirmOptions":u.confirmOptions($(this).data("rowid"),$(this).data("componentid"),this);break;default:n=!1}},u.registerHandlers=function(){$(document).on("click",'.ecCartComp [data-action="addItemFromWishlist"], .ecCartCustomComp [data-action="addItemFromWishlist"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="addWholeWishlist"], .ecCartCustomComp [data-action="addWholeWishlist"]',u.handleAction);$(document).on("change",'.ecCartComp [data-action="applyPointsQuote"], .ecCartCustomComp [data-action="applyPointsQuote"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="applyVoucherQuote"], .ecCartCustomComp [data-action="applyVoucherQuote"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="applyGiftCardQuote"], .ecCartCustomComp [data-action="applyGiftCardQuote"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="cancelModify"], .ecCartCustomComp [data-action="cancelModify"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="empty"], .ecCartCustomComp [data-action="empty"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="getShippingModes"], .ecCartCustomComp [data-action="getShippingModes"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="gotoPayPalCheckoutExpress"], .ecCartCustomComp [data-action="gotoPayPalCheckoutExpress"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="removeItem"], .ecCartCustomComp [data-action="removeItem"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="update"], .ecCartCustomComp [data-action="update"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="updateBillingModes"], .ecCartCustomComp [data-action="updateBillingModes"]',u.handleAction);$(document).on("change",'.ecCartComp [data-action="updateRow"], .ecCartCustomComp [data-action="updateRow"]',u.handleAction);$(document).on("change",'.ecCartComp [data-action="updateAgentRow"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="updateRowButton"], .ecCartCustomComp [data-action="updateRowButton"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="updateShippingModes"], .ecCartCustomComp [data-action="updateShippingModes"]',u.handleAction);$(document).on("click",'.ecCartComp [data-action="toggleDetails"], .ecCartCustomComp [data-action="toggleDetails"]',t.toggleDetails);$(document).on("click",'.ecCartCustomComp [data-action="manageOptions"]',u.handleAction);$(document).on("click",'.ecCartCustomComp [data-action="confirmOptions"]',u.handleAction);$(document).on("change",".ecCartComp #countryShippingQuote, .ecCartCustomComp #countryShippingQuote",u.handleAction);$(document).on("change",".ecCartComp #regionShippingQuote, .ecCartCustomComp #regionShippingQuote",u.handleAction);$(document).on("click",'.ecMinicartComp [data-action="removeItem"]',u.handleAction)},u.init=function(){$(".ecCartComp .inputqty, .ecCartCustomComp .inputqty").each(function(n,t){$(t).limitkeypress({numberRexp:$(t).data("numberrexp")})});$(".ecCartComp .inputqtysize, .ecCartCustomComp .inputqtysize").each(function(n,t){$(t).limitkeypress({numberRexp:1})});$(".ecCartComp .inputdiscount, .ecCartCustomComp .inputdiscount").each(function(n,t){$(t).limitkeypress({numberRexp:2})});$(".ecCartComp .inputprice, .ecCartCustomComp .inputprice").each(function(n,t){$(t).limitkeypress({numberRexp:$(t).data("numberrexp")!=""?$(t).data("numberrexp"):2})});$('.ecCartComp [data-action="setShippingQuote"], .ecCartCustomComp [data-action="setShippingQuote"]').each(function(n,t){Site.cart.stores_map=!1;Site.cart.getShippingModes($(t).data("class"),$(t).data("show-gmap"))});u.initAutoComplete()},u.initAutoComplete=function(){_isResponsive&&$(".ecCartCustomComp .ecCartCustomComp-autocomplete").children().each(function(n,t){var i=$(t);i.hasClass("title")||i.hasClass("ecFieldautocompleteComp")||i.find(".ecFieldautocompleteComp").length!=0||i.remove()})},p=function(){},p.filter=function(n,r,u,f){(u==null||u==""||u=="/")&&(u=location.pathname);r!=null&&r!=""?$.ajax({type:"POST",url:"/ASync/Filter/Add",data:{_pageId:t.getParamsId($("body").attr("id")).id,_filterId:n,_filters:r,_location:u},dataType:"json",error:t.onAsyncError,success:function(){var t=null,n;if(r!=null)for(n=r.split("&"),i=0;i<n.length;i+=1)n[i].match("^q=")&&(t=n[i]);TrackerPW.TP.sendTermsSearch(null,t,2,f);u!=undefined&&u!=null&&window.location.pathname!=u?window.location=u:(o.filter(e.collectClassesComponent([tipologiaRefresh.cms],null)),e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cms],null),null,!1,null,null))}}):window.location=u},p.removeFilter=function(n,t){$.ajax({type:"POST",url:"/ASync/Filter/Remove",data:{_filter:n,_location:t},dataType:"json",success:function(){t!=undefined&&t!=null&&window.location.pathname!=t?location.href=t:e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cms],null),null,!1,null,null)}})},p.copyFilters=function(n){var i=$(n).closest(".cmsSearchandfilterComp-form"),r,u;i.length!=0&&(r=$(i).find(":not([name=form_sent]):not([name=__RequestVerificationToken])").serialize(),u={pid:t.getParamsId($("body").attr("id")).id,fid:$(i).data("identifier"),fcv:r,typ:"c"},gt.copy($.param(u),n))},p.loadContent=function(n,i,r){var s,l,a;if(history.pushState){var f=$(n).attr("href"),h=f,u="",c=f.indexOf("?");c!=-1&&(h=f.substring(0,c),u=f.substring(c),s=o.getQueryStringParams(u),s.a!=null&&(s.a=i),u="?"+$.param(s));(location.pathname!=h||location.search!=u)&&history.pushState({a:i},null,h+u)}return r==undefined&&(r={}),r.a=i,l=null,r.book!=null&&(a="cmsBook_"+r.book,$("#"+a+" .cmsBookindexComp a").removeClass("active"),$(n).addClass("active"),l=[a]),r.lazy==null&&$(".cmsNewsdetailComp").length>0&&t.scrollTo($($(".cmsNewsdetailComp")[0]).offset().top),e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cmsdetail],null),r,!1,p.lazyLoading,l),!1},p.lazyLoading=function(){$(".cmsBookComp.lazyloading").each(function(){if($(this).height()+$(this).offset().top<=$(window).scrollTop()+$(window).height())try{$(this).find(".nextcontent a:not(.scrolling)").length>0&&($(this).find(".nextcontent a").addClass("scrolling"),$(this).find(".nextcontent a").click())}catch(n){}})},p.handleAction=function(){switch($(this).data("action")){case"filterCms":p.filter($(this).data("identifier"),$(this).data("permalink"),$(this).data("location"));break;case"filterCmsSelect":$($(this).val()).click();break;case"removeFilterCms":p.removeFilter($(this).data("type"),$(this).data("archive"));break;case"removeFilters":d.removeFilters();break;case"voteComment":Site.fieldcommentvote.voteComment($(this));break;case"calendarGoToMonth":Site.updaters.refreshComponent($("#"+$(this).data("class")+"_"+$(this).data("identifier")),{m:""+$(this).data("month")+""},null,null)}},p.registerHandlers=function(){$(document).on("click",".cmsTagcloudComp a",p.handleAction);$(document).on("click",".cmsFieldauthorComp a",p.handleAction);$(document).on("click",".cmsFieldcategoriesComp a",p.handleAction);$(document).on("click",".cmsFielddateComp a",p.handleAction);$(document).on("click",".cmsFieldtagsComp a",p.handleAction);$(document).on("click",".cmsCategoriesmenuComp a",p.handleAction);$(document).on("click",".cmsTimeperiodsmenuComp a",p.handleAction);$(document).on("click",".cmsMenuComp a",p.handleAction);$(document).on("click",".cmsCalendarComp a",p.handleAction);$(document).on("click",".cmsNewsarchiveComp a.removefilter",p.handleAction);$(document).on("click",'.cmsRelatedproductsComp [data-action="removeFilters"]',p.handleAction);$(document).on("submit",".cmsSearchandfilterComp-form",function(){return $(this).find(":text").each(function(){$(this).attr("defaultvalue")!=""&&$(this).attr("defaultvalue")==$(this).val()&&$(this).val("")}),Site.cms.filter($(this).attr("data-identifier"),$("#cmsSearchandfilter_"+$(this).attr("data-identifier")).children("form").serialize(),$(this).attr("action")),!1});$(document).on("click",".cmsFieldcommentvoteComp a",p.handleAction);if(_isResponsive){$(document).off("change",".cmsTimeperiodsmenuComp .cmsTimeperiodsmenu-select",p.handleAction);$(document).on("change",".cmsTimeperiodsmenuComp .cmsTimeperiodsmenu-select",p.handleAction);$(document).off("click","[id*='cmsCategoriesmenu'].menu-offcanvas a[data-action]",p.handleAction);$(document).on("click","[id*='cmsCategoriesmenu'].menu-offcanvas a[data-action]",p.handleAction);$(document).off("click","[id*='cmsMenuComp'].menu-offcanvas a[data-action]",p.handleAction);$(document).on("click","[id*='cmsMenuComp'].menu-offcanvas a[data-action]",p.handleAction);$(document).off("click","[id*='cmsTimeperiodsmenuComp'].menu-offcanvas a[data-action]",p.handleAction);$(document).on("click","[id*='cmsTimeperiodsmenuComp'].menu-offcanvas a[data-action]",p.handleAction)}},p.init=function(){p.lazyLoading();$(document).on("scroll",p.lazyLoading)},d=function(){},d.cascadedfilter=function(n,i,r,u,f){var o=t.getParamsId($(n).attr("id")),s,h;for($(n).children("form").find(":text").each(function(){$(this).attr("placeholdervalue")!=""&&$(this).attr("placeholdervalue")==$(this).val()&&$(this).val("")}),s=i+1;$("#"+o.htmlId+" .cascadedcontrol"+s).length>0;)$("#"+o.htmlId+" .cascadedcontrol"+s).html(""),s++;if(h=d.getFilter(n,!1),!f)switch($(r).prop("tagName")){case"UL":i++;break;case"INPUT":($(r).hasClass("autocomplete")||$(r).hasClass("dd-selected-value"))&&i++;break;case"SELECT":$(r).find(":selected").val()==""&&$(r).find("option").length>1?i--:i++}$("#"+o.htmlId+" .cascadedcontrol"+i).length>0?$.ajax({type:"POST",url:"/Async/Filter/CascadedFilter",data:{_pageId:t.getParamsId($("body").attr("id")).id,_filterId:o.id,_filterIdentifier:$(n).data("identifier"),_filters:h.filters,_number:i,_filtersFields:h.fields},dataType:"json",error:t.onAsyncError,success:function(r){$(n).replaceWith(r.data);ct.init();t.enableDDSlick();d.checkLoadCascadedfilter(o.htmlId,i,u);$("#"+o.htmlId).find(".removeFilter").length>0&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.catalog],null),null,!1,null,null)}}):d.filter(n,u,!0,!0)},d.checkLoadCascadedfilter=function(n,t,i){$("#"+n+" .cascadedcontrol"+t+" .cascadedcontrol").each(function(){switch($(this).prop("tagName")){case"UL":$(this).find("li").length==1?$(this).hasClass("checkboxlist")?$(this).find("li input[type=checkbox]").click():$(this).find("li a").click():$(this).find("li").length==0&&d.cascadedfilter($("#"+n),t,$(this),i,!1);break;case"SELECT":$(this).find(":selected").val()!=""?d.cascadedfilter($("#"+n),t,$(this),i,!1):$(this).find("option:not(.selectlabel)").length==1&&$(this).val($(this).find("option:not(.selectlabel)").val()).change();break;case"INPUT":$(this).hasClass("dd-selected-value")&&($(this).val()!=""?d.cascadedfilter($("#"+n),t,$(this),i,!1):$(this).closest(".dd-container").find("li:not(.selectlabel)").length==1&&$(this).closest(".dd-container").ddslick("select",{index:1}))}})},d.getFilter=function(n,t){var u=$(n).children("form").find(":not([name=form_sent]):not([name=__RequestVerificationToken])").serializeArray(),i="",r="";return $.each(u,function(u,f){var e=$(n).find("[name="+f.name+"]"),o;$(e).length>0&&(o=$(e).data("name")!=null?$(e).data("name"):f.name,(!t||t&&$.trim(f.value)!="")&&(i+=(u==0?"":"&")+o+"="+($(e).prop("tagName").toString().toLowerCase()==="input"?$(e).hasClass("autocomplete")?"autocomplete":$(e).hasClass("checkboxlist")?"checkboxlist":$(e).prop("type").toLowerCase():$(e).prop("tagName").toString().toLowerCase()),r+=(u==0?"":"&")+encodeURIComponent(o)+"="+encodeURIComponent(f.value)))}),{filters:r,fields:i}},d.filter=function(n,i,r,u){$(n).children("form").find(":text").each(function(){$(this).attr("placeholdervalue")!=""&&$(this).attr("placeholdervalue")==$(this).val()&&$(this).val("")});var s=d.getFilter(n,!1),f=t.getParamsId($("body").attr("id")),h=$(n).data("identifier");$.ajax({type:"POST",url:"/Async/Filter/ExecuteFilter",data:{_pageId:f.id,_pageType:f.class,_filterId:$(n).data("identifier"),_filters:s.filters,_location:i==null?window.location.pathname:i,_cascaded:r,_filtersFields:s.fields},dataType:"json",error:t.onAsyncError,success:function(r){if(t.addTimeStampUrl(),TrackerPW.TP.sendTermsSearch($(n).children("form"),null,1,r.userId,r.eventFacebookID,r.valueEvent,r.enabledEventClientSide,r.isSendEventServerSide),i!=undefined&&i!=null&&u&&window.location.pathname!=i)window.location=i;else if($.fn.__GetUrlParameter("p")!=undefined)window.location=window.location.href.split("?")[0];else{$(".ecCatalogsearchandfilterComp[data-identifier="+$(n).data("identifier")+"]").each(function(n,i){var r={_pageId:f.id,_pageType:f.class,_componentId:t.getParamsId($(i).attr("id")).id};_permalinkCms!=null&&(r._permalinkCms=_permalinkCms);$(i).hasClass("searchcmsrelatedproducts")&&(r.cmsNewsdetailCollector=!0);$.ajax({type:"POST",url:"/Async/RefreshComponent",data:r,dataType:"json",error:t.onAsyncError,success:function(n){_isReact?$.fn.__FindReactComponent($(i)).refreshComponent(!0):$(i).replaceWith(n.data);Site.fieldfilter.bindFieldFilter();t.enableDDSlick()}})});var s=$(n).children("form").data("filter-action");(s==undefined||s==null||s=="/"||window.location.pathname==s)&&(o.filter(e.collectClassesComponent([tipologiaRefresh.catalog],null)),e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.catalog],null),null,!1,null,null))}}})},d.removeFilters=function(){$.ajax({type:"POST",url:"/Async/Filter/RemoveFilters",dataType:"json",error:t.onAsyncError,success:function(){o.filter(e.collectClassesComponent([tipologiaRefresh.catalog],null));e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.catalog,tipologiaRefresh.catalogsearch],null),null,!1,null,null)}})},d.copyFilters=function(n){var i=$(n).closest(".ecCatalogsearchandfilterComp-form");if(i.length!=0){var r=$(i).parent(),u=d.getFilter(r,!0),f={pid:t.getParamsId($("body").attr("id")).id,fid:$(r).data("identifier"),fcv:u.filters,csd:$(i).data("cascaded"),fct:u.fields,typ:"e"};gt.copy($.param(f),n)}},d.handleAction=function(){switch($(this).data("action")){case"removeFilters":d.removeFilters();break;case"sortCatalog":if($(this).val()!="")if($(this).data("loadtype")==1)$(this).parents(".ecCombinedboxComp").length>0?Site.pagination.changePage($("#"+$(this).data("componentid")),1,$(this).val(),{_category:$($(this).parents(".ecCombinedboxComp").find("#"+$(this).data("componentid")+"_category")).val()}):$(this).parents(".searchandfilterresultsComp ").length>0?Site.pagination.changePage($("#"+$(this).data("componentid")),1,$(this).val(),{q:$(this).data("search-text")}):$(this).parents(".ecGiftRegistryComp").length>0?Site.pagination.changePage($("#"+$(this).data("componentid")+"_paging"),1,$(this).val(),{changepage:1}):Site.pagination.changePage($("#"+$(this).data("componentid")),1,$(this).val());else{var n="?o"+$(this).data("identifier")+"="+$(this).val();window.location.href=n}break;case"elementforpageCatalog":Site.pagination.changeElementForPage($(this).val(),$("#"+$(this).data("componentid")));break;case"search":return!1}},d.registerHandlers=function(){$(document).on("change",'[data-action="sortCatalog"]',d.handleAction);$(document).on("change",'[data-action="elementforpageCatalog"]',d.handleAction);$(document).on("click",'.ecCatalogComp [data-action="removeFilters"], .ecCatalogsearchresultsboxComp [data-action="removeFilters"]',d.handleAction);$(document).on("click",".ecCombinedboxComp .combinedCategory",function(){t.scrollTo($($(this).attr("href")).offset().top);var n=$(this).attr("id").substr(9),i={_category:n,_p:1,pid:$(this).data("productid")};Site.updaters.refreshComponent($("#"+$(this).data("componentid")),i,null,null)});$(document).on("click",'.ecGiftRegistryComp [data-action="searchGiftRegistry"]',function(){var n=$(this),i;$("#registryerror_"+$(n).data("id")).hide();i=$("#registryid_"+$(n).data("id")).val();i!=""&&$.ajax({type:"POST",url:"/Async/Wishlist/SearchGiftRegistry",data:{_identifier:i},dataType:"json",error:t.onAsyncError,success:function(t){t?Site.updaters.refreshComponent($("#"+$(n).data("componentid")),null,null,null):$("#registryerror_"+$(n).data("id")).show()}})})},d.init=function(){$(".ecCombinedboxComp").each(function(){_isResponsive?($($(this).find(".ecCombinedboxComp-tabs").find("li").get($(this).data("tabs-index"))).find(".nav-link").addClass("active"),$(this).find(".ecCombinedboxComp-tabs").tab()):($(this).find(".ecCombinedboxComp-tabs").tabs(),$(this).find(".ecCombinedboxComp-tabs").tabs("option","active",$(this).data("tabs-index")))})},ii=!0,r=function(){},r.stores_map=null,r.stores_markers=[],r.stores_infowindow=null,r.stores_bounds=null,r.getTotalCheckout=function(n,i){var u=t.getParamsId($("."+n+"Comp").attr("id")).id,c=$("#"+n+"Comp-"+u+"-voucher").val(),f=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+n+"Comp-"+u+"-address option:selected").val(),s,h,e,o;f==0&&(f=null);s=$("#"+n+"Comp-"+u+"-shipping input:radio:checked").val()!=null?$("#"+n+"Comp-"+u+"-shipping input:radio:checked").val():null;h=i==3?$("#"+n+"Comp-billing input[name=billing]:radio:checked").val()!=null?$("#"+n+"Comp-billing input[name=billing]:radio:checked").val():null:$("#"+n+"Comp-billing:visible input[name=billing]:radio:checked").val()!=null?$("#"+n+"Comp-billing input[name=billing]:radio:checked").val():null;e=[];$("#"+n+"Comp-dlcharges input[type='checkbox']").each(function(){$(this).is(":checked")&&e.push($(this).val())});o=null;$("#"+n+"Comp-"+u+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-pickup")=="true"&&$("."+n+"Comp-itemsStores li.selectedStore").each(function(){o=$(this).attr("data-store-code")});var l=$("#"+n+"_"+u+" input[name=giftcardbalance]").length>0?$("#"+n+"_"+u+" input[name=giftcardbalance]").prop("checked"):!1,a=$("#"+n+"_"+u+" input[name=pointsbalance]").length>0?$("#"+n+"_"+u+" input[name=pointsbalance]").prop("checked"):!1,v=$("#"+n+"Comp-"+u+"-deliverydate:visible").val(),y=$("#"+n+"Comp-"+u+"-deliveryhours:visible").val();t.addLoadingPanel("."+n+"Comp","checkout");$.ajax({type:"POST",url:"/Async/Checkout/GetTotalCheckout",data:{_voucher:c,_address:f,_shipping:s,_store:o,_billing:h,_pointsBalance:a,_giftcardBalance:l,_charges:JSON.stringify(e),_deliverydate:v,_deliveryhours:y,_step:i},dataType:"json",error:function(i,r,u){t.removeLoadingPanel("."+n+"Comp","checkout");t.onAsyncError(i,r,u)},success:function(i){t.removeLoadingPanel("."+n+"Comp","checkout");$(".giftcardbalance").html(i.saldoGiftCard);$(".pointsbalance").html(i.saldoPunti);$(".pointsbalanceamount").html(i.saldoPuntiValore);$(".totalsOrder-total").html(i.totaleOrdine);i.totaleOrdineNumerico==0?$("#"+n+"Comp-billing").hide():$("#"+n+"Comp-billing").show();var u=$("."+n+"Comp").find('[data-action="checkout-accordion"]');i.totaleOrdine!=null&&$(u).data("has-content-payment")&&r.getPaymentModes($(u).data("next-step"),null,$(u).data("class"),$(u).data("allow-no-payment"));i.totaleMerce!=null?($(".totalsOrder-subtotal").html(i.totaleMerce),$(".totalsOrder-subtotal").parents("."+n+"Comp-pre-checkoutFooterSubtotal").show()):($(".totalsOrder-subtotal").parents("."+n+"Comp-pre-checkoutFooterSubtotal").hide(),$(".totalsOrder-subtotal").html(""));i.iva!=null?($(".totalsOrder-tax").html(i.iva),$(".totalsOrder-tax").parents("."+n+"Comp-pre-checkoutFooterTax").show()):($(".totalsOrder-tax").parents("."+n+"Comp-pre-checkoutFooterTax").hide(),$(".totalsOrder-tax").html(""));i.prezzoSpese!=null?($(".totalsOrder-costs").html(i.prezzoSpese),$(".totalsOrder-costs").parents("."+n+"Comp-pre-checkoutFooterCosts").show()):($(".totalsOrder-costs").parents("."+n+"Comp-pre-checkoutFooterCosts").hide(),$(".totalsOrder-costs").html(""));i.speseSpedizione!=null?($(".totalsOrder-shipping").html(i.speseSpedizione),$(".totalsOrder-shipping").parents("."+n+"Comp-pre-checkoutFooterShipping").show()):($(".totalsOrder-shipping").parents("."+n+"Comp-pre-checkoutFooterShipping").hide(),$(".totalsOrder-shipping").html(""));i.prezzoSpeseBanca!=null?($(".totalsOrder-bank").html(i.prezzoSpeseBanca),$(".totalsOrder-bank").parents("."+n+"Comp-pre-checkoutFooterBank").show()):($(".totalsOrder-bank").parents("."+n+"Comp-pre-checkoutFooterBank").hide(),$(".totalsOrder-bank").html(""));i.prezzoSpeseBolli!=null?($(".totalsOrder-stamps").html(i.prezzoSpeseBolli),$(".totalsOrder-stamps").parents("."+n+"Comp-pre-checkoutFooterStamps").show()):($(".totalsOrder-stamps").parents("."+n+"Comp-pre-checkoutFooterStamps").hide(),$(".totalsOrder-stamps").html(""));i.prezzoScontoAbbuono!=null?($(".totalsOrder-rebate").html(i.prezzoScontoAbbuono),$(".totalsOrder-rebate").parents("."+n+"Comp-pre-checkoutFooterRebate").show()):($(".totalsOrder-rebate").parents("."+n+"Comp-pre-checkoutFooterRebate").hide(),$(".totalsOrder-rebate").html(""));i.prezzoScontoAbbuonoPagamento!=null?($(".totalsOrder-rebatediscount").html(i.prezzoScontoAbbuonoPagamento),$(".totalsOrder-rebatediscount").parents("."+n+"Comp-pre-checkoutFooterRebateDiscount").show()):($(".totalsOrder-rebatediscount").parents("."+n+"Comp-pre-checkoutFooterRebateDiscount").hide(),$(".totalsOrder-rebatediscount").html(""));i.enasarco!=null?($(".totalsOrder-enasarco").html(i.enasarco),$(".totalsOrder-enasarco").parents("."+n+"Comp-pre-checkoutFooterEnasarco").show()):($(".totalsOrder-enasarco").parents("."+n+"Comp-pre-checkoutFooterEnasarco").hide(),$(".totalsOrder-enasarco").html(""));i.puntiGuadagnati!=null?($(".totalsOrder-earnpoints").html(i.puntiGuadagnati),$(".totalsOrder-earnpoints").parents("."+n+"Comp-pre-checkoutFooterEarnpoints").show()):($(".totalsOrder-earnpoints").parents("."+n+"Comp-pre-checkoutFooterEarnpoints").hide(),$(".totalsOrder-earnpoints").html(""));i.puntiSpesi!=null?($(".totalsOrder-spentpoints").html(i.puntiSpesi),$(".totalsOrder-spentpoints").parents("."+n+"Comp-pre-checkoutFooterSpentpoints").show()):($(".totalsOrder-spentpoints").parents("."+n+"Comp-pre-checkoutFooterSpentpoints").hide(),$(".totalsOrder-spentpoints").html(""));i.totaleMerceVariato&&$(u).data("has-content-shipping")&&r.getShippingModes(null,!1,!1,$(u).data("class"),$(u).data("has-googlemaps"),$(u).data("allow-no-shipping"))}})},r.updateTotalCart=function(){$.ajax({type:"POST",url:"/Async/Checkout/UpdateTotalCart",dataType:"json",error:t.onAsyncError})},r.updateInfoUserCount=0,r.updateInfoUser=function(n,i){$(n).find("."+$(n).data("class")+"Comp-userinfo").each(function(){$("input[name=choice_address]").length>0&&t.addLoadingPanel("."+$(n).data("class")+"Comp","checkout");var h=$(this).find(".userregistrationComp"),u=$(this).find(".userregistrationComp-form"),o=$(u).data("pageid"),s=$(u).data("identifier"),f=$(u).attr("id");r.updateInfoUserCount++;$(u).ajaxSubmit({data:{_pageId:o,_componentId:s},dataType:"json",error:function(i,u,f){r.updateInfoUserCount--;$("input[name=choice_address]").length>0&&t.removeLoadingPanel("."+$(n).data("class")+"Comp","checkout");t.onAsyncError(i,u,f)},success:function(u){var o;if((r.updateInfoUserCount--,r.updateInfoUserCount<0&&(r.updateInfoUserCount=0),console.log(r.updateInfoUserCount),r.updateInfoUserCount==0)&&($("input[name=choice_address]").length>0&&t.removeLoadingPanel("."+$(n).data("class")+"Comp","checkout"),u.returnedCode=="success"))if($(n).find(".userregistrationComp").replaceWith(u.data),l.bindControls(),y.init(),l.checkAccoutType($("#"+f+' input:checked[name="accounttype"]').val(),f),l.checkPhysicalPerson($("#"+f+' input:checked[name="choice_physicalperson"]').val(),f),$(n).find(".userregistrationComp .formfield_error:visible").length==0||$(n).find(".userregistrationComp .formfield_error:visible").length>0&&$(n).find(".userregistrationComp .formfield_error:visible:not(:empty)").length==0){var h=!0,c=null,s=[];($(u.data).find("[name=same_shipaddress]").length>0||$(u.data).find("[name=choice_address]").length>0&&($(u.data).find("[name=choice_address]:checked").val()=="SA"||$(u.data).find("[name=choice_address]:checked").val()=="NA"))&&($(u.data).find("[name=same_shipaddress]").length>0&&$($(u.data).find("[name=same_shipaddress]")).is(":checked")||$(u.data).find("[name=choice_address]").length>0&&$(u.data).find("[name=choice_address]:checked").val()=="SA"?(h=!0,$(u.data).find("[name=bookAddressBilling]").length>0&&($($(u.data).find("[name=bookAddressBilling]")).val()==""?(s.push($($(u.data).find("[name=address]")).val()!=undefined?$($(u.data).find("[name=address]")).val():""),s.push($($(u.data).find("[name=city]")).val()!=undefined?$($(u.data).find("[name=city]")).val():""),s.push($($(u.data).find("[name=cap]")).val()!=undefined?$($(u.data).find("[name=cap]")).val():""),s.push($($(u.data).find("[name=district]")).val()!=undefined?$($(u.data).find("[name=district]")).val():""),s.push($($(u.data).find("[name=state]")).val()!=undefined?$($(u.data).find("[name=state]")).val():""),$("[name=address]").each(function(n,t){$(t).val(s[0]);$(t).parents(".textfieldComp").show()}),$("[name=city]").each(function(n,t){$(t).val(s[1]);$(t).parents(".textfieldComp").show()}),$("[name=cap]").each(function(n,t){$(t).val(s[2]);$(t).parents(".textfieldComp").show()}),$("[name=district]").each(function(n,t){$(t).val(s[3]);$(t).parents(".selectfieldComp").show()}),$("[name=state]").each(function(n,t){$(t).val(s[4]);$(t).parents(".selectfieldComp").show()})):c=$($(u.data).find("[name=bookAddressBilling]")).val())):(h=!1,$(u.data).find("[name=bookAddressShipping]").length>0&&($($(u.data).find("[name=bookAddressShipping]")).val()==""?(o="",$(u.data).find("input[name^=address]").each(function(n,t){return o=$(t).attr("name").replace("address",""),o!=""?!1:void 0}),o=o!=""?o:"2",s.push($($(u.data).find("[name=address"+o+"]")).val()!=undefined?$($(u.data).find("[name=address"+o+"]")).val():""),s.push($($(u.data).find("[name=city"+o+"]")).val()!=undefined?$($(u.data).find("[name=city"+o+"]")).val():""),s.push($($(u.data).find("[name=cap"+o+"]")).val()!=undefined?$($(u.data).find("[name=cap"+o+"]")).val():""),s.push($($(u.data).find("[name=district"+o+"]")).val()!=undefined?$($(u.data).find("[name=district"+o+"]")).val():""),s.push($($(u.data).find("[name=state"+o+"]")).val()!=undefined?$($(u.data).find("[name=state"+o+"]")).val():""),s.push($($(u.data).find("[name=phone_address"+o+"]")).val()!=undefined?$($(u.data).find("[name=phone_address"+o+"]")).val():""),s.push($($(u.data).find("[name=fax_address"+o+"]")).val()!=undefined?$($(u.data).find("[name=fax_address"+o+"]")).val():""),s.push($($(u.data).find("[name=mail_address"+o+"]")).val()!=undefined?$($(u.data).find("[name=mail_address"+o+"]")).val():""),s.push($($(u.data).find("[name=nominative_address"+o+"]")).val()!=undefined?$($(u.data).find("[name=nominative_address"+o+"]")).val():""),$("[name=address"+o+"]").each(function(n,t){$(t).val(s[0]);$(t).parents(".textfieldComp").show()}),$("[name=city"+o+"]").each(function(n,t){$(t).val(s[1]);$(t).parents(".textfieldComp").show()}),$("[name=cap"+o+"]").each(function(n,t){$(t).val(s[2]);$(t).parents(".textfieldComp").show()}),$("[name=district"+o+"]").each(function(n,t){$(t).val(s[3]);$(t).parents(".selectfieldComp").show()}),$("[name=state"+o+"]").each(function(n,t){$(t).val(s[4]);$(t).parents(".selectfieldComp").show()}),$("[name=phone_address"+o+"]").each(function(n,t){$(t).val(s[5]);$(t).parents(".textfieldComp").show()}),$("[name=fax_address"+o+"]").each(function(n,t){$(t).val(s[6]);$(t).parents(".textfieldComp").show()}),$("[name=mail_address"+o+"]").each(function(n,t){$(t).val(s[7]);$(t).parents(".textfieldComp").show()}),$("[name=nominative_address"+o+"]").each(function(n,t){$(t).val(s[8]);$(t).parents(".textfieldComp").show()})):c=$($(u.data).find("[name=bookAddressShipping]")).val())));$.ajax({type:"POST",url:"/Async/Checkout/GetUserInfoGeneric",data:{_address:c,_isPrimario:h,_addressData:s},dataType:"json",error:t.onAsyncError,success:function(t){t[0]||$(".userloginComp, .userbarComp, .ecMinicartComp").each(function(n,t){e.refreshComponent($(t),null,null,null)});$("#"+$(n).data("class")+"Comp-"+$(n).data("identifier")+"-address").find("option").remove().end().append($("<option><\/option>").attr("value",t[2]).text(t[2]).attr("selected","selected")).val(t[2]);$(n).data("has-content-shipping")&&i!=null?r.getShippingModes(null,$(n).data("viewtotalcheckout"),!1,$(n).data("class"),$(n).data("has-googlemaps"),$(n).data("allow-no-shipping")):$(n).data("has-content-payment")&&i!=null?r.getPaymentModes(null,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("allow-no-payment")):$(n).data("is-paypalexpress")?r.checkout(!0,$(n).data("class")):r.checkout(!1,$(n).data("class"))}});i!=null&&i!=-1&&r.goToStep(n,i)}else $(n).find(".userregistrationComp .formfield_error:not(:empty)").length>0&&t.scrollTo($(n).find(".userregistrationComp .formfield_error:not(:empty)").first().offset().top)}})})},r.getShippingModes=function(n,u,f,e,o,s){var h=t.getParamsId($("."+e+"Comp").attr("id")).id,c=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+e+"Comp-"+h+"-address option:selected").val();c==0&&(c=null);c!=null||c==null&&$("#"+e+"_"+h).hasClass("noaddress")?($("."+e+"Comp-dlcharges").hide(),$("."+e+"Comp-dldelivery").hide(),$("."+e+"Comp-dlstores").hide(),$("#"+e+"Comp-"+h+"-noshipping").hide(),t.addLoadingPanel("."+e+"Comp","checkout"),$.ajax({type:"POST",url:"/Async/Checkout/GetShipping",data:{_address:c!=null?c:0,_classComponent:e,_isMobile:!1,_allowNoShipping:s},dataType:"json",error:function(n,i,r){t.removeLoadingPanel("."+e+"Comp","checkout");t.onAsyncError(n,i,r)},success:function(o){if(t.removeLoadingPanel("."+e+"Comp","checkout"),$("#"+e+"Comp-"+h+"-shipping").children().remove(),$("#"+e+"Comp-charges").children().remove(),o!=""){o.spedizioni.length==0&&($("#"+e+"Comp-"+h+"-noshipping").show(),ci(e),$("#modalNoShipping").length>0&&$.jGrowl($("#modalNoShipping").attr("data-testo"),{sticky:!0}));var c=0;for(i=0;i<o.spedizioni.length;i++)$("<li data-shipping-pickup='"+(o.spedizioni[i].mezzoTrasporto==2?"true":"false")+"' data-error-message='"+o.spedizioni[i].testoErrorMandatoryNegozio+"' class='"+(o.spedizioni[i].selected?"selectedShipping":"")+(_isResponsive?" list-group-item":"")+"' data-shipping-service-pickup-points='"+o.spedizioni[i].servizioPuntiRitiro+"'>"+(_isResponsive?"<div class='form-check'><label class='form-check-label'>":"")+"<input type='radio' value='"+o.spedizioni[i].id+"' "+(o.spedizioni[i].selected?"checked='checked'":"")+" name='shipping' "+(_isResponsive?"class='form-check-input'":"")+">"+o.spedizioni[i].descrizione_costo+o.spedizioni[i].descrizione_dettagli+"<\/input>"+(_isResponsive?"<\/label><\/div>":"")+"<\/li > ").appendTo("#"+e+"Comp-"+h+"-shipping"),o.spedizioni[i].selected&&(c=i);for(i=0;i<o.spese.length;i++)$("<li class='"+(_isResponsive?"list-group-item":"")+"'>"+(_isResponsive?"<div class='form-check'><label class='form-check-label'>":"")+"<input type='checkbox' value='"+o.spese[i].id+"' "+(o.spese[i].selezionabile?o.spese[i].isSelezionato?" checked='checked' ":"":" checked='checked' disabled='disabled' ")+(_isResponsive?" class='form-check-input'":"")+">"+o.spese[i].descrizione_costo+o.spese[i].descrizione_dettagli+"<\/input>"+(_isResponsive?"<\/label><\/div>":"")+"<\/li>").appendTo("#"+e+"Comp-charges");o.spese.length==0?$("#"+e+"Comp-dlcharges").hide():$("#"+e+"Comp-dlcharges").show();$("."+e+"Comp-itemsShipping li").removeClass("selectedShipping");o.spedizioni.length!=0&&($($('input[name="shipping"]')[c]).parents("li").first().data("shipping-pickup")=="true"||$($('input[name="shipping"]')[c]).parents("li").first().data("shipping-service-pickup-points")!="0"&&$($('input[name="shipping"]')[c]).parents("li").first().data("shipping-service-pickup-points")!=null&&$($('input[name="shipping"]')[c]).parents("li").first().data("shipping-service-pickup-points")!="null")&&($($("."+e+"Comp-itemsShipping li")[c]).addClass("selectedShipping"),$("."+e+"Comp-dlstores").show());r.getDelivery(e);o.spedizioni.length>0&&$($('input[name="shipping"]')[c]).prop("checked",!0).trigger("click");n!=null&&(o.spedizioni.length>0||s)&&r.goToStep($("."+e+'Comp-accordion[data-action="checkout-accordion"]'),n);(o.spedizioni.length==0||$("#"+e+"Comp-"+h+"-shipping").length==0)&&(f&&r.getPaymentModes(null,u,e,!1),u&&r.getTotalCheckout(e,n!=null?1:0))}else $("#"+e+"Comp-"+h+"-noshipping").show(),ci(e),$("#modalNoShipping").length>0&&$.jGrowl($("#modalNoShipping").attr("data-testo"),{sticky:!0})}})):u&&r.getTotalCheckout(e,n!=null?1:0)},r.getCharges=function(n,u,f){var e=t.getParamsId($("."+n+"Comp").attr("id")).id,o=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+n+"Comp-"+e+"-address option:selected").val();$("#"+n+"Comp-"+e+"-shipping input:radio:checked").val()!=null&&o!=null&&o!=0?$.ajax({type:"POST",url:"/Async/Checkout/GetCharges",data:{_address:o,_shipping:$("#"+n+"Comp-"+e+"-shipping input:radio:checked").val(),_classComponent:n},dataType:"json",error:t.onAsyncError,success:function(t){if(t!=null)if(t.length>0){for($("#"+n+"Comp-chargesShipping").children().remove(),i=0;i<t.length;i++)$("<li class='"+(_isResponsive?"list-group-item":"")+"'>"+(_isResponsive?"<div class='form-check'><label class='form-check-label'>":"")+"<input type='checkbox' value='"+t[i].id+"' "+(t[i].selezionabile?t[i].isSelezionato?" checked='checked' ":"":" checked='checked' disabled='disabled' ")+(_isResponsive?" class='form-check-input'":"")+">"+t[i].descrizione_costo+t[i].descrizione_dettagli+"<\/input>"+(_isResponsive?"<\/label><\/div>":"")+"<\/li>").appendTo("#"+n+"Comp-chargesShipping");$("#"+n+"Comp-charges li").length==0?$("#"+n+"Comp-dlcharges").show("slow"):$("#"+n+"Comp-chargesShipping").show("slow")}else $("#"+n+"Comp-charges li").length==0?$("#"+n+"Comp-dlcharges").hide("slow"):$("#"+n+"Comp-chargesShipping").hide("slow"),$("#"+n+"Comp-chargesShipping").children().remove();u&&r.getTotalCheckout(n,f)}}):u&&r.getTotalCheckout(n,f)},r.getDelivery=function(n){var i=t.getParamsId($("."+n+"Comp").attr("id")).id,f,u;$("#"+n+"Comp-"+i+"-shipping input:radio:checked").val()!=null&&(f=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+n+"Comp-"+i+"-address option:selected").val(),f==0&&(f=null),u=$("#"+n+"Comp-"+i+"-deliverydate").val(),$.ajax({type:"POST",url:"/Async/Checkout/GetDelivery",data:{_shipping:$("#"+n+"Comp-"+i+"-shipping input:radio:checked").val(),_address:f},dataType:"json",error:t.onAsyncError,success:function(t){t!=null&&t.date.length>0?($("#"+n+"Comp-dldelivery .deliverytitle").html($("#"+n+"Comp-dldelivery .deliverytitle").data(t.ritiro?"deliverypickuptitle":"deliverytitle")),$("#"+n+"Comp-"+i+"-deliverydate").prop("disabled",!t.calendario),t.calendario||(u=t.date[0],$("#"+n+"Comp-"+i+"-deliverydate").datepicker("setDate",u)),u!=""&&t.date.indexOf(u)!=-1?r.getDeliveryInterval(n,i,t.id,u):($("#"+n+"Comp-"+i+"-deliverydate").val(""),$("#"+n+"Comp-dldelivery .deliverydatemandatory").show()),$("#"+n+"Comp-"+i+"-deliverydate").datepicker("option","beforeShowDay",function(n){var i=jQuery.datepicker.formatDate("dd/mm/yy",n);return[t.date.indexOf(i)!=-1]}),$("#"+n+"Comp-"+i+"-deliverydate").datepicker("option","onSelect",function(u){r.getDeliveryInterval(n,i,t.id,u)}),$("#"+n+"Comp-dldelivery .hourselection").hide(),$("#"+n+"Comp-dldelivery").show("slow")):$("#"+n+"Comp-dldelivery").hide("slow")}}))},r.getDeliveryInterval=function(n,r,u,f){$("#"+n+"Comp-dldelivery .deliverydatemandatory").hide();$.ajax({type:"POST",url:"/Async/Checkout/GetDeliveryInterval",data:{_delivery:u,_date:f},dataType:"json",error:t.onAsyncError,success:function(t){var f,u;if(t!=null&&t.intervalli.length>0){for(f=$("#"+n+"Comp-"+r+"-deliveryhours option").length==0?$("#"+n+"Comp-"+r+"-deliveryhours").data("initvalue"):$("#"+n+"Comp-"+r+"-deliveryhours").val(),$("#"+n+"Comp-dldelivery #"+n+"Comp-"+r+"-deliveryhours").prop("disabled",!t.calendario),$("#"+n+"Comp-dldelivery #"+n+"Comp-"+r+"-deliveryhours").empty(),u=0,i=0;i<t.intervalli.length;i++)u+=t.intervalli[i].disabilitato?0:1,$("<option value='"+t.intervalli[i].valore+"' "+(t.intervalli[i].disabilitato?" disabled='disabled'":"")+(!t.intervalli[i].disabilitato&&t.intervalli[i].valore==f?" selected='selected'":"")+">"+t.intervalli[i].testo+"<\/option>").appendTo("#"+n+"Comp-"+r+"-deliveryhours");u>0?$("#"+n+"Comp-dldelivery .deliveryhoursunavailable").hide():$("#"+n+"Comp-dldelivery .deliveryhoursunavailable").show();$("#"+n+"Comp-dldelivery .hourselection").show()}else $("#"+n+"Comp-dldelivery .hourselection").hide()}})},r.getStores=function(n,i){var f=t.getParamsId($("."+n+"Comp").attr("id")).id,u;$("#"+n+"Comp-dlstores .searchPickupPoints").hide();$("#"+n+"Comp-dlstores .title_pickupPoints").hide();$("#"+n+"Comp-dlstores .title_stores").show();$("#"+n+"Comp-dlstores .searchStores").show();u=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+n+"Comp-"+f+"-address option:selected").val();(!0||$("#"+n+"Comp-"+f+"-shipping input:radio:checked").val()!=null&&u!=null&&u!=0)&&$.ajax({type:"POST",url:"/Async/Checkout/GetStores",data:{_address:u,_shipping:$("#"+n+"Comp-"+f+"-shipping input:radio:checked").val(),_classComponent:n,_isMobile:!1},dataType:"json",error:t.onAsyncError,success:function(t){t!=""?t?($("#"+n+"Comp-dlstores .regionStore").empty(),$("#"+n+"Comp-dlstores .regionStore").append(t[0]),$("#"+n+"Comp-dlstores .regionStore").attr("data-nation",t[2]),$("#"+n+"Comp-dlstores .regionStore").unbind("change"),$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").children().remove(),$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").append(t[1]),$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").attr("id","itemsShippingStores_"+t[3]),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").hide(),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").html(""),r.searchStore(n,i),$("#"+n+"Comp-dlstores .regionStore").val($("#"+n+"Comp-dlstores .regionStore").val()).trigger("change"),$("#"+n+"Comp-dlstores").show("slow")):($("#"+n+"Comp-dlstores").hide("slow"),$("#"+n+"Comp-dlstores .regionStore").empty(),$("#"+n+"Comp-dlstores .regionStore").attr("data-nation",""),$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").children().remove(),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").hide(),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").html("")):($("#"+n+"Comp-dlstores").hide("slow"),$("#"+n+"Comp-dlstores .regionStore").empty(),$("#"+n+"Comp-dlstores .regionStore").attr("data-nation",""),$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").children().remove(),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").hide(),$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").html(""))}})},r.searchStore=function(n,i){var u=t.getParamsId($("."+n+"Comp").attr("id")).id,h=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+n+"Comp-"+u+"-address option:selected").val(),f,e,o,s;$("#"+n+"Comp-"+u+"-address_pudo").length>0&&(f=$("#"+n+"Comp-"+u+"-address_pudo").val());$("#"+n+"Comp-"+u+"-city_pudo").length>0&&(e=$("#"+n+"Comp-"+u+"-city_pudo").val());$("#"+n+"Comp-"+u+"-cap_pudo").length>0&&(o=$("#"+n+"Comp-"+u+"-cap_pudo").val());$("#"+n+"Comp-"+u+"-distance_pudo").val()>0&&(s=$("#"+n+"Comp-"+u+"-distance_pudo").val());$("#"+n+"Comp-dlstores").off("change",".regionStore").on("change",".regionStore",function(){$.ajax({type:"POST",url:"/Async/Cart/SearchStore",data:{_shipping:$("#"+n+"Comp-"+u+"-shipping li input:radio:checked").val()!=null?$("#"+n+"Comp-"+u+"-shipping li input:radio:checked").val():null,_country:$(this).attr("data-nation"),_region:null,_regionStore:$(this).val(),_classComponent:n,_showGoogleMap:i,_isMobile:!1,_address:h,_localita:e,_cap:o,_street:f,_distance:s},dataType:"json",error:t.onAsyncError,success:function(t){$("."+n+"Comp-itemsStores").html("");$("."+n+"Comp-itemsStores").html(t[1]);t[0]!=""&&t[0].province_negozi!=null&&t[0].province_negozi.length>0&&($("#"+n+"Comp-dlstores .regionStore").empty(),$("#"+n+"Comp-dlstores .regionStore").append(t[2]),$("#"+n+"Comp-dlstores .regionStore").attr("data-nation",t[3]));r.addHadlerEventListStores(n);i?($("."+n+"Comp-itemShippingStores").each(function(){$(this).find(".store_description").show()}),setTimeout(function(){r.addGoogleMapStores(n)},600)):$("."+n+"Comp-itemShippingStores").each(function(){$(this).find(".store_description").show()});$("#"+n+"Comp-dlstores ."+n+"Comp-itemShippingStores.selectedStore").length>0&&$($("#"+n+"Comp-dlstores ."+n+"Comp-itemShippingStores.selectedStore")[0]).find(".store_selection").click()}})})},r.selectStore=function(n,i){t.addLoadingPanel("."+n+"Comp","checkout");$.ajax({type:"POST",url:"/Async/Checkout/SelectStore",data:{_store:$("."+n+"Comp-itemShippingStores[data-marker-index="+i+"]").attr("data-store-code")},dataType:"json",error:function(i,r,u){t.removeLoadingPanel("."+n+"Comp","checkout");t.onAsyncError(i,r,u)},success:function(r){t.removeLoadingPanel("."+n+"Comp","checkout");r!=""?($("."+n+"Comp-itemShippingStores[data-marker-index="+i+"]").removeClass("selectedStore"),$.jGrowl(r,{sticky:!0})):($("."+n+"Comp-itemShippingStores").removeClass("selectedStore"),$("."+n+"Comp-itemShippingStores[data-marker-index="+i+"]").addClass("selectedStore"),$("."+n+"Comp-errorStores").html(""),$("."+n+"Comp-errorStores").hide())}})},r.addHadlerEventListStores=function(n){$(document).off("click","."+n+"Comp-itemShippingStores").on("click","."+n+"Comp-itemShippingStores",function(){var t=$(this).attr("data-marker-index");$("."+n+"Comp-itemShippingStores").removeClass("activeStore");$(this).addClass("activeStore");r.stores_map!=null&&google.maps.event.trigger(r.stores_markers[t],"click",{})});$(document).off("click","."+n+"Comp-itemShippingStores .store_selection").on("click","."+n+"Comp-itemShippingStores .store_selection",function(){var t=$(this).closest("."+n+"Comp-itemShippingStores").attr("data-marker-index");r.selectStore(n,t)})},r.addGoogleMapStores=function(n){var t,i;for(r.stores_map=new google.maps.Map(document.getElementById("checkout_store_map"),{disableDoubleClickZoom:!0,scrollwheel:!1,panControl:!1,rotateControl:!1,zoom:10}),r.stores_markers=[],r.stores_markers.length=0,$("."+n+"Comp-itemShippingStores").each(function(){var t,i,f;try{if($(this).find(".store_description").hide(),t=new google.maps.Marker,$(this).data("latitude")==""&&$(this).data("store-code")==0)i=new google.maps.Geocoder,i.geocode({address:$(this).data("address")},function(n,t){t==google.maps.GeocoderStatus.OK&&t!=google.maps.GeocoderStatus.ZERO_RESULTS?(r.stores_map.setCenter(n[0].geometry.location),r.stores_map.fitBounds(n[0].geometry.viewport)):r.stores_map.setCenter(new google.maps.LatLng(41.87194,12.56738))});else if($(this).data("latitude")==""&&$(this).data("store-code")!=0)i=new google.maps.Geocoder,i.geocode({address:$(this).data("address")},function(i,u){if(u==google.maps.GeocoderStatus.OK&&u!=google.maps.GeocoderStatus.ZERO_RESULTS){var f=new google.maps.LatLng(i[0].geometry.location.lat,i[0].geometry.location.lng);t.setMap(r.stores_map);t.setPosition(f);t.setLabel($(this).data("marker-index")+1+"");r.stores_markers.push(t);t.info=new google.maps.InfoWindow({content:$(this).find(".store_description").html()!=""?$(this).find(".store_description").html():$(this).find(".store_name").html()});google.maps.event.addListener(t,"click",function(){var u=t.info.getMap(),i,f;if(!(u!==null&&typeof u!="undefined"))for(r.stores_infowindow&&r.stores_infowindow.close(),r.stores_infowindow=t.info,r.stores_infowindow.open(r.stores_map,t),i=0,f=r.stores_markers.length;i<f;i++)r.stores_markers[i]==t&&($("."+n+"Comp-itemShippingStores").removeClass("activeStore"),$("."+n+"Comp-itemShippingStores").eq(i).addClass("activeStore"),$("."+n+"Comp-resultsShippingStores").scrollTop($("."+n+"Comp-resultsShippingStores").scrollTop()+$("."+n+"Comp-itemShippingStores").eq(i).position().top()-$("."+n+"Comp-itemShippingStores").parent().position().top-$("."+n+"Comp-resultsShippingStores").height()/2+$("."+n+"Comp-itemShippingStores").eq(i).height()/2))})}else console.log("Il Negozio con id: "+$(this).data("store-code")+" non trovato")});else if($(this).data("latitude")!=""){f=new google.maps.LatLng($(this).data("latitude"),$(this).data("longitude"));t.setMap(r.stores_map);t.setPosition(f);t.setLabel($(this).data("marker-index")+1+"");r.stores_markers.push(t);t.info=new google.maps.InfoWindow({content:$(this).find(".store_description").html()!=""?$(this).find(".store_description").html():$(this).find(".store_name").html()});try{google.maps.event.addListener(t,"click",function(){var u=t.info.getMap(),i,f;if(!(u!==null&&typeof u!="undefined"))for(r.stores_infowindow&&r.stores_infowindow.close(),r.stores_infowindow=t.info,r.stores_infowindow.open(r.stores_map,t),i=0,f=r.stores_markers.length;i<f;i++)r.stores_markers[i]==t&&($("."+n+"Comp-itemShippingStores").removeClass("activeStore"),$("."+n+"Comp-itemShippingStores").eq(i).addClass("activeStore"),$("."+n+"Comp-resultsShippingStores").scrollTop($("."+n+"Comp-resultsShippingStores").scrollTop()+$("."+n+"Comp-itemShippingStores").eq(i).position().top()-$("."+n+"Comp-itemShippingStores").parent().position().top-$("."+n+"Comp-resultsShippingStores").height()/2+$("."+n+"Comp-itemShippingStores").eq(i).height()/2))})}catch(u){console.log(u)}}else console.log("Il Negozio con id: "+$(this).data("store-code")+" ha dati mancanti")}catch(u){alert(u);console.log(u)}}),r.stores_bounds=new google.maps.LatLngBounds,t=0;t<r.stores_markers.length;t++)r.stores_bounds.extend(r.stores_markers[t].position),r.stores_map.fitBounds(r.stores_bounds);r.stores_map.setCenter(r.stores_bounds.getCenter());r.stores_map.setZoom(r.stores_map.getZoom()-1);i=google.maps.event.addListener(r.stores_map,"idle",function(){r.stores_map.getZoom()>12&&r.stores_map.setZoom(12);google.maps.event.trigger(r.stores_map,"resize");google.maps.event.removeListener(i)})},ci=function(n){$("#"+n+"Comp-dlstores").hide("slow");$("#"+n+"Comp-dlstores .regionStore").empty();$("#"+n+"Comp-dlstores .regionStore").attr("data-nation","");$("#"+n+"Comp-dlstores ."+n+"Comp-itemsStores").children().remove();$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").hide();$("#"+n+"Comp-dlstores ."+n+"Comp-errorStores").html("")},r.getPickupPoints=function(n,i,u){var f;if(n!=null){f=t.getParamsId($("."+i+"Comp").attr("id")).id;$("#"+i+"Comp-dlstores .searchStores").hide();$("#"+i+"Comp-dlstores .title_stores").hide();$("#"+i+"Comp-dlstores .title_pickupPoints").show();$("#"+i+"Comp-dlstores .searchPickupPoints").show();var e=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+i+"Comp-"+f+"-address option:selected").val(),o=$("#"+i+"Comp-"+f+"-city_pudo").val(),s=$("#"+i+"Comp-"+f+"-cap_pudo").val();(!0||$("#"+i+"Comp-"+f+"-shipping input:radio:checked").val()!=null&&e!=null&&e!=0)&&$.ajax({type:"POST",url:"/Async/Checkout/GetPickupPoints",data:{_servicePickupPoints:n,_address:e,_shipping:$("#"+i+"Comp-"+f+"-shipping input:radio:checked").val(),_classComponent:i,_isMobile:!1,_localita:o,_cap:s},dataType:"json",error:t.onAsyncError,success:function(n){n!=""?n?($("#"+i+"Comp-dlstores .regionStore").empty(),$("#"+i+"Comp-dlstores .regionStore").append(n[0]),$("#"+i+"Comp-dlstores .regionStore").attr("data-nation",n[2]),$("#"+i+"Comp-dlstores .regionStore").unbind("change"),$("#"+i+"Comp-dlstores ."+i+"Comp-itemsStores").children().remove(),$("#"+i+"Comp-dlstores ."+i+"Comp-itemsStores").append(n[1]),$("#"+i+"Comp-dlstores ."+i+"Comp-itemsStores").attr("id","itemsShippingStores_"+n[3]),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").hide(),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").html(""),r.searchStore(i,u),$("#"+i+"Comp-dlstores .regionStore").val($("#"+i+"Comp-dlstores .regionStore").val()).trigger("change"),$("#"+i+"Comp-dlstores").show("slow")):($("#"+i+"Comp-dlstores").hide("slow"),$("#"+i+"Comp-dlstores .regionStore").empty(),$("#"+i+"Comp-dlstores .regionStore").attr("data-nation",""),$("#"+i+"Comp-dlstores ."+i+"Comp-itemsStores").children().remove(),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").hide(),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").html("")):($("#"+i+"Comp-dlstores").hide("slow"),$("#"+i+"Comp-dlstores .regionStore").empty(),$("#"+i+"Comp-dlstores .regionStore").attr("data-nation",""),$("#"+i+"Comp-dlstores ."+i+"Comp-itemsStores").children().remove(),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").hide(),$("#"+i+"Comp-dlstores ."+i+"Comp-errorStores").html(""))}})}},r.getPaymentModes=function(n,u,f,e){var o=t.getParamsId($("."+f+"Comp").attr("id")).id,h=$("#"+f+"Comp-"+o+"-typeDocument input:checked").val(),c;h==null&&(h=$("#"+f+"_"+o+" [name=typeDocument]").val());var l=$("#"+f+"Comp-"+o+"-shipping input:radio:checked").val(),s=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+f+"Comp-"+o+"-address option:selected").val(),a=null;$("#"+f+"Comp-"+o+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-pickup")=="true"&&($("."+f+"Comp-itemsStores li.selectedStore").each(function(){a=$(this).attr("data-store-code")}),a==null&&$("."+f+"Comp-itemsStores li").length>0&&$("."+f+"Comp-errorStores").length>0&&($("."+f+"Comp-errorStores").html($("#"+f+"Comp-"+o+"-shipping li.selectedShipping").attr("data-error-message")),$("."+f+"Comp-errorStores").show(),c=$("."+f+"Comp-itemsStores").parents('[data-action="checkout-accordion"]'),$(c).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(c).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale))||(s==0&&(s=null),!0||s!=null||s==null&&$("#"+f+"_"+o).hasClass("noaddress")?($("#"+f+"Comp-"+o+"-nobilling").hide(),t.addLoadingPanel("."+f+"Comp","checkout"),$.ajax({type:"POST",url:"/Async/Checkout/GetBilling",data:{_tipologia:h,_address:s!=null?s:0,_shipping:l==null?null:l,_classComponent:f},dataType:"json",error:function(n,i,r){t.removeLoadingPanel("."+f+"Comp","checkout");t.onAsyncError(n,i,r)},success:function(s){if(t.removeLoadingPanel("."+f+"Comp","checkout"),$("#"+f+"Comp-billing").children().remove(),s!=""){s.length==0&&($("#"+f+"Comp-"+o+"-nobilling").show(),$("#modalNoPayment").length>0&&$.jGrowl($("#modalNoPayment").attr("data-testo"),{sticky:!0}));var h=0;for(i=0;i<s.length;i++)$("<li id='billing_item_"+s[i].id+"' class='billing_item"+(_isResponsive?" list-group-item":"")+"'>"+(_isResponsive?"<div class='form-check'><label class='form-check-label'>":"")+"<input type='radio' value='"+s[i].id+"' "+(s[i].selected?"checked='checked'":"")+" name='billing' "+(_isResponsive?"class='form-check-input'":"")+">"+s[i].descrizione_costo+s[i].descrizione_dettagli+(s[i].oneclick!=null?"<div id='billingcard_"+s[i].id+"' class='billingcard' "+(s[i].selected?"":"style='display:none'")+">"+s[i].oneclick+"<\/div>":"")+(s[i].extraData!=undefined&&s[i].extraData!=null?"<div id='billingcard_extradata_"+s[i].id+"' class='billingcard_extradata' >"+s[i].extraData+"<\/div>":"")+"<\/input>"+(_isResponsive?"<\/label><\/div>":"")+"<\/li>").appendTo("#"+f+"Comp-billing"),s[i].selected&&(h=i);s.length>0&&($('input[name="billing"]')[h].checked=!0);n!=null&&r.goToStep($("."+f+'Comp-accordion[data-action="checkout-accordion"]'),n);u&&r.getTotalCheckout(f,n!=null?3:0)}else $("#"+f+"Comp-"+o+"-nobilling").show(),e&&n!=null&&r.goToStep($("."+f+'Comp-accordion[data-action="checkout-accordion"]'),n),u&&r.getTotalCheckout(f,n!=null?3:0),ii&&$("#modalNoPayment").length>0&&$.jGrowl($("#modalNoPayment").attr("data-testo"),{sticky:!0}),ii=!0}})):u&&r.getTotalCheckout(f,n!=null?3:0))},r.setLine=function(n){$.ajax({type:"POST",url:"/Async/Checkout/SetLine",data:{_line:n},dataType:"json",error:t.onAsyncError,success:function(n){n&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.checkout],null),null,!1,null,null)}})},r.useVoucher=function(n,i,u,f,o){var s=t.getParamsId($("."+u+"Comp").attr("id")).id,h;$("#"+u+"Comp-"+s+"-errorvoucher_cart").hide();$("#"+u+"Comp-"+s+"-errorvoucher").hide();$("#"+u+"Comp-"+s+"-errorvoucherminorder").hide();h=$("#"+u+"Comp-"+s+"-voucher").val();h!=null?$.ajax({type:"POST",url:"/Async/Checkout/VerifyVoucher",data:{_voucher:h},dataType:"json",async:!1,error:t.onAsyncError,success:function(t){t[0]?t[1]?n!=null?(r.goToStep($("."+u+'Comp-accordion[data-action="checkout-accordion"]'),n),i&&r.getTotalCheckout(u,n!=null?1:0)):r.getShippingModes(null,i,!1,u,f,o):$("#"+u+"Comp-"+s+"-errorvoucher").show():($("#"+u+"Comp-"+s+"-voucher").val(""),$("#"+u+"Comp-"+s+"-errorvoucherminorder").show());e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.giftselection],null),null,!1,null,null)}}):(n!=null&&r.goToStep($("."+u+'Comp-accordion[data-action="checkout-accordion"]'),n),i&&r.getTotalCheckout(u,n!=null?1:0))},r.goToStep=function(n,t){var i=$(n).data("typeview-checkout");i==tipologiaCheckout.StepAccordionOrizzontale?($($(n).find(".card").get(parseInt(t,10))).children().show(),$($(n).find(".card").get(parseInt(t,10))).children(".card-header").addClass("active"),$(n).find(".nav-link").each(function(n,i){n>t&&$(i).addClass("disabled")}),$($(n).find("#step-checkout li").get(parseInt(t,10))).children().removeClass("disabled"),$($(n).find("#step-checkout li").get(parseInt(t,10))).children().tab("show"),returnToFirstStep=!1):_isResponsive?($(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")?$(t).removeClass("active"):$(t).slideUp("fast")}),$($(n).find(".card").get(parseInt(t,10))).children().slideDown("slow"),$($(n).find(".card").get(parseInt(t,10))).children(".card-header").addClass("active")):$(n).accordion("option","active",t)},r.checkout=function(n,i){t.checkBraintree(i).then(u=>{var p,s,l,e,c;$(".erroreVoucherNotValid").length!=0&&$(".erroreVoucherNotValid").hide();var f=t.getParamsId($("."+i+"Comp").attr("id")).id,v=$("#"+i+"_"+f).find('[data-action="checkout-accordion"]').data("is-one-step-checkout"),y=$("#"+i+"_"+f).find('[data-action="checkout-accordion"]').data("has-text-condition");if(!y||$("#"+i+"Comp-pre-checkcondition").is(":checked"))p=!0,$("#"+i+"Comp-pre-errorcondition").hide();else return $("#"+i+"Comp-pre-errorcondition").fadeIn("slow"),!1;if(r.checkSetOptions(i),s=$("input[name=choice_address]").length>0&&$.isNumeric($("input[name=choice_address]:checked").val())?$("input[name=choice_address]:checked").val():$("#"+i+"Comp-"+f+"-address option:selected").val(),s==0&&(s=null),$("."+i+"Comp-error:visible").length==0){l=$("#"+i+"Comp-"+f+"-voucher").val();e=$("#"+i+"Comp-"+f+"-typeDocument input:checked").val();e==null&&(e=$("#"+i+"_"+f+" [name=typeDocument]").val());var a=$("#"+i+"Comp-"+f+"-shipping input:radio:checked").val(),h=n?$("#"+i+"Comp-billing input[name=billing]:radio:checked").val():$("#"+i+"Comp-billing:visible input[name=billing]:radio:checked").val(),o=null;if(($("#"+i+"Comp-"+f+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-pickup")=="true"||$("#"+i+"Comp-"+f+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!=null&&$("#"+i+"Comp-"+f+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="0"&&$("#"+i+"Comp-"+f+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="null")&&($("."+i+"Comp-itemsStores li.selectedStore").each(function(){o=$(this).attr("data-store-code")}),o==null&&$("."+i+"Comp-itemsStores li").length>0))return $("."+i+"Comp-errorStores").html($("#"+i+"Comp-"+f+"-shipping li.selectedShipping").attr("data-error-message")),$("."+i+"Comp-errorStores").show(),$("."+i+"Comp-itemsStores").show(),$("."+i+"Comp-dlstores").show(),t.scrollTo($($("."+i+"Comp-errorStores")[0]).offset().top),!1;c=[];$("#"+i+"Comp-dlcharges input[type='checkbox']").each(function(){$(this).is(":checked")&&c.push($(this).val())});var w=$("#"+i+"Comp-billing input[name='billingcard_"+h+"']:checked").val(),b=$("#"+i+"Comp-billing input[name='remembercard_"+h+"']:checked").val(),k=$("#"+i+"_"+f+" input[name=giftcardbalance]").length>0?$("#"+i+"_"+f+" input[name=giftcardbalance]").prop("checked"):!1,d=$("#"+i+"_"+f+" input[name=pointsbalance]").length>0?$("#"+i+"_"+f+" input[name=pointsbalance]").prop("checked"):!1,g=$("#"+i+"Comp-"+f+"-deliverydate").val(),nt=$("#"+i+"Comp-"+f+"-deliveryhours").val(),tt=$("#"+i+"Comp-billing input[name=findomestic_prf]:checked").val(),it=$("#"+i+"Comp-billing input[name=findomestic_code_finalita]").val(),rt=$("#"+i+"_"+f+" [name=setOptionsConfiguration]").val();t.addLoadingPanel("."+i+"Comp");$.ajax({type:"POST",url:"/Async/Checkout/ShowOrder",data:{_typeOrder:e==null?0:e,_note:$("#"+i+"Comp-"+f+"-note").val(),_codeExternal:$("#"+i+"Comp-"+f+"-sigladocesterno").val(),_numExternal:$("#"+i+"Comp-"+f+"-numerodocesterno").val(),_dateExternal:$("#"+i+"Comp-"+f+"-datadocesterno").val(),_dateExpire:$("#"+i+"Comp-"+f+"-datascad").val(),_causalOrder:$("#"+i+"Comp-"+f+"-causale").val(),_voucher:l,_address:s,_shipping:a==null?null:a,_store:o==null?null:o,_pickupPoint:o,_billing:h==null?null:h,_giftcardBalance:k,_pointsBalance:d,_charges:JSON.stringify(c),_card:w,_remembercard:b,_componentId:f,_deliverydate:g,_deliveryhours:nt,_findomestic_prf:tt,_findomestic_code_finalita:it,_braintree_paymentnonce:u!=null?u.nonce:null,_braintree_paymentdevicedata:u!=null?u.deviceData:null,_options:rt},dataType:"json",error:function(n,r,u){t.removeLoadingPanel("."+i+"Comp");t.onAsyncError(n,r,u)},success:function(u){t.removeLoadingPanel("."+i+"Comp");u==0?window.location.href=window.location.href:v?r.confirm(u,!1,i):window.location.href="/store/cart/checkout/progress?id="+u+(n?"&pp=1":"")}})}else t.scrollTo($($("."+i+"Comp-error:visible")[0]).offset().top)})},r.gotoPayPalCheckoutExpress=function(){var n={_idPagamento:$("#payPalCheckoutExpressPaymentId").val(),_totalCart:$("#totalorder").length>0?$("#totalorder").val():$("#subtotalorder").val()};$.ajax({type:"POST",url:"/Async/Cart/goToPayPalCheckoutExpress",data:n,dataType:"json",error:t.onAsyncError,success:function(n){n[1]!=""?$.jGrowl(n[1]):window.location.href=n[0]}})},r.confirm=function(n,i,r){!i||$("#"+r+"Comp-checkcondition").is(":checked")?(t.addLoadingPanel("."+r+"Comp"),window.location.href="/store/cart/checkout/confirm/"+n):$("#"+r+"Comp-errorcondition").fadeIn("slow")},r.showContent=function(n){_isResponsive?alert("TODO Checkout.showContent"):$('.ecCheckoutComp-accordion[data-action="checkout-accordion"]').accordion("option","active",n)},r.editAttachment=function(n){$(n).closest(".documentattachment").find("input[type='file']").click()},r.bindAttachment=function(){$('.documentattachment input[type="file"]').each(function(){$(this).ajaxfileupload({params:{_pageId:$(this).data("pageid"),_componentId:$(this).data("id")},action:"/Async/Checkout/UploadAttachment",validate_extensions:!1,onComplete:function(n){t.removeLoadingPanel("#"+$(this).closest(".attachmentlist").attr("id"));var i=$(this).closest(".documentattachment");$(i).find(".filecontrol").removeClass("progressfile");$(i).find(".fileloading").hide();$(i).find("input[type=file]").val("");n.messaggio==""?$(this).closest(".attachmentlist").replaceWith(n.template):($(i).find(".attachmenterror").html(n.messaggio),$(i).find(".attachmenterror").show(),$(i).find(".selectfile").show())},onStart:function(){t.addLoadingPanel("#"+$(this).closest(".attachmentlist").attr("id"));var n=$(this).closest(".documentattachment");$(n).find(".filecontrol").addClass("progressfile");$(n).find(".selectfile").hide();$(n).find(".fileloading").show()}})})},r.deleteAttachment=function(n){t.addLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));$.ajax({type:"POST",url:"/Async/Checkout/DeleteAttachment",data:{_pageId:$(n).data("pageid"),_componentId:$(n).data("id"),_idAttachment:$(n).data("attachmentid")},dataType:"json",error:function(i,r,u){t.removeLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));t.onAsyncError(i,r,u)},success:function(t){$(n).closest(".attachmentlist").replaceWith(t)}})},r.updateAttachment=function(n){$.ajax({type:"POST",url:"/Async/Checkout/UpdateAttachment",data:{_pageId:$(n).data("pageid"),_componentId:$(n).data("id"),_idAttachment:$(n).data("attachmentid"),_note:$(n).val()},dataType:"json",error:Site.global.onAsyncError})},r.manageAttachment=function(n){t.addLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));$.ajax({type:"POST",url:"/Async/Checkout/ManageAttachment",data:{_pageId:$(n).data("pageid"),_componentId:$(n).data("id")},dataType:"json",error:function(i,r,u){t.removeLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));t.onAsyncError(i,r,u)},success:function(t){$(n).closest(".attachmentlist").replaceWith(t);r.bindAttachment()}})},r.saveAttachment=function(n){var i=$("#"+$(n).closest(".attachmentlist").attr("id")+" ."+$(n).data("classe")+"Comp-error:visible").length>0;i||(t.addLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id")),$.ajax({type:"POST",url:"/Async/Checkout/SaveAttachment",data:{_pageId:$(n).data("pageid"),_componentId:$(n).data("id")},dataType:"json",error:function(i,r,u){t.removeLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));t.onAsyncError(i,r,u)},success:function(i){t.removeLoadingPanel("#"+$(n).closest(".attachmentlist").attr("id"));i.messaggio!=""?$.jGrowl(i.messaggio):$(n).closest(".attachmentlist").replaceWith(i.template)}}))},r.checkAttachment=function(n){return $(".attachmentlist ."+n+"Comp-error:visible").length==0},r.checkSetOptions=function(n){if($("."+n+"Comp .quicksetoptions:visible").length>0){var i=$("."+n+"Comp .quicksetoptions").find("form").data("cellidentifier"),t=st.sumbitForm(i);return $("."+n+"Comp [name=setOptionsConfiguration]").val(t),$("."+n+"Comp .quicksetoptions .formfield_error").addClass(n+"Comp-error"),t!=null}return!0},r.getOrdersCausal=function(n,i){var r=t.getParamsId($("."+n+"Comp").attr("id")).id;$("#"+n+"Comp-"+r+"-causale").length>0&&$.ajax({type:"POST",url:"/Async/Checkout/GetOrdersCausal",data:{_typeDocument:i,_causal:$("#"+n+"Comp-"+r+"-causale").val()},dataType:"json",error:t.onAsyncError,success:function(t){var i,u;if($("#"+n+"Comp-"+r+"-causale").empty(),t.length>0){for(i=0;i<t.length;i++)u=$("<option><\/option>").attr("value",t[i].entry_id).text(t[i].entry_text),t[i].entry_selected&&u.attr("selected","selected"),$("#"+n+"Comp-"+r+"-causale").append(u);$("."+n+"Comp-orderscausal-container").show()}else $("."+n+"Comp-orderscausal-container").hide()}})},r.handleAction=function(){var t,n;switch($(this).data("action")){case"validppcheckoutexpress":$.ajax({type:"POST",url:"/Async/Checkout/ValidPayPalExpressCheckout/",data:{_code:$(".codepp").val(),_payerId:$(".pppayerid").val()},dataType:"json",error:Site.global.onAsyncError,success:function(n){n[1]!=null&&n[1]!=""?($.jGrowl(n[1]),$(".codepp").val("")):window.location.href=n[0]}});break;case"setLine":r.setLine($(this).data("line"));break;case"externalref":return Site.misc.isExternalReference(event);case"gotostepcheckoutPills":n=$(this).parents('[data-action="checkout-accordion"]');t=$(this).parent().index();r.goToStep(n,t);break;case"gotostepcheckoutPrev":n=$(this).parents('[data-action="checkout-accordion"]');t=$(this).data("content-step");switch($(this).data("name-step")){case"Doc":case"DocInfo":case"Attachment":case"Note":case"ExternalReference":case"Voucher":case"AddressShipping":case"MethodShipping":case"MethodPayment":r.goToStep(n,t)}break;case"gotostepcheckoutNext":n=$(this).parents('[data-action="checkout-accordion"]');t=$(this).data("content-step");switch($(this).data("name-step")){case"UserInfo":r.updateInfoUser(n,t);break;case"Note":r.checkSetOptions($(n).data("class"))&&r.goToStep(n,t);break;case"Doc":case"ExternalReference":r.goToStep(n,t);break;case"DocInfo":r.checkSetOptions($(n).data("class"))&&r.checkAttachment($(n).data("class"))&&r.goToStep(n,t);break;case"Attachment":r.checkAttachment($(n).data("class"))&&r.goToStep(n,t);break;case"Voucher":r.useVoucher(t,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("has-googlemaps"),$(n).data("allow-no-shipping"));break;case"AddressShipping":$(n).data("has-content-shipping")?$("."+$(n).data("class")+"Comp-address :selected").val()!=null?r.getShippingModes(t,$(n).data("viewtotalcheckout"),!1,$(n).data("class"),$(n).data("has-googlemaps"),$(n).data("allow-no-shipping")):window.location.href=$(n).data("profile"):$(n).data("has-content-payment")?r.getPaymentModes(t,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("allow-no-payment")):$(n).data("is-paypalexpress")?r.checkout(!0,$(n).data("class")):r.checkout(!1,$(n).data("class"));break;case"MethodShipping":$(n).data("has-webtracking")&&Site.PWT.loadStepCheckout(2,1,$(n).data("class"));$(n).data("has-content-payment")?r.getPaymentModes(t,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("allow-no-payment")):$(n).data("is-paypalexpress")?r.checkout(!0,$(n).data("class")):r.checkout(!1,$(n).data("class"));break;case"MethodPayment":$(n).data("has-webtracking")&&Site.PWT.loadStepCheckout($(n).data("has-content-shipping")?3:2,2,$(n).data("class"));$(n).data("is-paypalexpress")?r.checkout(!0,$(n).data("class")):r.checkout(!1,$(n).data("class"))}break;case"applyvoucher":n=$(this).parents(".ecCheckoutComp, .ecCheckoutCustomComp").find('[data-action="checkout-accordion"]');r.useVoucher(null,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("has-googlemaps"),$(n).data("allow-no-shipping"));break;case"confirmcheckout":n=$(this).parents(".ecCheckoutComp, .ecCheckoutCustomComp").find('[data-action="checkout-accordion"]');$(n).data("has-content-shipping")&&$(n).data("has-webtracking")&&Site.PWT.loadStepCheckout(2,1,$(n).data("class"));$(n).data("has-content-payment")&&$(n).data("has-webtracking")&&Site.PWT.loadStepCheckout($(n).data("has-content-shipping")?3:2,2,$(n).data("class"));$(n).data("has-content-userinfo")&&($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).find(".userregistrationComp-form").length>0?r.updateInfoUser(n,null):r.checkout(!1,$(n).data("class"));break;case"addArticlesToCart":Site.orders.addArticlesToCart($(this).data("orderid"));break;case"addItemFromMatrice":Site.cart.addItemFromMatrice($(this).data("entryid"),$(this).data("add-type"));break;case"confirm":Site.checkout.confirm($(this).data("orderid"),$(this).data("has-text-condition"),$(this).data("class"));break;case"loadTransaction":Site.PWT.loadTransaction($(this).data("analytics-ecommerce"),$(this).data("analytics-orderid"));break;case"editAttachment":if(_isApp)try{window.PWBAppController&&(window.PWBAppController.onInputPicker($(this).closest(".documentattachment").find("input[type='file']").data("id"),!0)||r.editAttachment(this))}catch(e){}else r.editAttachment(this);break;case"updateAttachment":r.updateAttachment(this);break;case"removeAttachment":r.deleteAttachment(this);break;case"manageAttachment":r.manageAttachment(this);break;case"saveAttachment":r.saveAttachment(this);break;case"copylinkgiftcode":gt.copy($(this).data("link"));$(this).attr("data-original-title",$(this).data("copy")).tooltip("show").delay(200).removeAttr("data-original-title");break;case"searchPickupPoints":n=$(this).parents('[data-action="checkout-accordion"]');r.getPickupPoints($(".selectedShipping").data("shipping-service-pickup-points"),$(n).data("class"),$(n).data("has-googlemaps"))}},r.registerHandlers=function(){$(document).on("click",'.ecCheckoutComp [data-action="validppcheckoutexpress"], .ecCheckoutCustomComp [data-action="validppcheckoutexpress"], .ecCheckoutComp [data-action="copylinkgiftcode"], .ecCheckoutCustomComp [data-action="copylinkgiftcode"]',r.handleAction);$(document).on("click",'.ecCheckoutCustomComp [data-action="editAttachment"], .ecCheckoutCustomComp [data-action="removeAttachment"], .ecCheckoutCustomComp [data-action="manageAttachment"], .ecCheckoutCustomComp [data-action="saveAttachment"]',r.handleAction);$(document).on("change",'.ecCheckoutCustomComp [data-action="updateAttachment"]',r.handleAction);$(document).on("click",'.ecCheckoutComp [data-action="setLine"], .ecCheckoutCustomComp [data-action="setLine"]',r.handleAction);$(document).on("keypress",'.ecCheckoutComp [data-action="externalref"], .ecCheckoutCustomComp [data-action="externalref"]',r.handleAction);$(document).on("click",'.ecCheckoutComp [data-action="gotostepcheckoutNext"], .ecCheckoutCustomComp [data-action="gotostepcheckoutNext"]',r.handleAction);$(document).on("click",'.ecCheckoutComp [data-action="gotostepcheckoutPrev"], .ecCheckoutCustomComp [data-action="gotostepcheckoutPrev"]',r.handleAction);$(document).on("click",'.ecCheckoutCustomComp [data-action="gotostepcheckoutPills"]',r.handleAction);$(document).on("click",'.ecCheckoutComp [data-action="applyvoucher"], .ecCheckoutCustomComp [data-action="applyvoucher"]',r.handleAction);$(document).on("click",".ecCheckoutCustomComp #btnRiepilogo",function(){$(this).closest(".ecCheckoutCustomComp").find(".summaryArticles").toggleClass("hideMobileSummary")});$(document).on("change",".ecCheckoutComp input[type=radio][name=typeDocument], .ecCheckoutCustomComp input[type=radio][name=typeDocument]",function(){var n=$(this).parents('[data-action="checkout-accordion"]');Site.checkout.getOrdersCausal($(n).data("class"),$(this).val());$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale||($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).data("has-content-payment")&&Site.checkout.getPaymentModes(null,$(n).data("viewtotalcheckout"),$(n).data("class"),$(n).data("allow-no-payment"))});$(document).on("change",".ecCheckoutComp .ecCheckoutComp-address, .ecCheckoutCustomComp .ecCheckoutCustomComp-address, .ecCheckoutCustomComp:not(.onepagecheckout) input[type=radio][name=choice_address]",function(){!$(this).is("[name=choice_address]")&&$("input[name=choice_address]").length>0&&$("input[name=choice_address][value='SA']").prop("checked",!0);var n=$(this).parents('[data-action="checkout-accordion"]');$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale||($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).data("has-content-shipping")&&Site.checkout.getShippingModes(null,$(n).data("has-content-payment")?!1:$(n).data("viewtotalcheckout")?!0:!1,$(n).data("has-content-payment"),$(n).data("class"),$(n).data("has-googlemaps"),$(n).data("allow-no-shipping"))});$(document).on("click",".ecCheckoutComp input[type=radio][name=shipping], .ecCheckoutCustomComp input[type=radio][name=shipping]",function(){var n=$(this).parents('[data-action="checkout-accordion"]');$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale?($("."+$(n).data("class")+"Comp-itemsShipping li").removeClass("selectedShipping"),$(this).parents("li").addClass("selectedShipping"),r.getCharges($(n).data("class"),$(n).data("viewtotalcheckout"),1),r.getDelivery($(n).data("class")),$(this).parents("li").data("shipping-service-pickup-points")==0||$(this).parents("li").data("shipping-service-pickup-points")==null||$(this).parents("li").data("shipping-service-pickup-points")=="null"?r.getStores($(n).data("class"),$(n).data("has-googlemaps")):r.getPickupPoints($(this).parents("li").data("shipping-service-pickup-points"),$(n).data("class"),$(n).data("has-googlemaps"))):($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&($("."+$(n).data("class")+"Comp-itemsShipping li").removeClass("selectedShipping"),$(this).parents("li").addClass("selectedShipping"),r.getCharges($(n).data("class"),$(n).data("viewtotalcheckout"),0),r.getDelivery($(n).data("class")),$(this).parents("li").data("shipping-service-pickup-points")==0||$(this).parents("li").data("shipping-service-pickup-points")==null||$(this).parents("li").data("shipping-service-pickup-points")=="null"?($("."+$(n).data("class")+"Comp-searchPickupPoints").hide(),$("."+$(n).data("class")+"Comp-searchStores").show(),r.getStores($(n).data("class"),$(n).data("has-googlemaps"))):($("."+$(n).data("class")+"Comp-searchStores").hide(),$("."+$(n).data("class")+"Comp-searchPickupPoints").show(),r.getPickupPoints($(this).parents("li").data("shipping-service-pickup-points"),$(n).data("class"),$(n).data("has-googlemaps"))),$("#"+$(n).data("class")+"Comp-itemsShipping li").removeClass("selectedShipping"))});$(document).on("change",".ecCheckoutComp .ecCheckoutComp-dlcharges input[type='checkbox'], .ecCheckoutCustomComp .ecCheckoutCustomComp-dlcharges input[type='checkbox']",function(){var n=$(this).parents('[data-action="checkout-accordion"]');$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale?$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),2):($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),0)});$(document).on("change",".ecCheckoutComp input[type=radio][name=billing], .ecCheckoutCustomComp input[type=radio][name=billing]",function(){$(".billingcard").hide("slow");$("#billingcard_"+$(this).val()).show("slow");$(".divPaymentBraintree").hide("slow");$("#divPaymentBraintree_"+$(this).val()).show("slow");var n=$(this).parents('[data-action="checkout-accordion"]');$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale?$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),3):($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),0)});$(document).on("change",".ecCheckoutCustomComp input[type=checkbox][name=giftcardbalance], .ecCheckoutCustomComp input[type=checkbox][name=pointsbalance]",function(){var n=$(this).parents('[data-action="checkout-accordion"]');$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(n).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale?$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),3):($(n).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(n).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&$(n).data("viewtotalcheckout")&&r.getTotalCheckout($(n).data("class"),0)});$(document).on("change",".ecCheckoutCustomComp .bookAddressBilling, .ecCheckoutCustomComp .bookAddressShipping, .ecCheckoutCustomComp .ecCheckoutCustomComp-address",function(){var n=$(this).closest(".ecCheckoutCustomComp");n.find(".textPickupPointsCity").length>0&&n.find(".textPickupPointsCity").val("");n.find(".textPickupPointsCap").length>0&&n.find(".textPickupPointsCap").val("");n.find(".textPickupPointsAddress").length>0&&n.find(".textPickupPointsAddress").val("");n.find(".textPickupPointsDistance").length>0&&(n.find(".textPickupPointsDistance").val(""),n.find(".labelPickupPointsDistanceValue").text("0 km"))});$(document).on("input",".ecCheckoutCustomComp .textPickupPointsDistance",function(){var n=$(this).val();(n>50||n=="50.")&&$(this).val(n.substring(0,n.length-1))});$(".textPickupPointsDistance").limitkeypress({numberRexp:10});$(document).on("change",".ecCheckoutCustomComp .userregistrationComp input, .ecCheckoutCustomComp .userregistrationComp select",r.userRegistrationEvent);$(document).on("click",'.ecCheckoutComp [data-action="toggleDetails"], .ecCheckoutCustomComp [data-action="toggleDetails"]',t.toggleDetails);$(document).on("click",'.ecCheckoutComp [data-action="confirmcheckout"], .ecCheckoutCustomComp [data-action="confirmcheckout"]',r.handleAction);$(document).on("click",'.ecCheckoutComp [data-action="searchPickupPoints"], .ecCheckoutCustomComp [data-action="searchPickupPoints"]',r.handleAction);$(document).on("click",'.ecCheckoutComp-checkoutHead [data-action="addArticlesToCart"], .ecCheckoutCustomComp-checkoutHead [data-action="addArticlesToCart"]',r.handleAction);$(document).on("click",'.ecCheckoutComp-checkoutTable [data-action="addItemFromMatrice"], .ecCheckoutCustomComp-checkoutTable [data-action="addItemFromMatrice"]',r.handleAction);$(document).on("click",'.ecCheckoutComp-checkoutFooter [data-action="confirm"], .ecCheckoutCustomComp-checkoutFooter [data-action="confirm"]',r.handleAction);r.bindAttachment()},r.userRegistrationEvent=function(n,t){(t==null||t==undefined)&&(t=$(this));var f=t.parents('[data-action="checkout-accordion"]'),i=!0,u=!1;(t.attr("name")=="bookAddressBilling"||t.attr("name")=="bookAddressShipping")&&(t.val()==""?(t.parents(".userregistrationComp").find(t.attr("name")=="bookAddressBilling"?"[name=state], [name=district]":"[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4]").each(function(n,t){$($(t).parents(".selectfieldComp")).show();$($($(t).parents(".selectfieldComp")).find("select")).val("")}),t.parents(".userregistrationComp").find(t.attr("name")=="bookAddressBilling"?"[name=address], [name=city], [name=cap], [name=phone_address], [name=fax_address], [name=mail_address], [name=nominative_address]":"[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).show();$($($(t).parents(".textfieldComp")).find("input")).val("")})):(t.parents(".userregistrationComp").find(t.attr("name")=="bookAddressBilling"?"[name=state], [name=district]":"[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4]").each(function(n,t){$($(t).parents(".selectfieldComp")).hide()}),t.parents(".userregistrationComp").find(t.attr("name")=="bookAddressBilling"?"[name=address], [name=city], [name=cap], [name=phone_address], [name=fax_address], [name=mail_address], [name=nominative_address]":"[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).hide()})));$(".ecCheckoutCustomComp input[name^=address], .ecCheckoutCustomComp input[name^=city], .ecCheckoutCustomComp input[name^=cap], .ecCheckoutCustomComp select[name^=district], .ecCheckoutCustomComp select[name^=state]").each(function(n,t){$(t).is(":visible")&&$(t).val()==""&&(i=!1,u=!0)});$(".ecCheckoutCustomComp select[name=bookAddressBilling]").each(function(n,t){$(t).val()!=""?$(".ecCheckoutCustomComp [name=same_shipaddress]").lenth>0&&$(".ecCheckoutCustomComp [name=same_shipaddress]").is(":checked")&&$(".ecCheckoutCustomComp [name=choice_address]").lenth>0&&$(".ecCheckoutCustomComp [name=choice_address]:checked").val()!="NA"?u&&(i=!0):u&&(i=!1):i=u?!1:!0});$(".ecCheckoutCustomComp select[name=bookAddressShipping]").each(function(n,t){$(t).is(":visible")&&$(t).val()==""?i=u?!1:!0:$(t).is(":visible")&&$(t).val()!=""&&(i=!0)});_isResponsive?(t.is("input:checkbox:not([name=same_shipaddress],[name=privacy])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("input:radio:not([name=choice_address],[name=accounttype],[name=choice_publiccompany],[name=choice_physicalperson])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("input:text:not([name^=address],[name^=city],[name^=cap])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("select:not([name=bookAddressShipping],[name=bookAddressBilling],[name^=state],[name^=district])")&&t.parents(".formfield_field").find(".form-mandatory").length==0)&&(i=!1):(t.is("input:checkbox:not([name=same_shipaddress],[name=privacy])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("input:radio:not([name=choice_address])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("input:not([name^=address],[name^=city],[name^=cap])")&&t.parents(".formfield_field").find(".form-mandatory").length==0||t.is("select:not([name=bookAddressShipping],[name=bookAddressBilling],[name^=state],[name^=district])")&&t.parents(".formfield_field").find(".form-mandatory").length==0)&&(i=t.is("input:checkbox[name=privacy]")&&t.parents(".privacyfieldComp").find(".form-mandatory").length>0||t.parent(".mcRadiofieldComp-field").length==1&&t.closest(".mcRadiofieldComp").find(".form-mandatory").length>0||t.parent(".mcTextfieldComp-field").length==1&&t.closest(".mcTextfieldComp").find(".form-mandatory").length>0?!0:!1);i&&(r.updateInfoUser(f,-1,!1),t.focus())},r.init=function(){$('.ecCheckoutComp-accordion[data-action="checkout-accordion"], .ecCheckoutCustomComp-accordion[data-action="checkout-accordion"]').each(function(){var n,t;$(this).hasClass("initexecuted")||($(this).addClass("initexecuted"),n=!1,$(this).data("checkout-paypalexpress")&&Site.checkout.checkout(!0,$(this).data("class")),($(this).data("typeview-checkout")==tipologiaCheckout.StepAccordion||$(this).data("typeview-checkout")==tipologiaCheckout.StepAccordionOrizzontale)&&$(this).data("init")==null?(_isResponsive?($(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")||$(t).hide()}),r.goToStep($(this),0)):$(this).accordion({event:!1,heightStyle:"content",autoHeight:!1}),$(this).data("init",!0),$(this).data("open-stores")?(r.searchStore($(this).data("class"),$(this).data("has-googlemaps")),$("#"+$(this).data("class")+"Comp-dlstores .regionStore").val($("#"+$(this).data("class")+"Comp-dlstores .regionStore").val()).trigger("change"),$("#"+$(this).data("class")+"Comp-dlstores").show()):$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-pickup")=="true"||$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!=null&&$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="0"&&$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="null"?$("#"+$(this).data("class")+"Comp-dlstores").show():$("#"+$(this).data("class")+"Comp-dlstores").hide(),$(this).data("open-changes")?$("#"+$(this).data("class")+"Comp-dlcharges").show():$("#"+$(this).data("class")+"Comp-dlcharges").hide()):($(this).data("typeview-checkout")==tipologiaCheckout.SenzaStep||$(this).data("typeview-checkout")==tipologiaCheckout.SenzaStepAffiancato)&&(_isResponsive||$(this).addClass("ui-accordion ui-accordion-icons ui-widget ui-helper-reset").find("h3").addClass("ui-accordion-header ui-helper-reset ui-corner-top ui-accordion-header-active ui-state-active ui-state-hover").next().addClass("ui-accordion-content  ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active").show(),$(this).data("open-stores")?(r.searchStore($(this).data("class"),$(this).data("has-googlemaps")),$("#"+$(this).data("class")+"Comp-dlstores .regionStore").val($("#"+$(this).data("class")+"Comp-dlstores .regionStore").val()).trigger("change"),$("#"+$(this).data("class")+"Comp-dlstores").show()):$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-pickup")=="true"||$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!=null&&$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="0"&&$("#"+$(this).data("class")+"Comp-"+$(this).data("identifier")+"-shipping input:radio:checked").parents("li").first().attr("data-shipping-service-pickup-points")!="null"?$("#"+$(this).data("class")+"Comp-dlstores").show():$("#"+$(this).data("class")+"Comp-dlstores").hide(),$(this).data("open-changes")?$("#"+$(this).data("class")+"Comp-dlcharges").show():$("#"+$(this).data("class")+"Comp-dlcharges").hide(),r.getDelivery($(this).data("class")),$(this).data("viewtotalcheckout")&&(n=!0)),$(this).data("has-webtracking")&&Site.PWT.loadStepCheckout(1,0,$(this).data("class")),$(this).data("show-searchaddress")&&(t=$("."+$(this).data("class")+"Comp-address option").clone(),$("."+$(this).data("class")+"Comp-searchaddress").keyup(function(){var i=$(this).val().toLowerCase(),n=$(this).closest('[data-action="checkout-accordion"]').data("class");$("."+n+"Comp-address").empty();t.filter(function(n,t){return i===""||$(t).text().toLowerCase().indexOf(i)>=0}).appendTo("."+n+"Comp-address");$("."+n+"Comp-address").find("option").removeAttr("selected");$("."+n+"Comp-address option:first").attr("selected","selected");$("."+n+"Comp-address").change()})),$(this).show(),$(this).data("has-content-userinfo")&&$(this).find(".userregistrationComp-form").length>0&&y.init(),n&&r.getTotalCheckout($(this).data("class"),0),$(this).data("has-shipping")&&$("input[type='radio'][name='shipping']:checked").click(function(){ii=!1}))});$('.ecCheckoutComp-accordion[data-action="checkout-detail"], .ecCheckoutCustomComp-accordion[data-action="checkout-detail"]').each(function(){$(this).data("has-webtracking")&&Site.PWT.loadStepCheckout($(this).data("stepgaconfirm"),3,$(this).data("class"))});$('.ecCheckoutComp [data-action="loadTransaction"], .ecCheckoutCustomComp [data-action="loadTransaction"]').each(function(){$(this).hasClass("initexecuted")||($(this).addClass("initexecuted"),$(this).data("has-webtracking")&&Site.PWT.loadTransaction($(this).data("analytics-ecommerce"),$(this).data("analytics-orderid")))})},vt=function(){},vt.tryAddItem=function(n,t,i,r,f,e,o,s,h,c,l,v){var p,y;try{if(p=bt.closestToOffset($("#"+r+"_comparator").offset(),$("#"+i+" .addtocartproduct_"+n)),p!=null&&p.length>0){if(_isResponsive){var w=p.attr("id").replace("_","-"),b=r.substring(0,r.indexOf("-"))+"Comp",k=$("#"+r+"_comparator").closest("."+b).attr("id").replace("_","-");r=r.replace(k,w)}y=a.qtaArticle(r,!1,!1,f,o,s,null,!0);y.success&&u.addItem(n,y.quantity,null,y.structure,e,y.options,y.articles,null,r,tipologiaCart.comparator,c,l,v,null,!1,null,null,null,null)}else f||h?t!=""&&(window.location.href=t):u.addItem(n,1,null,null,e,null,null,null,r,tipologiaCart.comparator,c,l,v,null,!1,null,null,null,null)}catch(d){}},vt.removeItem=function(n){n!=0&&$.ajax({type:"POST",url:"/Async/Cart/Remove",data:{_id:n,_tipologia:tipologiaCart.comparator},error:t.onAsyncError,dataType:"json",success:function(n){n!=null&&n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio);e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart],tipologiaCart.comparator),null,!0,null,null)}})},vt.handleAction=function(){switch($(this).data("action")){case"removeItem":vt.removeItem($(this).data("rowid"));break;case"addtocomparator":vt.tryAddItem($(this).data("productid"),$(this).data("permalink"),$(this).data("collector"),$(this).data("identifiercontrol"),$(this).data("has-structure"),$(this).data("parentid"),$(this).data("has-box"),$(this).data("has-options"),$(this).data("has-mandatoryoptions"),$(this).data("redirect"),$(this).data("message"),$(this).data("timeoutmessage"));break;case"emptyComparator":Site.cart.empty(2,null,!1)}},vt.registerHandlers=function(){$(document).on("click",".ecAcomparatorComp [data-action], .ecFieldaddtocomparatorComp [data-action], .ecMinicomparatorComp [data-action]",vt.handleAction)},oi=function(){},oi.registerHandlers=function(){$(document).on("change",'.ecCurrencychangeComp [data-action="changecurrency"]',function(){$(this).parents("form").submit()})},at=function(){},at.editAvatar=function(n){$(n).closest(".avatarfieldComp").find("input[type='file']").click()},at.deleteAvatar=function(n){var i=$(n).closest(".avatarfieldComp").attr("id");$.ajax({type:"POST",url:"/Form/DeleteAvatar",dataType:"json",error:t.onAsyncError,success:function(){Site.updaters.refreshComponent($("#"+i),null,null,null)}})},at.handleAction=function(){switch($(this).data("action")){case"edit":if(_isApp)try{window.PWBAppController&&(window.PWBAppController.onInputPicker($(this).closest(".avatarfieldComp").find("input[type='file']").attr("id"),!1)||at.editAvatar(this))}catch(n){}else at.editAvatar(this);break;case"delete":at.deleteAvatar(this)}},at.registerHandlers=function(){$(document).on("click",".avatarfieldComp [data-action]",at.handleAction);$('.avatarfieldComp .formfield_avatar input[type="file"]').ajaxfileupload({action:"/Form/UploadAvatar",validate_extensions:!1,onComplete:function(n){n.messaggio==""?($(".avatarfieldComp .formfield_avatar .container_avatar img").attr("src",n.pathfile),$(".avatarfieldComp .formfield_avatar .delete").show(),$(".avatarfieldComp .formfield_avatar .message").hide(),$(".avatarfieldComp .formfield_avatar .message").html("")):($(".avatarfieldComp .formfield_avatar .message").html(n.messaggio),$(".avatarfieldComp .formfield_avatar .message").show())},onStart:function(){},onCancel:function(){}})},ot=function(){},ot.editFile=function(n){$(n).closest(".filefieldComp").find("input[type='file']").click()},ot.deleteFile=function(n,i){$.ajax({type:"POST",url:"/Form/DeleteFile",data:{_id:i},dataType:"json",error:t.onAsyncError,success:function(t){if(t){var i=$(n).closest(".filefieldComp");$(i).find("input[type=file]").val("");$(i).find("input[type=hidden]").val("").trigger("change");$(i).find(".filedelete").hide();$(i).find(".filename").hide();$(i).find(".selectfile").show();$(i).find(".formfield_error").hide();$(i).find(".formfield_error").html("")}}})},ot.downloadFile=function(n){$.download("/Form/DownloadFile",{_id:n},"post",t.callbackDownload)},ot.handleAction=function(){switch($(this).data("action")){case"edit":if(_isApp)try{window.PWBAppController&&(window.PWBAppController.onInputPicker($(this).closest(".filefieldComp").find("input[type='file']").data("id"),!0)||ot.editFile(this))}catch(n){}else ot.editFile(this);break;case"delete":ot.deleteFile(this,$(this).data("id"));break;case"download":ot.downloadFile($(this).data("id"))}},ot.registerHandlers=function(){$(document).off("click",".filefieldComp [data-action]").on("click",".filefieldComp [data-action]",ot.handleAction);$('.filefieldComp input[type="file"]').each(function(){$(this).ajaxfileupload({params:{_id:$(this).data("id")},action:"/Form/UploadFile",validate_extensions:!1,onComplete:function(n){var t=$(this).closest(".filefieldComp");$(t).find(".filecontrol").removeClass("progressfile");$(t).find(".fileloading").hide();$(t).find("input[type=file]").val("");n.messaggio==""?($(t).find("input[type=hidden]").val(n.valore).trigger("change"),$(t).find(".filename").text(n.nomefile),$(t).find(".filename").show(),$(t).find(".filedelete").show(),$(t).find(".selectfile").hide(),$(t).find(".formfield_error").hide(),$(t).find(".formfield_error").html("")):($(t).find(".formfield_error").html(n.messaggio),$(t).find(".formfield_error").show(),$(t).find(".selectfile").show())},onStart:function(){var n=$(this).closest(".filefieldComp");$(n).find(".filecontrol").addClass("progressfile");$(n).find(".selectfile").hide();$(n).find(".fileloading").show()}})})},ut=function(){},ut.addCommentCms=function(n){var i=$(n).parents(".cmsFieldcommentsComp").first().attr("id"),u=t.getParamsId(i).id,r;$("#"+i+" .cmsFieldcomments-error").hide();r=null;$("#"+i+" ."+i+"-rating").length>0&&(r=$("."+i+"-rating").raty("score"),typeof r=="undefined"&&(r="0"));$.ajax({type:"POST",url:"/Posts/AddCommentCms",data:{_text:window.btoa(unescape(encodeURIComponent($("#"+i+"  textarea").val()))),_rating:r,_contentId:$("#contentIdTocomment_"+u).val(),_componentId:u},dataType:"json",error:t.onAsyncError,success:function(n){if(n[0]=="OK")$("#"+i+"  textarea").val(""),$("#"+i+" ."+i+"-rating").length>0&&$("."+i+"-rating").raty("reload"),$("#"+i+" .cmsFieldcomments-msgaddcomment").show(400).delay(5e3).hide(400),n[2]||ut.refreshComments(u,$("#contentIdTocomment_"+u).val(),"cms");else if(n[0]=="KO")for(var t=0;t<n[3].length;t++)n[3][t]!=""&&$("#"+i+" .cmsFieldcomments-err-"+n[3][t]).show();else $("#"+i+" .cmsFieldcomments-error-add").show()}})},ut.addCommentArticle=function(n){var i=_isResponsive?$(n).parents(".ecFieldcommentsComp").first().attr("id"):$(n).parent().parent().parent().parent().attr("id"),u=t.getParamsId(i).id,r;$("#"+i+" .ecFieldcomments-error").hide();r=null;$("#"+i+" ."+i+"-rating").length>0&&(r=$("."+i+"-rating").raty("score"),typeof r=="undefined"&&(r="0"));$.ajax({type:"POST",url:"/Posts/AddCommentArticle",data:{_text:window.btoa(unescape(encodeURIComponent($("#"+i+"  textarea").val()))),_rating:r,_contentId:$("#contentIdTocomment_"+u).val(),_componentId:u},dataType:"json",error:t.onAsyncError,success:function(n){if(n[0]=="OK")$("#"+i+"  textarea").val(""),$("#"+i+" ."+i+"-rating").length>0&&$("."+i+"-rating").raty("reload"),$("#"+i+" .ecFieldcomments-msgaddcomment").show(400).delay(5e3).hide(400),n[2]||ut.refreshComments(u,$("#contentIdTocomment_"+u).val(),"ec");else if(n[0]=="KO")for(var t=0;t<n[3].length;t++)n[3][t]!=""&&$("#"+i+" .ecFieldcomments-err-"+n[3][t]).show();else $("#"+i+" .ecFieldcomments-error-add").show()}})},ut.refreshComments=function(n,t,i){var r={_refreshPosts:!0,_reloadPosts:!0,_contentId:t};r["p"+n]=$(".fieldcommentcomp-cells-"+n).data("pagecurrent");r["o"+n]=null;Site.updaters.refreshComponent($("#"+i+"Fieldcomments_"+n),r,"#"+i+"Fieldcomments_"+n+" ."+i+"FieldcommentsComp-comment_container_items",function(){$("."+i+"FieldratingComp").each(function(){rt.refreshRating($(this),t)})})},ut.handleAction=function(){switch($(this).data("action")){case"addCommentCms":ut.addCommentCms(this);break;case"addCommentArticle":ut.addCommentArticle(this);break;case"voteComment":Site.fieldcommentvote.voteComment($(this));break;case"elementforpageComment":Site.pagination.changeElementForPage($(this).val(),$("#"+$(this).data("componentid")));break;case"gotoreview":var n=$(this.hash);n=n.length?n:this.hash.slice(1)!=""?$("[name="+this.hash.slice(1)+"]"):$('[name="gotoreview"]');n.length&&t.scrollTo(n.offset().top)}},ut.registerHandlers=function(){$(document).on("click",'.cmsFieldcommentsComp [data-action][data-action!="elementforpageComment"], .ecFieldcommentsComp [data-action][data-action!="elementforpageComment"]',ut.handleAction);$(document).on("change",'.cmsFieldcommentsComp [data-action="elementforpageComment"], .ecFieldcommentsComp [data-action="elementforpageComment"]',ut.handleAction)},ut.init=function(){$('[data-action="refreshComment"]:not(.initexecuted)').each(function(){var u;$(this).addClass("initexecuted");var n=$(this).data("refresh-time"),t=$(this).data("identifier"),i=$(this).data("comment-id"),r=$(this).data("comment-type");n!=0&&(u=setInterval(function(){ut.refreshComments(t,i,r)},n))});$(".cmsFieldcomments-textarea textarea, .ecFieldcomments-textarea textarea").each(function(){$(this).autosize({append:"\n"})})},ri=function(){},ri.voteComment=function(n){(n==null||n==undefined)&&(n=$(this));var f=n.parent().parent().parent().attr("id"),u=n.hasClass("yesButton")?1:0,i=n.parent().data("post"),r=n.parent().data("type");$.ajax({type:"POST",url:"/Posts/VoteComment",data:{_vote:u,_typeContent:r,_contentId:i},dataType:"json",error:t.onAsyncError,beforeSend:function(){var t=n.parent().next(".votingMessage");t.html($(t).data("texts").loading);n.parent().hide();t.show()},success:function(t){var u;t[0]=="OK"?(u=n.parent().next(".votingMessage"),setTimeout(function(){u.html(t[1])},1e3),$(n.closest(".cell_"+i)).find("."+r+"FieldcommentapprovationComp").each(function(){var n={_refreshPosts:!0,_contentId:i};Site.updaters.refreshComponent($(this),n,null,null)})):(u=$(n).parent().next(".votingMessage"),setTimeout(function(){u.html(t[1])},1e3))}})},ri.registerHandlers=function(){},ct=function(){},ct.registerHandlers=function(){$(document).on("click",".ecFieldfilterindexComp a.filter, .ecFieldfiltertreeviewComp a.filter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=hidden]");$(t).val($(this).data("id"));$(t).attr("data-text",$(this).data("text"));n.find(".ecFieldfilterindexComp-nav .nav-link.dropdown-toggle").html($(this).data("text"));$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("click",".ecFieldfilterindexComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=hidden]");$(t).val("");$(t).attr("data-text","");n.find(".ecFieldfilterindexComp-nav .nav-link.dropdown-toggle").html(n.find(".ecFieldfilterindexComp-nav .nav-link.dropdown-toggle").data("def"));$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("change",".ecFieldfilterlistComp select.filter",function(){var n=$(this).parents("[data-filter='1']");$(n).data("has-cascaded")&&($(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),!0,!1))});$(document).on("click",".ecFieldfilterlistComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']");$(n).find(".dd-container").length>0?$("input#"+$(n).find(".dd-container").data("ddslick").original.attr("id")).val(""):$(n).data("has-default")?$("#"+$(n).find("select").attr("id")+" option[value='']").attr("selected","selected"):$("#"+$(n).find("select").attr("id")).val("");$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this),$(n).data("filter-action"),!0):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("change",".ecFieldfiltersliderComp .slidervalues input",function(){$($(this).parents("[data-filter='1']").find(".slidercontrol")).slider("option",{values:[$(this).parents("[data-filter='1']").find(".minslidervalue").val(),$(this).parents("[data-filter='1']").find(".maxslidervalue").val()]});$($(this).parents("[data-filter='1']").find(".slidertext")).html($(this).parents("[data-filter='1']").data("currency")+$(this).parents("[data-filter='1']").find(".minslidervalue").val()+" - "+$(this).parents("[data-filter='1']").data("currency")+$(this).parents("[data-filter='1']").find(".maxslidervalue").val());$($(this).parents("[data-filter='1']").find("input[type=hidden]")).val($(this).parents("[data-filter='1']").find(".minslidervalue").val()+":"+$(this).parents("[data-filter='1']").find(".maxslidervalue").val())});$(document).on("click",".ecFieldfiltersliderComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=hidden]");$(t).val("");$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!0):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("click",".ecFieldfiltertextComp a.removeFilter, .ecFieldfilterautocompleteComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=text]");$(t).val("");$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this),$(n).data("filter-action"),!0):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("click",".ecFieldfiltertreeviewComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=hidden]");$(t).val("");$(t).attr("data-text","");$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)});$(document).on("click",".ecFieldfiltercheckboxlistComp input.filter",function(){var n=$(this).parents("[data-filter='1']"),i=$(n).find("input[type=hidden]"),t=[];$(n).find("input.filter:checked").each(function(){t.push($(this).val()?$(this).val():"0")});$(i).val(t.join());$(i).attr("data-text",t.join());n.find(".ecFieldfiltercheckboxlistComp-nav .nav-link.dropdown-toggle").html(t.join());$(n).data("has-cascaded")&&($(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),!0,!1))});$(document).on("click",".ecFieldfiltercheckboxlistComp a.removeFilter",function(){var n=$(this).parents("[data-filter='1']"),t=$(n).find("input[type=hidden]");$(t).val("");$(t).attr("data-text","");n.find(".ecFieldfiltercheckboxlistComp-nav .nav-link.dropdown-toggle").html(n.find(".ecFieldfiltercheckboxlistComp-nav .nav-link.dropdown-toggle").data("def"));$(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this).closest(".cascadedcontrol"),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),$(n).data("has-cascaded"),!1)})},ct.ddslickSelection=function(n){var t=$("#"+n.original.attr("id")).parents("[data-filter='1']");$(t).data("has-cascaded")&&($(t).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(t).data("collector")),$(t).data("number-cascaded"),$("#"+n.original.attr("id")),$(t).data("filter-action"),!1):Site.catalog.filter($("#"+$(t).data("collector")),$(t).data("filter-action"),!0,!1))},ct.bindFieldFilter=function(){fi.init();$(".ecFieldfiltersliderComp .slidervalues input").each(function(){$(this).limitkeypress({numberRexp:1})});$(".ecFieldfiltersliderComp .slidercontrol").each(function(){var n=_isResponsive?$($(this).parents(".ecFieldfiltersliderComp-field").first()):$(this).parent();$(this).slider({range:!0,min:0,max:n.data("max-value"),values:[n.data("min-range"),n.data("max-range")],slide:function(t,i){n.find(".slidertext").html(n.data("currency")+i.values[0]+" - "+n.data("currency")+i.values[1]);n.find(".minslidervalue").val(i.values[0]);n.find(".maxslidervalue").val(i.values[1]);n.find("input[type=hidden]").val(i.values[0]+":"+i.values[1])}})});$(".ecFieldfiltertextComp .filter, .ecFieldfilterautocompleteComp .filter").each(function(){var n=$(this).parents("[data-filter='1']");$(n).data("has-placeholder")&&$(this).each(function(){var n=$(this).attr("placeholdervalue");$(this).val()==""&&$(this).val(n);$(this).focus(function(){$(this).val()==n&&$(this).val("")});$(this).blur(function(){$(this).val()==""&&$(this).val(n)})})});$(".ecFieldfilterautocompleteComp .filter").each(function(){var n=$(this).parents("[data-filter='1']");$(this).autocomplete({appendTo:"#"+$($(n).parent()).attr("id"),source:function(t,i){$.ajax({type:"POST",data:{_pageId:$(n).data("pageid"),_pageType:$(n).data("pagetype"),_idCategory:$(n).data("categoryid"),_componentId:$(n).data("identifier"),_filterId:$(n).data("collectorid"),_term:t.term,_cascadedControl:$(n).data("cascadedcontrol")?JSON.stringify($(n).data("cascadedcontrol")):"[]",_fieldType:$(n).data("fieldtype"),_isSetAttribute:$(n).data("has-setattribute"),_specificSetAttribute:$(n).data("specific-setattribute"),_fieldName:$(n).data("fieldname"),_attributeId:$(n).data("attributeid"),_identifier:$(n).data("fieldidentifier"),_resultlength:$(n).data("resultlength"),_link:$(n).data("link"),_location:window.location.pathname,_template:window.btoa(unescape(encodeURIComponent($(n).data("template"))))},url:"/Async/Form/GetAutocompleteOptions",dataType:"json",error:Site.global.onAsyncError,success:function(n){i(n.options)}})},autoFocus:!0,minLength:$(n).data("text-minlengh"),select:function(t,i){i.item&&i.item.link==null&&($(this).val(i.item.value),$(n).data("has-cascaded")&&($(n).data("number-cascaded")>-1?Site.catalog.cascadedfilter($("#"+$(n).data("collector")),$(n).data("number-cascaded"),$(this),$(n).data("filter-action"),!1):Site.catalog.filter($("#"+$(n).data("collector")),$(n).data("filter-action"),!0,!1)))}}).data("ui-autocomplete")._renderItem=function(n,t){return $('<li class="list-group-item '+t.classes+'">').append('<a href="'+(t.link!=null?t.link:"javascript:void(0);")+'">'+t.label+"<\/a>").appendTo(n)}});$(".ecFieldfiltertreeviewComp").each(function(){$(this).off("click",".toggleBranch",w.toggleBranch);$(this).on("click",".toggleBranch",w.toggleBranch)})},ct.init=function(){ct.bindFieldFilter()},rt=function(){},rt.showHistogramReviews=function(n,i,r,u){$.ajax({type:"POST",url:"/Async/GetHistogramReviews",data:{_contentId:r,_typeContent:u},dataType:"json",error:t.onAsyncError,success:function(n){$(".review_histogram_"+i+"_"+r).html(n.data);_isResponsive?$(".review_histogram_"+i+"_"+r).fadeIn(500):$(".review_histogram_"+i+"_"+r).fadeIn(500).css("top",20);$(".review_histogram_"+i+"_"+r).mouseleave(function(){$(".rating_div:hover").length==0&&$(".review_histogram_"+i+"_"+r).fadeOut(500)})}})},rt.hideHistogramReviews=function(n,t){$(".review_histogram_"+n+"_"+t+":hover").length==0&&$(".review_histogram_"+n+"_"+t).fadeOut(500)},rt.hideAllHistogramReviews=function(){$(".review_histogram:hover").length==0&&$(".review_histogram").fadeOut(500)},rt.refreshRating=function(n,t){var i={_refreshPosts:!0,_contentId:t};Site.updaters.refreshComponent($(n),i,null,null)},rt.handleAction=function(){switch($(this).data("action")){case"gotoreview":var n=$(this.hash);n=n.length?n:this.hash.slice(1)!=""?$("[name="+this.hash.slice(1)+"]"):$('[name="gotoreview"]');n.length&&t.scrollTo(n.offset().top)}},rt.registerHandlers=function(){$(document).on("click",".ecFieldratingComp [data-action], .cmsFieldratingComp [data-action]",rt.handleAction)},rt.init=function(){$("body").off("touchstart",rt.hideAllHistogramReviews);$("body").on("touchstart",rt.hideAllHistogramReviews);$(".ecFieldratingComp, .cmsFieldratingComp").each(function(){var t=$(this).find(".container_rating"),n=$(t).data("texttitle");n!=null&&(n=n.replace("@",$(t).data("score")),$(this).find(".rating_div").raty({starOff:$(t).data("pathstaroff"),starOn:$(t).data("pathstaron"),starHalf:$(t).data("pathstarhalf"),hints:[n,n,n,n,n],readOnly:!0,noRatedMsg:$(t).data("noreview"),space:!1,half:!0,score:$(t).data("score")}));$(this).find(".rating_div").off("mouseenter");$(this).find(".rating_div").off("touchstart");$(this).find(".rating_div").off("mouseleave");$($(this).find(".rating_div")).on({mouseenter:function(n){var t=_isResponsive?$(this).parents(".container_rating").first():$(this).parent();t.find(".review_histogram_popup").length>0&&(rt.showHistogramReviews(this,t.data("identifier"),t.data("elementid"),$(this).hasClass("cms_rating")?"cms":"ec"),n.stopPropagation())},mouseleave:function(){var n=_isResponsive?$(this).parents(".container_rating").first():$(this).parent();n.find(".review_histogram_popup").length>0&&rt.hideHistogramReviews(n.data("identifier"),n.data("elementid"),$(this).hasClass("cms_rating")?"cms":"ec")},touchstart:function(n){var t=_isResponsive?$(this).parents(".container_rating").first():$(this).parent();t.parent().find(".review_histogram_popup").length>0&&(rt.showHistogramReviews(this,t.data("identifier"),t.data("elementid"),$(this).hasClass("cms_rating")?"cms":"ec"),n.stopPropagation())}})});$(".ecFieldcommentratingComp, .cmsFieldcommentratingComp").each(function(){var n=$(this).find(".container_rating"),t=$(n).data("texttitle");t=t.replace("@",$(n).data("score")!=""?$(n).data("score"):"0");$(this).find(".rating_comment").raty({starOff:$(n).data("pathstaroff"),starOn:$(n).data("pathstaron"),hints:[t,t,t,t,t],readOnly:!0,space:!1,score:$(n).data("score")!=""?$(n).data("score"):0})});$(".ecFieldcommentsComp, .cmsFieldcommentsComp").each(function(){var n=$(this).find(".container_rating"),t=$(n).data("texttitle");$(this).find(".div_rating_comment").raty({starOff:$(n).data("pathstaroff"),starOn:$(n).data("pathstaron"),hints:["","","","",""],mouseover:function(n){var i=t;$(this).prop("title",i.replace("@",n))}})})},ft=function(){},ft.authentication=function(n){$.ajax({type:"POST",url:"/Async/MexalAvailability/Authentication",data:{_idComponent:n,_currentPath:window.location.pathname},dataType:"json",error:t.onAsyncError,success:function(n){n[0]&&(window.location.href="/"+n[1])}})},ft.addNotification=function(n,i,r,u){$(n).find(".nos_button").each(function(n,t){$(t).hide();_isResponsive&&$(t).parent().addClass("d-none")});$.ajax({type:"POST",url:"/Async/MexalAvailability/AddNotificationOutStock",data:{_product_id:i,_size_id:r,_email:u},dataType:"json",error:t.onAsyncError,success:function(t){t[0]?($(n).find(".nos_link").hide(),$(n).find(".nos_error").hide(),r==0&&$(n).find(".ecFieldnotificationOutStockComp-mail").val(""),$(n).find(".nos_confirm").show(),_isResponsive&&($(n).find(".nos_link").addClass("d-none"),$(n).find(".nos_error").addClass("d-none"),r==0&&$(n).find(".ecFieldnotificationOutStockComp-mail").val(""),$(n).find(".nos_confirm").removeClass("d-none"))):($(n).find(".nos_confirm").hide(),$(n).find(".nos_link").hide(),$(n).find(".nos_error").html(t[1]),$(n).find(".nos_error").show(),$(n).find(".nos_button").show(),_isResponsive&&($(n).find(".nos_confirm").addClass("d-none"),$(n).find(".nos_link").addClass("d-none"),$(n).find(".nos_error").html(t[1]),$(n).find(".nos_error").removeClass("d-none"),$(n).find(".nos_button").each(function(n,t){$(t).parent().removeClass("d-none")})))}})},ft.resetMessages=function(n,t){$(n).find(".nos_error").hide();$(n).find(".nos_confirm").hide();t||$(n).find(".ecFieldnotificationOutStockComp-mail").val("");$(n).find(".nos_button").show();$(n).find(".nos_link").show();_isResponsive&&($(n).find(".nos_error").addClass("d-none"),$(n).find(".nos_confirm").addClass("d-none"),$(n).find(".nos_link").removeClass("d-none"),$(n).find(".nos_button").each(function(n,t){$(t).parent().removeClass("d-none")}))},ft.handleAction=function(){switch($(this).data("action")){case"resetMessages":ft.resetMessages($(this).closest(".ecFieldnotificationOutStockComp"),$(this).data("is-size"));break;case"addNotification":ft.addNotification($(this).closest(".ecFieldnotificationOutStockComp"),$(this).data("productid"),$(this).data("is-size")?$("#"+$(this).data("element-size")).val():0,$(this).data("element-email")==null?null:$("#"+$(this).data("element-email")).val());break;case"authentication":ft.authentication($(this).data("identifier"))}},ft.registerHandlers=function(){$(document).on("focus",'.ecFieldnotificationOutStockComp input[type="text"], .ecFieldnotificationOutStockComp select[data-action]',ft.handleAction);$(document).on("click",".ecFieldnotificationOutStockComp a[data-action]",ft.handleAction);$(document).on("change",".ecFieldnotificationOutStockComp select[data-action]",ft.handleAction)},ft.init=function(){$(".ecFieldnotificationOutStockComp span.nos_size").each(function(){$(this).val($("#"+$(this).find("select.nos_size").attr("id")+" option:first").val())})},l=function(){},l.bindControls=function(){l.bindDates();l.bindCheckboxList();l.bindHours()},l.bindDates=function(){$.datepicker.regional.en!=null&&$(".field_date").each(function(){var n=$(".field_lang").val();$(this).datepicker.initialized||($.datepicker.regional[n]==null&&(n="en"),$(this).datepicker({closeText:$.datepicker.regional[n].closeText,prevText:_isResponsive?"":$.datepicker.regional[n].prevText,nextText:_isResponsive?"":$.datepicker.regional[n].nextText,currentText:$.datepicker.regional[n].currentText,monthNames:$.datepicker.regional[n].monthNames,monthNamesShort:$.datepicker.regional[n].monthNamesShort,dayNames:$.datepicker.regional[n].dayNames,dayNamesShort:$.datepicker.regional[n].dayNamesShort,dayNamesMin:$.datepicker.regional[n].dayNamesMin,weekHeader:$.datepicker.regional[n].weekHeader,dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,changeMonth:$(this).hasClass("changemonth"),changeYear:$(this).hasClass("changeyear"),yearRange:$(this).hasClass("changeyear")||$(this).hasClass("changemonth")?"c-120:c+20":"c-120:c",yearSuffix:"",minDate:$(this).hasClass("nopast")?"0":$(this).hasClass("min_mexal")?new Date(1960,0,1):null,onSelect:function(n){var t=n.match(/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/),i,r;$(this).hasClass("daterange-start")?(i=$(this).parent().nextAll(".formfield_field").children(".daterange-end"),i.val()==""&&i.val($(this).val()),i.datepicker("option","minDate",new Date(parseInt(t[3],10),parseInt(t[2],10)-1,parseInt(t[1],10)))):$(this).hasClass("daterange-end")&&(r=$(this).parent().prevAll(".formfield_field").children(".daterange-start"),r.val()==""&&r.val($(this).val()),r.datepicker("option","maxDate",new Date(parseInt(t[3],10),parseInt(t[2],10)-1,parseInt(t[1],10))));$(this).attr("onchange")!=null&&$(this).change();$(this).data("action")!=undefined&&$(this).change()},onChangeMonthYear:function(){}}))})},l.bindCheckboxList=function(){$(document).off("click",".field_checkbox").on("click",".field_checkbox",function(){var n=$(this).closest(".formfield_field").find(".field_checkbox_hidden"),t,i;n!=null&&(t=$.trim(n.val())!=""?n.val().split(","):[],i=$(this).val(),$(this).is(":checked")?t.push(i):t=jQuery.grep(t,function(n){return n!=i}),n.val(t.join(",")),n.trigger("change"))})},l.bindHours=function(){$(".field_hours").each(function(){var n=$(".field_lang").val();$.timepicker.initialized||($.timepicker.regional[n]==null&&(n="en"),$(this).timepicker({hourText:$.timepicker.regional[n].hourText,minuteText:$.timepicker.regional[n].minuteText,amPmText:$.timepicker.regional[n].amPmText,closeButtonText:$.timepicker.regional[n].closeButtonText,nowButtonText:$.timepicker.regional[n].nowButtonText,deselectButtonText:$.timepicker.regional[n].deselectButtonText,minutes:{interval:15},showPeriodLabels:!1,rows:3,onHourShow:Site.horeca.onHourShowCallback,onMinuteShow:Site.horeca.onMinuteShowCallback}))})},l.clearPlaceholder=function(n){$("#"+n+" input, #"+n+" textarea").each(function(){var n=$(this).attr("placeholdervalue");n!=null&&this.value.toLowerCase()==n.toLowerCase()&&(this.value="")})},l.submit=function(n,i,r,u,f){t.addLoadingPanel("#"+i);(u===undefined||u===null||u==="")&&(u=t.getParamsId($("body").attr("id")).id);var o={_pageId:u,_componentId:r};_permalinkProduct!=null&&(o._permalink=_permalinkProduct);_permalinkCms!=null&&(o._permalinkCms=_permalinkCms);$("#"+n).ajaxSubmit({data:o,dataType:"json",error:function(n,r,u){t.removeLoadingPanel("#"+i);t.onAsyncError(n,r,u)},success:function(r){if(t.removeLoadingPanel("#"+i),r.returnedId!=null&&$("#"+i+"-entityid").val(r.returnedId),$(r.data).find(".formfield_error").length==0||$(r.data).find(".formfield_error").length>0&&$(r.data).find(".formfield_error:not(:empty)").length==0){$("#"+n).data("hastracker")!=undefined&&Site.PWT.successForm($("#"+n),$("#"+n).data("categoryform"),null,$("#"+n).data("identifier"),null,"Sito",$("#"+n).data("formcomponentname"),$("#"+n).data("enabledeventclientside"),$("#"+n).data("issendeventserverside"),$("#"+n).data("valueevent"),$(r.data).children().eq(0).data("eventid"));try{window["callback"+i]()}catch(u){}}r.returnedCode=="goaction"?($("#"+n).attr("action",r.location),$("#"+n).submit()):r.returnedCode=="success"&&(r.location!=null?(f!=undefined&&f!=null&&f(),window.location=r.location):($("#"+i).replaceWith(r.data),$("#"+i).hasClass("addarticlestocart")&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],tipologiaCart.cart),null,!1,null,null),l.init(),l.bindControls(),y.init(),$("#"+i).find(".formfield_error:not(:empty)").length>0&&t.scrollTo($("#"+i).find(".formfield_error:not(:empty)").first().offset().top)))}})},l.rbNewsletter=function(n){if(n!=undefined){var t=n.replace("rbnewsletter_","");$("input[name="+n+"]:checked").val()=="si"?$(".formComp ."+t).show():$(".formComp ."+t).hide()}},l.registerHandlers=function(){$(".formfield_field .field_date").each(function(){if($(this).data("is-readonly")&&!$(this).data("mandatory"))$(this).on("keyup",function(n){(n.keyCode==8||n.keyCode==46)&&$(this).val("")})});$(".formComp-form").each(function(){$(this).data("submittype")==1&&l.bindControls()});$(document).on("click",".formComp-form input[type=button], .formComp-form input[type=submit], .mcSubscriptionComp-form input[type=submit]",function(n){var t=$(this).parent().parent();$(t).data("submittype")==0?l.clearPlaceholder($(t).attr("id")):(n.preventDefault(),l.clearPlaceholder($(t).attr("id")),l.submit($(t).attr("id"),$(t).data("class")+"_"+$(t).data("identifier"),$(t).data("identifier"),$(t).data("pageid")))});$(document).on("click",".passwordfieldComp .showpassword",function(){var n=$(this).closest(".passwordfieldComp").find("input");n.attr("type",n.attr("type")==="password"?"text":"password");$(this).find("i").toggleClass("fa-eye");$(this).find("i").toggleClass("fa-eye-slash")});$(document).on("input",'.passwordfieldComp  [data-action="passwordhints"]',function(){l.passwordHints(this)});$(".mcSubscriptionComp-form.successMC").each(function(){$("#"+$(this).attr("id")+" input[type=text], #"+$(this).attr("id")+" textarea").each(function(){var n=$(this).attr("placeholdervalue");n!=null?$(this).val(n):$(this).val("")})});$(document).on("change",".formComp [name=state]",function(){$(this).val()!=""&&y.getDistrict($(this).val(),"formComp[id="+$(this).closest(".formComp").attr("id")+"]","",null)});$(document).on("change",".formcontrol [name=state], .formcontrol .fieldnamecondition [name]",function(){l.CheckCondition(this)});$(document).on("change",".formComp .rbnewsletter input[type=radio]",function(){l.rbNewsletter($(this).attr("name"))})},l.passwordHints=function(n){$.ajax({type:"POST",url:"/Form/GenerateListaSottoregolePassword",data:{},dataType:"json",success:function(t){var u=$(n).val(),i=$("#listaRegole_"+$(n).attr("id")),r;i.empty();r=l.getMessaggiRegolePassword(t,u);r.forEach(function(n){var r=$("<li><\/li>").addClass("regola").addClass(n.classeRegola).text(n.messaggio),t;r.css("list-style-type","none");t=$("<i><\/i>");n.verificata?t.addClass("verificata"):t.addClass("non-verificata");r.prepend(t);i.append(r)})}})},l.getMessaggiRegolePassword=function(n,t){var i=[];return n.forEach(function(n){var r=new RegExp(n.porzioneRegola).test(t);i.push({messaggio:n.messaggioRegola,verificata:r,classeRegola:n.classeRegola})}),i},l.checkAccoutType=function(n,t){switch(n){case"individual":$("#"+t+" [name=company_name]").val("");$("#"+t+" [name=company_name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=vat_number]").val("");$("#"+t+" [name=vat_number]").closest(".formfieldcomponent").hide();$("#"+t+" [name=name]").closest(".formfieldcomponent").show();$("#"+t+" [name=last_name]").closest(".formfieldcomponent").show();$("#"+t+" [name=denomination]").closest(".formfieldcomponent").hide();$("#"+t+" [name=birthplace]").closest(".formfieldcomponent").show();$("#"+t+" [name=birthdate]").closest(".formfieldcomponent").show();$("#"+t+" [name=lottery_code]").closest(".formfieldcomponent").show();$("#"+t+" [name=choice_publiccompany]").closest(".formfieldcomponent").hide();$("#"+t+" [name=choice_physicalperson]").closest(".formfieldcomponent").hide();$("#"+t+" [name=sdi]").closest(".formfieldcomponent").hide();$("#"+t+" [name=ufficiopa]").closest(".formfieldcomponent").hide();break;case"company":$("#"+t+" [name=name]").val("");$("#"+t+" [name=name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=last_name]").val("");$("#"+t+" [name=last_name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=denomination]").val("");$("#"+t+" [name=denomination]").closest(".formfieldcomponent").hide();$("#"+t+" [name=birthplace]").closest(".formfieldcomponent").hide();$("#"+t+" [name=birthdate]").closest(".formfieldcomponent").hide();$("#"+t+" [name=lottery_code]").closest(".formfieldcomponent").hide();$("#"+t+" [name=company_name]").closest(".formfieldcomponent").show();$("#"+t+" [name=vat_number]").closest(".formfieldcomponent").show();$("#"+t+" [name=choice_publiccompany]").closest(".formfieldcomponent").show();$("#"+t+" [name=choice_physicalperson]").closest(".formfieldcomponent").show();$("#"+t+" [name=choice_physicalperson][value=0]").prop("checked",!0);($("#"+t+" [name=choice_electrinvoice]").val()=="1"||$("#"+t+" [name=choice_electrinvoice]").val()==null)&&($("#"+t+" [name=choice_publiccompany]").val()=="0"||$("#"+t+" [name=choice_publiccompany]").val()==null)&&($("#"+t+" [name=state]").val()=="Italy"||$("#"+t+" [name=state]").val()==null)?$("#"+t+" [name=sdi]").closest(".formfieldcomponent").show():$("#"+t+" [name=sdi]").closest(".formfieldcomponent").hide();($("#"+t+" [name=choice_electrinvoice]").val()=="1"||$("#"+t+" [name=choice_electrinvoice]").val()==null)&&$("#"+t+" [name=choice_publiccompany]").val()=="1"&&($("#"+t+" [name=state]").val()=="Italy"||$("#"+t+" [name=state]").val()==null)?$("#"+t+" [name=ufficiopa]").closest(".formfieldcomponent").show():$("#"+t+" [name=ufficiopa]").closest(".formfieldcomponent").hide()}},l.checkPhysicalPerson=function(n,t){switch(n){case"1":$("#"+t+" [name=company_name]").val("");$("#"+t+" [name=company_name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=name]").closest(".formfieldcomponent").show();$("#"+t+" [name=last_name]").closest(".formfieldcomponent").show();$("#"+t+" [name=denomination]").closest(".formfieldcomponent").show();break;case"0":$("#"+t+" [name=company_name]").closest(".formfieldcomponent").show();$("#"+t+" [name=name]").val("");$("#"+t+" [name=name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=last_name]").val("");$("#"+t+" [name=last_name]").closest(".formfieldcomponent").hide();$("#"+t+" [name=denomination]").val("");$("#"+t+" [name=denomination]").closest(".formfieldcomponent").hide()}},l.CheckCondition=function(n){var t=$(n).closest(".formcontrol"),i,r;t!=null&&(i=[],$(t).find(".checkmandatory").each(function(){var n=$(this).data("mandatory");n!=null&&i.push($(this))}),i.length>0&&l.mandatoryCondition(i,t),r=[],$(t).find(".checkvisibility").each(function(){var n=$(this).data("visibility");n!=null&&r.push($(this))}),r.length>0&&l.visibilityCondition(r,t))},l.mandatoryCondition=function(n,i){var r=l.setDataCondition("mandatory",n,i);$.ajax({type:"POST",url:"/Async/ConditionFormFieldList",dataType:"json",data:r,error:t.onAsyncError,success:function(t){for(var i=0;i<n.length;i++)t[i]?n[i].find(".form-mandatory").show():n[i].find(".form-mandatory").hide()}})},l.visibilityCondition=function(n,i){var r=l.setDataCondition("visibility",n,i);$.ajax({type:"POST",url:"/Async/ConditionFormFieldList",dataType:"json",data:r,error:t.onAsyncError,success:function(t){for(var u,r,i=0;i<n.length;i++)if(t[i]){if(n[i].show(),u=n[i].closest(".formcontrol").find('input:checked[name="accounttype"]'),u.length!=0){r=n[i].find("input").attr("name");switch($(u).val()){case"individual":(r=="company_name"||r=="vat_number"||r=="sdi"||r=="ufficiopa"||r=="choice_publiccompany"||r=="choice_physicalperson")&&n[i].hide();break;case"company":(r=="birthplace"||r=="birthdate"||r=="lottery_code")&&n[i].hide()}}}else n[i].hide()}})},l.setDataCondition=function(n,r,u){for(var f,s,h=t.getParamsId($(u).attr("id")),e={_typology:n,_formclass:h!=null?h.class:null,_formid:h!=null?h.id:0},c=[],o=0;o<r.length;o++)for(c.push(n=="visibility"?r[o].data("visibilitycondition"):r[o].data("mandatorycondition")),f=r[o].data(n).split(","),i=0;i<f.length;i++)f[i]=="naz"&&(e.state=$(u).find("[name=state]").val()),f[i]=="pri"&&(e.accounttype=$(u).find("[name=accounttype]"+($(u).find("[name=accounttype]").is(":radio")?":checked":"")).val()=="individual"?1:0),f[i]=="fte"&&(e.choice_electrinvoice=$(u).find("[name=choice_electrinvoice]:checked").val()=="1"?1:0),f[i]=="enp"&&(e.choice_publiccompany=$(u).find("[name=choice_publiccompany]:checked").val()=="1"?1:0),f[i]=="psf"&&(e.accounttype=$(u).find("[name=accounttype]"+($(u).find("[name=accounttype]").is(":radio")?":checked":"")).val()=="individual"?1:0,e.choice_physicalperson=$(u).find("[name=choice_physicalperson]:checked").val()=="1"?1:0),f[i].startsWith("option_")&&(e[f[i]]=$(u).find("[name="+f[i]+"]").is(":radio")?$(u).find("[name="+f[i]+"]:checked").val():$(u).find("[name="+f[i]+"]").val()),f[i].startsWith("formfield_")&&(s=f[i].replace("formfield_",""),e[s]=$(u).find("[name="+s+"]").is(":radio")?$(u).find("[name="+s+"]:checked").val():$(u).find("[name="+s+"]").val());return e._condition=c,e},l.init=function(){$(".formComp .rbnewsletter").each(function(){l.rbNewsletter($(this).find("input[type=radio]").attr("name"))})},st=function(){},st.init=function(){$(document).off("change",".ecSetoptionsComp-form [name^='option_']").on("change",".ecSetoptionsComp-form [name^='option_']",function(){l.CheckCondition(this);var i=$(this).closest("form"),n=$(i).data("cellidentifier"),t=[],r=$(".cellid_"+n).hasClass("ecProductComp")?".primarypriceproduct":".cellid_"+n+".primaryprice";$(r).each(function(){t.push($(this).closest(".ecFieldpriceComp"))});dt.refreshPrice(t,!0,1)})},st.registerHandlers=function(){l.bindControls();ot.registerHandlers()},st.sumbitForm=function(n){var u=$("#optionsform_"+n).data("identifier"),i=$(".cellid_"+n+" .setoptionsform"),r=$(i).hasClass("quicksetoptions");return $.ajax({type:"POST",url:"/Async/SubmitFormOptions",data:{_componentId:u,_pageId:$("#optionsform_"+n).data("pageid"),_collector:$("#optionsform_"+n).data("collector"),_article:$("#optionsform_"+n).data("productid"),_options:st.getOptions(n),_structure:a.getStructure(n,null),_indiceCella:$("#optionsform_"+n).data("cellindex"),_indicePromo:$("#optionsform_"+n).data("cellindexpromo"),_autocomplete:r},dataType:"json",async:!1,error:t.onAsyncError,success:function(n){n.returnedCode=="success"&&(r?$(i).html(n.data):$(i).replaceWith(n.data),st.registerHandlers(),options=n.location)}}),options},st.getOptions=function(n){var r=$("[id=optionsform_"+n+"]:visible").serializeArray(),i="option_",t=[];return $(r).each(function(n,r){r.name.startsWith(i)&&t.push({option_id:r.name.substring(i.length),option_value:r.value})}),t.length>0?JSON.stringify(t):null},g=function(){},g.handleAction=function(){switch($(this).data("action")){case"applyvirtualgiftcard":g.applyGiftCard($(this).data("id"),$(this).data("linkid"),tipologiaGift.virtual);break;case"applygiftcard":g.applyGiftCard($(this).data("id"),$("#giftcardcode_"+$(this).data("id")).val(),tipologiaGift.code);break;case"historygiftcard":g.historyGiftCard($(this).data("entryid"),$(this).data("pageid"),$(this).data("identifier"));break;case"backgiftcard":g.backGiftCard($(this).data("identifier"));break;case"backgiftcardhistory":g.backGiftCardHistory($(this).data("identifier"));break;case"vieworder":g.vieworder($(this).data("identifier"),$(this).data("orderid"))}},g.registerHandlers=function(){$(document).on("click",'.ecGiftCardComp [data-action="applyvirtualgiftcard"]',g.handleAction);$(document).on("click",'.ecGiftCardComp [data-action="applygiftcard"]',g.handleAction);$(document).on("click",'.ecGiftCardComp [data-action="historygiftcard"]',g.handleAction);$(document).on("click",'.ecGiftCardComp [data-action="backgiftcard"]',g.handleAction);$(document).on("click",'.ecGiftCardComp [data-action="backgiftcardhistory"]',g.handleAction);$(document).on("click",'.ecGiftCardComp [data-action="vieworder"]',g.handleAction)},g.applyGiftCard=function(n,i,r){var u=(r==tipologiaGift.virtual?"#virtualgiftcarderror_":"#giftcarderror_")+n;$(u).hide();i!=null&&i!=""&&$.ajax({type:"POST",url:"/Async/GiftCard/ApplyGiftCard",data:{_giftcode:i,_type:r},dataType:"json",error:t.onAsyncError,success:function(t){switch(t.returnedCode){case"success":r==tipologiaGift.virtual?window.location=t.location:Site.updaters.refreshComponent($("#ecGiftCard_"+n),null,null,null);break;case"error":$(u).html(t.returnedError);$(u).show()}}})},g.historyGiftCard=function(n,t,i){$.ajax({type:"POST",url:"/Async/GiftCard/GetGiftCardHistory",data:{_giftid:n,_pageId:t,_componentId:i},dataType:"html",error:Site.global.onAsyncError,success:function(n){$("#ecGiftCard_"+i+" .ecGiftCardComp-giftcode").hide();$("#ecGiftCard_"+i+" .ecGiftCardComp-history").html(n);$("#ecGiftCard_"+i+" .ecGiftCardComp-history").show("blind",null,1e3)}})},g.backGiftCard=function(n){$("#ecGiftCard_"+n+" .ecGiftCardComp-history").hide();$("#ecGiftCard_"+n+" .ecGiftCardComp-giftcode").show("blind",null,1e3)},g.backGiftCardHistory=function(n){$("#ecGiftCard_"+n+" .ecGiftCardComp-order").hide();$("#ecGiftCard_"+n+" .ecGiftCardComp-history").fadeIn("slow")},g.vieworder=function(n,t){$.ajax({type:"POST",url:"/Async/GiftCard/ViewGiftCardOrder",data:{_orderId:t},dataType:"json",error:Site.global.onAsyncError,success:function(t){t!=null&&($("#ecGiftCard_"+n+" #order_"+n).html(t.ordine),$("#ecGiftCard_"+n+" .ecGiftCardComp-history").hide(),$("#ecGiftCard_"+n+" .ecGiftCardComp-order").fadeIn("slow"))}})},yt=function(){},yt.handleAction=function(){switch($(this).data("action")){case"backrewardpoints":yt.backRewardPoints($(this).data("identifier"));break;case"vieworder":yt.vieworder($(this).data("identifier"),$(this).data("orderid"))}},yt.registerHandlers=function(){$(document).on("click",'.ecRewardPointsComp [data-action="backrewardpoints"]',yt.handleAction);$(document).on("click",'.ecRewardPointsComp [data-action="vieworder"]',yt.handleAction)},yt.backRewardPoints=function(n){$("#ecRewardPoints_"+n+" .ecRewardPointsComp-order").hide();$("#ecRewardPoints_"+n+" .ecRewardPointsComp-rewardpoints").fadeIn("slow")},yt.vieworder=function(n,t){$.ajax({type:"POST",url:"/Async/GiftCard/ViewGiftCardOrder",data:{_orderId:t},dataType:"json",error:Site.global.onAsyncError,success:function(t){t!=null&&($("#ecRewardPoints_"+n+" #order_"+n).html(t.ordine),$("#ecRewardPoints_"+n+" .ecRewardPointsComp-rewardpoints").hide(),$("#ecRewardPoints_"+n+" .ecRewardPointsComp-order").fadeIn("slow"))}})},h=function(){},h.elencoTurniMenu=[],h.init=function(){$(document).on("change","#ecReservationMenuComp-oraprenotazione",function(){h.menuCheckTables("ecReservationMenu")});$(document).on("change","#ecReservationMenuCustomComp-oraprenotazione",function(){h.menuCheckTables("ecReservationMenuCustom")});$("#ecReservationMenuComp-copertiprenotazione, #ecReservationMenuCustomComp-copertiprenotazione").on("change",function(){var n=$(this).parents('[data-action="checkout-accordion"]');$("#"+$(n).data("class")+"Comp-planningmessage").hide();$("#"+$(n).data("class")+"Comp-salaprenotazione option:selected").hasClass("selectionTables")&&($("#"+$(n).data("class")+"Comp-piantinaSala").fadeOut(200),$("#"+$(n).data("class")+"Comp-piantina .tableCell").each(function(){if(!$(this).hasClass("tableCellReserved")){$(this).removeClass("tableCellSelected");$(this).removeClass("tableCellEnabled");$(this).removeClass("tableCellDisabled");var t=$("#"+$(n).data("class")+"Comp-copertiprenotazione").val();$(this).data("tavoloInfo").copertiMinimi>t?$(this).addClass("tableCellDisabled"):$(this).addClass("tableCellEnabled")}}),h.menuCheckSeatings($(n).data("class")),$("#"+$(n).data("class")+"Comp-piantinaSala").fadeIn(1e3))});$("#ecReservationMenuComp-piantina, #ecReservationMenuCustomComp-piantina").on("click",".tableCellEnabled",function(){var n=$(this).parents('[data-action="checkout-accordion"]'),r,t,i;$("#"+$(n).data("class")+"Comp-planningmessage").hide();$(this).hasClass("tableCellSelected")?$(this).removeClass("tableCellSelected"):$(this).addClass("tableCellSelected");r=$("#"+$(n).data("class")+"Comp-copertiprenotazione").val();t=0;$("#"+$(n).data("class")+"Comp-piantina .tableCellSelected").each(function(){t+=$(this).data("tavoloInfo").coperti});i=r-t;$("#"+$(n).data("class")+"Comp-piantina .tableCell").each(function(){$(this).hasClass("tableCellSelected")||$(this).hasClass("tableCellReserved")||($(this).removeClass("tableCellEnabled"),$(this).removeClass("tableCellDisabled"),i<=0||$(this).data("tavoloInfo").copertiMinimi>i?$(this).addClass("tableCellDisabled"):$(this).addClass("tableCellEnabled"))})});$(document).on("click","#planning .availabilityCell",h.planningCellClick)},h.menuInfo=function(n){$("#"+n+"Comp-planningloader").show();$("#"+n+"Comp-infoprenotazione").hide();$("#"+n+"Comp-planningmessage").hide();$.ajax({type:"POST",url:"/Async/ReservationMenu/GetInfoMenu",dataType:"json",data:{_date:$("#"+n+"Comp-dataprenotazione").val(),_larghezzaSala:$("#"+n+"Comp-larghezzasala").val(),_altezzaSala:$("#"+n+"Comp-altezzasala").val()},error:function(){$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(t){for(i=0;i<t.sale.length;i++)$("<option value='"+t.sale[i].sala+"'"+(t.sale[i].piantina?" class='selectionTables"+(t.sale[i].preventivoNoTables?" acceptNotables":"")+"' ":"")+">"+t.sale[i].sala+"<\/option>").appendTo("#"+n+"Comp-salaprenotazione");h.menuTurnsManagement(n,t.turni)}})},h.menuTurns=function(n){$("#"+n+"Comp-planningloader").show();$("#"+n+"Comp-infoprenotazione").hide();$("#"+n+"Comp-planningmessage").hide();$.ajax({type:"POST",url:"/Async/ReservationMenu/GetTurniMenu",dataType:"json",data:{_date:$("#"+n+"Comp-dataprenotazione").val()},error:function(){$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(t){$("#"+n+"Comp-oraprenotazione").val("");h.menuTurnsManagement(n,t)}})},h.menuTurnsManagement=function(n,t){h.elencoTurniMenu=t;t!=""?(t.length>0&&$("#"+n+"Comp-oraprenotazione").val()==""&&$("#"+n+"Comp-oraprenotazione").val((t[0].oraInizio<10?"0":"")+t[0].oraInizio+":"+((t[0].minutiInizio<10?"0":"")+t[0].minutiInizio)),h.menuCheckTables(n),$("#"+n+"Comp-infoprenotazione").fadeIn(2e3)):($("#"+n+"Comp-planningloader").hide(),$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessageclosing").val()),$("#"+n+"Comp-planningmessage").fadeIn(2e3))},h.menuCheckTables=function(n){$("#"+n+"Comp-planningmessage").hide();$("#"+n+"Comp-salaprenotazione option:selected").hasClass("selectionTables")?($("#"+n+"Comp-piantinaSala").hide(500),$("#"+n+"Comp-planningloader").show(),$.ajax({type:"POST",url:"/Async/ReservationMenu/GetTavoliSala",dataType:"json",data:{_sala:$("#"+n+"Comp-salaprenotazione option:selected").val(),_data:$("#"+n+"Comp-dataprenotazione").val(),_ora:$("#"+n+"Comp-oraprenotazione").val(),_larghezzaSala:$("#"+n+"Comp-larghezzasala").val(),_altezzaSala:$("#"+n+"Comp-altezzasala").val()},error:function(){$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(t){var i,r,u,f,e;$("#"+n+"Comp-piantina").html("");$("#"+n+"Comp-piantina").css({height:t.dimY,width:t.dimX,"background-repeat":"no-repeat"});t.piantina!=null?$("#"+n+"Comp-piantina").css({"background-image":'url("'+t.piantina+'")'}):$("#"+n+"Comp-piantina").css({"background-image":""});for(tavolo in t.tavoli)i="top: "+t.tavoli[tavolo].posY+"px; left: "+t.tavoli[tavolo].posX+"px; width: "+t.tavoli[tavolo].dimX+"px; height: "+t.tavoli[tavolo].dimY+"px; line-height: "+t.tavoli[tavolo].dimY/2+"px;",t.tavoli[tavolo].tavoloTondo&&(i+="-moz-border-radius: "+t.tavoli[tavolo].dimX/2+"px/"+t.tavoli[tavolo].dimY/2+"px; -webkit-border-radius: "+t.tavoli[tavolo].dimX/2+"px/"+t.tavoli[tavolo].dimY/2+"px; border-radius: "+t.tavoli[tavolo].dimX/2+"px/"+t.tavoli[tavolo].dimY/2+"px;"),t.tavoli[tavolo].rotazione!=0&&(i+="transform:rotate("+t.tavoli[tavolo].rotazione+"deg);-moz-transform:rotate("+t.tavoli[tavolo].rotazione+"deg);-webkit-transform:rotate("+t.tavoli[tavolo].rotazione+"deg);-o-transform:rotate("+t.tavoli[tavolo].rotazione+"deg);-ms-transform:rotate("+t.tavoli[tavolo].rotazione+"deg);"),r="",t.tavoli[tavolo].isTavolo?(u="tableCellEnabled",f=$("#"+n+"Comp-copertiprenotazione").val(),t.tavoli[tavolo].isLibero?t.tavoli[tavolo].copertiMinimi>f&&(u="tableCellDisabled"):u="tableCellReserved",r='<a id="cell_'+tavolo+'" class="tableCell '+u+'" style="'+i+'" title="'+t.tavoli[tavolo].nome+" (Min "+t.tavoli[tavolo].copertiMinimi+"/Max "+t.tavoli[tavolo].coperti+')">'+t.tavoli[tavolo].nome+"<br/>("+t.tavoli[tavolo].copertiMinimi+"/"+t.tavoli[tavolo].coperti+")<\/a>"):r='<a id="cell_'+tavolo+'" class="objectCell" style="'+i+'">&nbsp;<\/a>',$("#"+n+"Comp-piantina").append(r),t.tavoli[tavolo].isTavolo&&(e={nome:t.tavoli[tavolo].nome,coperti:t.tavoli[tavolo].coperti,copertiMinimi:t.tavoli[tavolo].copertiMinimi},$("#cell_"+tavolo).data("tavoloInfo",e));h.menuCheckSeatings(n);$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-piantinaSala").show(500)}})):($("#"+n+"Comp-piantinaSala").hide(500),$("#"+n+"Comp-planningloader").hide())},h.menuCheckSeatings=function(n){var t=0;$("#"+n+"Comp-piantina .tableCellEnabled").each(function(){t+=$(this).data("tavoloInfo").coperti});t<$("#"+n+"Comp-copertiprenotazione").val()&&($("#"+n+"Comp-piantina .tableCellEnabled").each(function(){$(this).removeClass("tableCellEnabled");$(this).addClass("tableCellDisabled")}),$("#"+n+"Comp-salaprenotazione option:selected").hasClass("acceptNotables")?$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagenotablescontinue").val()):$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagenotables").val()),$("#"+n+"Comp-planningmessage").fadeIn(2e3))},h.menuCheckSelectedTables=function(n){if($("#"+n+"Comp-planningmessage").hide(),$("#"+n+"Comp-salaprenotazione option:selected").hasClass("selectionTables")){var i=$("#"+n+"Comp-copertiprenotazione").val(),t=0;return $("#"+n+"Comp-piantina .tableCellSelected").each(function(){t+=$(this).data("tavoloInfo").coperti}),i<=t?!0:$("#"+n+"Comp-salaprenotazione option:selected").hasClass("acceptNotables")&&$("#"+n+"Comp-piantina .tableCellEnabled").length==0?!0:($("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessageinsufficienttables").val()),$("#"+n+"Comp-planningmessage").fadeIn(2e3),!1)}return!0},h.menuShowReservation=function(n){var r=$("#"+n+"Comp-copertiprenotazione").val(),i;r==""&&(r=1);i=[];$("#"+n+"Comp-salaprenotazione option:selected").hasClass("selectionTables")&&$("#"+n+"Comp-piantina .tableCellSelected").each(function(){i.push($(this).data("tavoloInfo").nome)});$.ajax({type:"POST",url:"/Async/ReservationMenu/ShowReservation",data:{_data:$("#"+n+"Comp-dataprenotazione").val(),_ora:$("#"+n+"Comp-oraprenotazione").val(),_coperti:$("#"+n+"Comp-copertiprenotazione").val(),_sala:$("#"+n+"Comp-salaprenotazione").val(),_nota:$("#"+n+"Comp-notaprenotazione").val(),_tavoli:i.length>0?JSON.stringify(i):""},dataType:"json",error:t.onAsyncError,success:function(n){n!=0&&(window.location.href="/store/reservation/progress?id="+n)}})},h.showReservation=function(n){t.checkBraintree(n).then(i=>{var f=t.getParamsId($("."+n+"Comp").attr("id")).id,e=$("#"+n+"Comp-datatrattamento").val(),u=null;$("#"+n+"Comp-billing:visible").length>0&&(u=$("#"+n+"Comp-billing input[name=billing]:radio:checked").val());var o=$("#"+n+"Comp-billing input[name='billingcard_"+u+"']:checked").val(),s=$("#"+n+"Comp-billing input[name='remembercard_"+u+"']:checked").val(),r=$(".availabilitySelected").data("resourceInfo");$.ajax({type:"POST",url:"/Async/Reservation/ShowReservation",data:{_data:e+" "+r.range.descriptiveFrom,_trattamento:$("#treatmentId").val(),_voucher:$("#"+n+"Comp-"+f+"-voucher").val(),_billing:u==null?null:u,_centro:r.resource.center,_area:r.resource.area,_durata:r.range.to-r.range.from,_risorse:r.resource.label,_card:o,_remembercard:s,_braintree_paymentnonce:i!=null?i.nonce:null,_braintree_paymentdevicedata:i!=null?i.deviceData:null},dataType:"json",error:t.onAsyncError,success:function(n){n!=0&&(window.location.href="/store/reservation/progress?id="+n+"&pid="+$("#treatmentId").val())}})})},h.loadPlanning=function(n){$("#"+n+"Comp-planningloader").show();$("#"+n+"Comp-planning").hide();$("#"+n+"Comp-planningmessage").hide();$("#"+n+"Comp-oratrattamento").val("");$.ajax({type:"POST",url:"/Async/Reservation/GetPlanning",data:{_trattamento:$("#treatmentName").val(),_date:$("#"+n+"Comp-datatrattamento").val()},dataType:"json",error:function(){$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(t){var r,u,o,s,i,l;if($("#"+n+"Comp-planning").html(""),t!="")if(t.resources.length>0){if(r=_isResponsive?$('<div id="planning" class="container-fluid no-gutter"><\/div>'):$('<div id="planning"><div class="headers"><div class="timeline-col">&nbsp;<\/div><\/div><div class="cols"><div class="timeline timeline-col"><\/div><\/div><\/div>'),!_isResponsive)for(i=t.from;i<=t.to;i+=t.granularity)$(r).find(".timeline").append("<div>"+h.getTimeLinePlanning(i)+"<\/div>");for(_resource in t.resources)if(_isResponsive){for(u=$('<div class="cols row"><div class="col-2 col-md-1"><\/div><div class="col-10 col-md-11"><div class="gridhead">'+t.resources[_resource].label+'<\/div><\/div><div class="timeline timeline-col col-2 col-md-1"><\/div><div class="gridcol col-10 col-md-11" id="resource_'+t.resources[_resource].id+'_grid"><\/div><\/div>'),i=t.from;i<=t.to;i+=t.granularity)$(u).find(".timeline").append("<div>"+h.getTimeLinePlanning(i)+"<\/div>");for(i=t.from;i<t.to;i+=t.granularity)o=h.getTimeLinePlanning(i),s=$('<div class="gridspace" data-plan="'+o+'"><\/div>'),s.append(a),$(u).find("#resource_"+t.resources[_resource].id+"_grid").append(s);for(_availabilityRange in t.resources[_resource].availabilityRanges){var o=t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveFrom,c=$('<a role="button" class="availabilityCell btn btn-block" id="cell_'+_resource+"_"+_availabilityRange+'"  title="dalle '+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveFrom+" alle "+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveTo+'">dalle '+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveFrom+" alle "+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveTo+"<\/a>"),l={range:t.resources[_resource].availabilityRanges[_availabilityRange],resource:{label:t.resources[_resource].label,center:t.resources[_resource].center,area:t.resources[_resource].area}};c.data("resourceInfo",l);c.data("class",n);$(u).find(".gridspace[data-plan='"+o+"']").append(c)}r.append(u)}else for($(r).find(".headers").append('<div class="gridhead">'+t.resources[_resource].label+"<\/div>"),$(r).find(".cols").append('<div class="gridcol" id="resource_'+t.resources[_resource].id+'_grid"><\/div>'),i=t.from;i<t.to;i+=t.granularity)$(r).find("#resource_"+t.resources[_resource].id+"_grid").append('<div class="gridspace">&nbsp;<\/div>');if($("#"+n+"Comp-planning").append(r),!_isResponsive){var v=$(".gridspace").outerWidth(!0),y=$(".gridspace").outerHeight(!0),p=$(".gridhead").outerHeight(!0),w=$(".timeline").outerWidth(!0),b=parseInt($(".gridspace").css("margin-top")),k=parseInt($(".gridspace").css("margin-bottom")),d=parseInt($(".gridspace").css("margin-left")),g=parseInt($(".gridspace").css("margin-right")),nt=parseInt($(".gridcol").css("margin-left")),tt=parseInt($(".gridcol").css("margin-right"));for(_resource in t.resources)for(_availabilityRange in t.resources[_resource].availabilityRanges){var f=Math.floor((t.resources[_resource].availabilityRanges[_availabilityRange].from-t.from)/t.granularity*y+p+(t.resources[_resource].availabilityRanges[_availabilityRange].from-t.from==0?0:k)+b),e=Math.floor(w+t.resources[_resource].id*v+t.resources[_resource].id*(g+tt)+t.resources[_resource].id*(d+nt)),a='<a id="cell_'+f+"_"+e+'" class="availabilityCell" style="top: '+f+"px; left: "+e+'px;" title="dalle '+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveFrom+" alle "+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveTo+'">dalle '+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveFrom+" alle "+t.resources[_resource].availabilityRanges[_availabilityRange].descriptiveTo+"<\/a>";$("#planning").append(a);l={range:t.resources[_resource].availabilityRanges[_availabilityRange],resource:{label:t.resources[_resource].label,center:t.resources[_resource].center,area:t.resources[_resource].area}};$("#cell_"+f+"_"+e).data("resourceInfo",l);$("#cell_"+f+"_"+e).data("class",n)}$("#planning").css("width",$(".gridhead").outerWidth(!0)*t.resources.length+$(".timeline-col").outerWidth(!0)+"px")}$("#"+n+"Comp-planningloader").hide();$("#"+n+"Comp-planning").fadeIn(2e3)}else $("#"+n+"Comp-planningloader").hide(),$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagenoresources").val()),$("#"+n+"Comp-planningmessage").fadeIn(2e3);else $("#"+n+"Comp-planningloader").hide(),$("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessageclosing").val()),$("#"+n+"Comp-planningmessage").fadeIn(2e3)}})},h.getTimeLinePlanning=function(n){return Math.floor(n/60).toString().padStart(2,"0")+":"+(Math.floor(n%60)==0?"00":Math.floor(n%60)).toString().padStart(2,"0")},h.planningCellClick=function(){$("#"+$(this).data("class")+"Comp-oratrattamento").val($(this).data("resourceInfo").range.descriptiveFrom+" - "+$(this).data("resourceInfo").range.descriptiveTo);$(".availabilitySelected").removeClass("availabilitySelected");$(this).addClass("availabilitySelected")},h.confirmReservation=function(n,i,r){!i||$("#"+r+"Comp-checkcondition").is(":checked")?(t.addLoadingPanel("."+r+"Comp"),window.location.href="/store/reservation/confirm/"+n):$("#"+r+"Comp-errorcondition").fadeIn("slow")},h.confirmReservationMenu=function(n,i,r){!i||$("#"+r+"Comp-checkcondition").is(":checked")?(t.addLoadingPanel("."+r+"Comp"),window.location.href="/store/reservation/confirmmenu/"+n):$("#"+r+"Comp-errorcondition").fadeIn("slow")},h.onHourShowCallback=function(n){var t=!1;if(Site.horeca.elencoTurniMenu!=null)for(i=0;i<Site.horeca.elencoTurniMenu.length;i++)n>=parseInt(Site.horeca.elencoTurniMenu[i].oraInizio)&&n<=parseInt(Site.horeca.elencoTurniMenu[i].oraFine)&&(t=!0);else t=!0;return t},h.onMinuteShowCallback=function(n,t){var r=!1;if(Site.horeca.elencoTurniMenu!=null)for(i=0;i<Site.horeca.elencoTurniMenu.length;i++)(n==parseInt(Site.horeca.elencoTurniMenu[i].oraInizio)&&t>=parseInt(Site.horeca.elencoTurniMenu[i].minutiInizio)||n>parseInt(Site.horeca.elencoTurniMenu[i].oraInizio)&&n<parseInt(Site.horeca.elencoTurniMenu[i].oraFine)||n==parseInt(Site.horeca.elencoTurniMenu[i].oraFine)&&t<=parseInt(Site.horeca.elencoTurniMenu[i].minutiFine))&&(r=!0);else r=!0;return r},h.centerInfo=function(n,t){var i=$("#"+n+"Comp-"+t+"-accordion");$(i).find("#"+n+"Comp-infoprenotazione").hide();$(i).find("#"+n+"Comp-planningmessage").hide();$(i).find("#"+n+"Comp-planningloader").show();$.ajax({type:"POST",url:"/Async/Reservation/GetInfoCentri",dataType:"json",data:{_larghezzaPiantina:$(i).find("input[name=larghezzapiantina]").val(),_altezzaPiantina:$(i).find("input[name=altezzapiantina]").val()},error:function(){$(i).find("#"+n+"Comp-planningloader").hide();$(i).find("#"+n+"Comp-planningmessage").html($(i).find("#"+n+"Comp-planningmessagewarning").val());$(i).find("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(r){var e;if($(i).find("#"+n+"Comp-planningloader").hide(),$(i).find("#"+n+"Comp-infoprenotazione").show(),r.centri.length>0){for(s=0;s<r.centri.length;s++){var u=$("<li class='list-group-item'><\/li>"),f=$("<div class='form-check'><\/div>"),o=$("<label class='form-check-label'><input type='radio' class='form-check-input' data-date-min="+r.centri[s].data_min+" data-date-max="+r.centri[s].data_max+" value='"+r.centri[s].nome+"' name='centers' data-action='select-center' data-identifier='"+t+"'  data-class='"+n+"'"+(r.centri[s].selezionato?"checked":"")+" />"+r.centri[s].nome+"<\/label>");$(f).append(o);$(u).append(f);$(i).find("#"+n+"Comp-infoprenotazione ul.list-centers").append(u)}$(i).find("#"+n+"Comp-infoprenotazione input:radio[name=centers]:checked").length==0&&$(i).find("#"+n+"Comp-infoprenotazione input:radio[name=centers]:first").attr("checked",!0);$(i).find("#"+n+"Comp-infoprenotazione input:radio[name=centers]:checked").trigger("click")}r.centri.length==1?($(i).find(".card-header a.centers").parent().hide(),$(i).find(".card-header a.date").click(),$(i).find("#"+n+"Comp-infoprenotazione .panel-0 button").click()):$(i).find(".card-header a.centers").click();$(i).show();e=1;$(i).find(".card-header .nav-item:visible").each(function(){$(this).find(".step-index").html(e++)})}})},h.saveInfoPrenotazioneResource=function(n,t,i){var r=$("#"+t+"Comp-"+i+"-accordion"),u=[];n=="centers"?u.push($(r).find("input[name=center_selected]").val()):n=="date"?(u.push($(r).find("input[name=date_from]").val()),u.push($(r).find("input[name=date_to]").val()),u.push($(r).find("input[name=max_resources]").val())):(n=="resource"||n=="resource-remove"||n=="resource-add")&&(u.push($(r).find("input[name=resource_code]").val()),u.push($(r).find("input[name=structure_code]").val()),u.push($(r).find("input[name=max_resources]").val()));$.ajax({type:"POST",url:"/Async/Reservation/SaveInfoPrenotazioneResource",dataType:"json",data:{_step:n,_parametri:u},error:function(){$(r).find("#"+t+"Comp-planningloader").hide();$(r).find("#"+t+"Comp-planningmessage").html($("#"+t+"Comp-planningmessagewarning").val());$(r).find("#"+t+"Comp-planningmessage").fadeIn(2e3)},success:function(i){$(r).find("#"+t+"Comp-planningloader").hide();(n=="date"||n=="resource"||n=="resource-remove"||n=="resource-add")&&(i[1]?$(r).find("button[data-action=add-resource]").hide():$(r).find("button[data-action=add-resource]").show())}})},h.updateInfoUserCount=0,h.updateInfoUser=function(n,i,r){$("#"+n+"Comp-"+i+"-accordion").find("."+n+"Comp-userinfo").each(function(){var u=$("#"+n+"Comp-"+i+"-accordion");$(u).find("#"+n+"Comp-planningloader").show();var f=$(this).find(".userregistrationComp-form"),s=$(f).data("pageid"),c=$(f).data("identifier"),o=$(f).attr("id");h.updateInfoUserCount++;$(f).ajaxSubmit({data:{_pageId:s,_componentId:c},dataType:"json",error:function(i,r,f){h.updateInfoUserCount--;$(u).find("#"+n+"Comp-planningloader").hide();t.onAsyncError(i,r,f)},success:function(i){($(u).find("#"+n+"Comp-planningloader").hide(),h.updateInfoUserCount--,h.updateInfoUserCount<0&&(h.updateInfoUserCount=0),console.log(h.updateInfoUserCount),h.updateInfoUserCount==0)&&i.returnedCode=="success"&&($(u).find(".userregistrationComp").replaceWith(i.data),l.bindControls(),y.init(),l.checkAccoutType($("#"+o+' input:checked[name="accounttype"]').val(),o),l.checkPhysicalPerson($("#"+o+' input:checked[name="choice_physicalperson"]').val(),o),$(u).find(".userregistrationComp .formfield_error:visible").length==0||$(u).find(".userregistrationComp .formfield_error:visible").length>0&&$(u).find(".userregistrationComp .formfield_error:visible:not(:empty)").length==0?($(".userloginComp, .userbarComp").each(function(n,t){e.refreshComponent($(t),null,null,null)}),r!=null&&r!=-1&&($(u).find(".card-header li[data-item-index="+(parseInt(r,10)+1)+"]").find("a").removeClass("disabled"),$(u).find(".card-header li[data-item-index="+(parseInt(r,10)+1)+"]").find("a").click())):$(u).find(".userregistrationComp .formfield_error:not(:empty)").length>0&&t.scrollTo($(container).find(".userregistrationComp .formfield_error:not(:empty)").first().offset().top))}})})},h.menuCheckCenter=function(n,t){var i=$("#"+n+"Comp-"+t+"-accordion");$(i).find("#"+n+"Comp-planningmessage").hide();$(i).find("#"+n+"Comp-piantina").html("");$(i).find(".infoprenotazione input[name=center_selected]").val()!=""?($(i).find("#"+n+"Comp-planningloader").show(),$.ajax({type:"POST",url:"/Async/Reservation/GetPiantinaCenter",dataType:"json",data:{_center:$(i).find("input[name=center_selected]").val(),_data_from:$(i).find("input[name=date_from]").val(),_data_to:$(i).find("input[name=date_to]").val(),_larghezzaPiantina:$(i).find("input[name=larghezzapiantina]").val(),_altezzaPiantina:$(i).find("input[name=altezzapiantina]").val()},error:function(){$(i).find("#"+n+"Comp-planningloader").hide();$(i).find("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$(i).find("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(r){var u,f,e;$(i).find(".header-piantina-date").html("");$(i).find(".header-piantina-date").html($("input[name=date_from]").val()+" - "+$("input[name=date_to]").val());$(i).find("#"+n+"Comp-piantina").css({height:r.dimY,width:r.dimX,"background-repeat":"no-repeat"});r.piantina!=null?$(i).find("#"+n+"Comp-piantina").css({"background-image":'url("'+r.piantina+'")'}):$(i).find("#"+n+"Comp-piantina").css({"background-image":""});for(risorsa in r.risorse)u="top: "+r.risorse[risorsa].posY+"px; left: "+r.risorse[risorsa].posX+"px; width: "+r.risorse[risorsa].dimX+"px; height: "+r.risorse[risorsa].dimY+"px; line-height: "+r.risorse[risorsa].dimY+"px;",r.risorse[risorsa].tavoloTondo&&(u+="-moz-border-radius: "+r.risorse[risorsa].dimX/2+"px/"+r.risorse[risorsa].dimY/2+"px; -webkit-border-radius: "+r.risorse[risorsa].dimX/2+"px/"+r.risorse[risorsa].dimY/2+"px; border-radius: "+r.risorse[risorsa].dimX/2+"px/"+r.risorse[risorsa].dimY/2+"px;"),r.risorse[risorsa].rotazione!=0&&(u+="transform:rotate("+r.risorse[risorsa].rotazione+"deg);-moz-transform:rotate("+r.risorse[risorsa].rotazione+"deg);-webkit-transform:rotate("+r.risorse[risorsa].rotazione+"deg);-o-transform:rotate("+r.risorse[risorsa].rotazione+"deg);-ms-transform:rotate("+r.risorse[risorsa].rotazione+"deg);"),f="",r.risorse[risorsa].isRisorsa?(e="resourceCellEnabled",r.risorse[risorsa].disponibile||(e="resourceCellDisabled"),r.risorse[risorsa].selezionata&&(e+=" resourceCellSelected"),f='<a id="cell_'+risorsa+'" class="resourceCell '+e+'" style="'+u+'" title="'+r.risorse[risorsa].nome+'">'+r.risorse[risorsa].nome+"<\/a>"):f='<a id="cell_'+risorsa+'" class="objectCell" style="'+u+'">&nbsp;<\/a>',$(i).find("#"+n+"Comp-piantina").append(f),r.risorse[risorsa].isRisorsa&&($("#cell_"+risorsa).attr("data-class",n),$("#cell_"+risorsa).attr("data-identifier",t),$("#cell_"+risorsa).attr("data-resource",r.risorse[risorsa].nome),$("#cell_"+risorsa).attr("data-article",r.risorse[risorsa].articoloPredefinito),r.risorse[risorsa].disponibile&&$("#cell_"+risorsa).attr("data-action","select-resource"));$(i).find("#"+n+"Comp-planningloader").hide();$(i).find("#"+n+"Comp-content-piantina").show(500)}})):($(i).find("#"+n+"Comp-content-piantina").hide(500),$(i).find("#"+n+"Comp-planningloader").hide())},h.getResourceVariation=function(n,t,i){var r=$("#"+n+"Comp-"+t+"-accordion"),u;$(r).find("#"+n+"Comp-planningloader").show();$(i).find(".modal-resource-header").html("");$(i).find(".modal-resource-body").html("");u=$(i).find("input[name=structure_code]").val();$.ajax({type:"POST",url:"/Async/Reservation/GetTemplateQuickConfiguratorResource",dataType:"json",data:{_article:$(i).find("input[name=article_code]").val(),_componentId:t,_article_selected:u},error:function(){$(r).find("#"+n+"Comp-planningloader").hide();$(r).find("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$(r).find("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(f){$(r).find("#"+n+"Comp-planningloader").hide();$(i).find(".modal-resource-header").html(f[0]);$(i).find("input[name=structure_code]").val(f[2]);$(i).find("input[name=article_id]").val(f[3]);$(i).find(".modal-resource-body").html(f[1]);var e=a.getStructure(t,!0);h.getPriceResource(e,f[2],n,t);u!=""?($(i).find(".close_resource").hide(),$(i).find(".delete_resource").show()):($(i).find(".close_resource").show(),$(i).find(".delete_resource").hide());$(i).modal("show")}})},h.getPriceResource=function(n,t,i,r){var u=$("#"+i+"Comp-"+r+"-accordion");$.ajax({type:"POST",url:"/Async/Reservation/GetTotalResource",dataType:"json",data:{_article:n!=null?$(u).find("input[name=article_id]").val():$(u).find("input[name=article_code]").val(),_struttura:n,_risorsa:$(u).find("input[name=resource_code]").val()},error:function(){$(u).find("#"+i+"Comp-planningloader").hide();$(u).find("#"+i+"Comp-planningmessage").html($("#"+i+"Comp-planningmessagewarning").val());$(u).find("#"+i+"Comp-planningmessage").fadeIn(2e3)},success:function(n){$(u).find("#"+i+"Comp-planningloader").hide();n[0]?($(u).find("[data-action=confirm-resource]").show(),$(u).find("[data-action=add-resource]").show(),$(u).find(".modal-resource-price .value-total").html(n[1]),$(u).find("input[name=structure_code").val(n[2]),$(u).find(".modal-resource-price").show(),$(u).find(".modal-resource-message").hide()):($(u).find("[data-action=confirm-resource]").hide(),$(u).find("[data-action=add-resource]").hide(),$(u).find(".modal-resource-price").hide(),$(u).find(".modal-resource-message").show())}})},h.getPaymentModes=function(n,t,r){var u=$("#"+t+"Comp-"+r+"-accordion");$(u).find("#"+t+"Comp-planningloader").show();$.ajax({type:"POST",url:"/Async/Reservation/GetBilling",data:{_classComponent:t},dataType:"json",error:function(){$(u).find("#"+t+"Comp-planningloader").hide();$(u).find("#"+t+"Comp-planningmessage").html($("#"+t+"Comp-planningmessagewarning").val());$(u).find("#"+t+"Comp-planningmessage").fadeIn(2e3)},success:function(r){$(u).find("#"+t+"Comp-planningloader").hide();var f=$(u).find("#"+t+"Comp-infoprenotazione ul.list-payments");for($(f).html(""),i=0;i<r.length;i++)for(i=0;i<r.length;i++)$("<li id='billing_item_"+r[i].id+"' class='billing_item list-group-item'><div class='form-check'><label class='form-check-label'><input type='radio' value='"+r[i].id+"' "+(r[i].selected?"checked='checked'":"")+" name='billing' class='form-check-input'>"+r[i].descrizione+(r[i].oneclick!=null?"<div id='billingcard_"+r[i].id+"' class='billingcard' "+(r[i].selected?"":"style='display:none'")+">"+r[i].oneclick+"<\/div>":"")+(r[i].extraData!=undefined&&r[i].extraData!=null?"<div id='billingcard_extradata_"+r[i].id+"' class='billingcard_extradata' >"+r[i].extraData+"<\/div>":"")+"<\/input><\/label><\/div><\/li>").appendTo(f);$(".card-header li[data-item-index="+(parseInt(n,10)+1)+"]").find("a").removeClass("disabled");$(".card-header li[data-item-index="+(parseInt(n,10)+1)+"]").find("a").click()}})},h.showReservationResource=function(n,i){t.checkBraintree(n).then(t=>{var r=$("#"+n+"Comp-"+i+"-accordion"),u;$(r).find("."+n+"Comp-summary").html("");$(r).find("#"+n+"Comp-planningloader").show();u=null;$(r).find("#"+n+"Comp-billing").length>0&&(u=$(r).find("#"+n+"Comp-billing input[name=billing]:radio:checked").val());var f=$(r).find("#"+n+"Comp-billing input[name='billingcard_"+u+"']:checked").val(),e=$(r).find("#"+n+"Comp-billing input[name='remembercard_"+u+"']:checked").val(),o=$(r).find("#"+n+"Comp-billing input[name=findomestic_prf]:checked").val(),s=$(r).find("#"+n+"Comp-billing input[name=findomestic_code_finalita]").val();$.ajax({type:"POST",url:"/Async/Reservation/ShowReservationResource",data:{_billing:u==null?null:u,_card:f,_remembercard:e,_findomestic_prf:o,_findomestic_code_finalita:s,_braintree_paymentnonce:t!=null?t.nonce:null,_braintree_paymentdevicedata:t!=null?t.deviceData:null},dataType:"json",error:function(){$(r).find("#"+n+"Comp-planningloader").hide();$(r).find("#"+n+"Comp-planningmessage").html($("#"+n+"Comp-planningmessagewarning").val());$(r).find("#"+n+"Comp-planningmessage").fadeIn(2e3)},success:function(t){$(r).find("#"+n+"Comp-planningloader").hide();h.showSummaryReservationResource(t,n,i)}})})},h.showSummaryReservationResource=function(n,i,r){var u=$("#"+i+"Comp-"+r+"-accordion"),f=t.getParamsId($("body").attr("id")).id;$.ajax({type:"POST",url:"/Async/Reservation/ShowSummaryReservationResource",data:{_reservation_id:n,_pageId:f,_componentId:r},dataType:"html",error:t.onAsyncError,success:function(n){$(u).find("."+i+"Comp-summary").html(n)}})},h.confirmReservationResource=function(n,t,i){!t||$("#"+i+"Comp-checkcondition").is(":checked")?window.location.href="/store/reservation/confirmresource/"+n:$("#"+i+"Comp-errorcondition").fadeIn("slow")},lt=function(){},lt.images_gallery=[],lt.loadZoom=function(n){var i=$(n).attr("data-gallery");const t=i.split(";");$(n).ezPlus(parseInt(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseInt(t[3]),parseInt(t[4]),parseInt(t[5]),parseInt(t[6]),parseInt(t[7]),parseInt(t[8]))},lt.change=function(n){var e=n.split("_"),o,s,i,u,h,c,f;if(_className=e[1]+"-"+e[2],o=e[2]=="",_isResponsive){var t=[],l=[],r=$(".gallery-productimage").data("gallery-column");for((r==undefined||r=="")&&(r=$(".carousel-item").first().find("figure").length),lt.images_gallery.length>0||(s=[],$(".gallery-productimage figure").each(function(){var n=$(this).find("a").attr("data-product-page").split("/");s.indexOf(n[n.length-1])<0&&(s.push(n[n.length-1]),lt.images_gallery.push($(this)))})),$.each(lt.images_gallery,function(n,i){o?t.push($(this)):$(i).hasClass(_className)?t.push($(this)):$(i).hasClass("all")?t.push($(this)):l.push($(i))}),i=t.length,u=0,$(".carousel-item").each(function(n,f){var e,o;if($(f).html(""),i>0)for(e=0;e<r;e++)o=t[0],$(o).attr("data-index",u),$(f).append(o),t.splice(0,1),i--,u++;else i<=0&&$(f).remove()});i>0;){for(h=$('<div class="carousel-item"><\/div>'),c=0;c<r;c++)if(f=t[0],f!=undefined)$(f).attr("data-index",u),$(h).append(f),t.splice(0,1),i--,u++;else break;$(".gallery-productimage .carousel-inner .carousel-item").last().after(h)}$(".carousel-item").length==1?$(".ecFieldimageComp .gallery-productimage .carousel-control-prev, .ecFieldimageComp .gallery-productimage .carousel-control-next").hide():$(".ecFieldimageComp .gallery-productimage .carousel-control-prev, .ecFieldimageComp .gallery-productimage .carousel-control-next").show();$(".ecFieldimageComp .link-to-lb").attr("data-index",0);$(".carousel-item").first().addClass("active")}else $(".gallery-productimage li").each(function(){o?($(this).show(),$(this).find("a.imagegalleryComp-image").attr("rel","prettyPhoto"+$(this).find("a.imagegalleryComp-image").attr("rel").replace("prettyPhoto",""))):$(this).hasClass(_className)?($(this).show(),$(this).find("a.imagegalleryComp-image").attr("rel","prettyPhoto"+$(this).find("a.imagegalleryComp-image").attr("rel").replace("prettyPhoto",""))):$(this).hasClass("all")?($(this).show(),$(this).find("a.imagegalleryComp-image").attr("rel","prettyPhoto"+$(this).find("a.imagegalleryComp-image").attr("rel").replace("prettyPhoto",""))):($(this).hide(),$(this).find("a.imagegalleryComp-image").attr("rel",$(this).find("a.imagegalleryComp-image").attr("rel").replace("prettyPhoto","")))}),$("a[rel^='prettyPhoto']").prettyPhoto({social_tools:"",theme:"pp_default",slideshow:3e3,show_title:!1,deeplinking:!1})},lt.changeImage=function(){if(!_isResponsive)try{imageFading(image,imageZoom,null)}catch(n){}},lt.init=function(){if(_isResponsive){this.images_gallery=[];$(".ecFieldimageComp  .carousel").on("slide.bs.carousel",function(n){$(n.currentTarget).carousel("pause")});$(".ecFieldimageComp .primaryProductImage").on("click","img",function(n){n.preventDefault();n.stopPropagation();n.stopImmediatePropagation();$(this).prev(".link-to-lb").click()});$(".ecFieldimageComp").on("click",".link-to-lb",function(n){n.preventDefault();n.stopPropagation();n.stopImmediatePropagation();var t=$(this).attr("data-index");return(t==undefined||t==null)&&(t=0),$(this).parents(".ecFieldimageComp").first().find(".carousel-item > [data-index='"+t+"'] a").click(),!1});$(".ecFieldimageComp").on("mouseenter",".carousel-item picture img",function(){var t=$(this).parents(".ecFieldimageComp").first().find(".link-to-lb"),r=$(this).prev("a").attr("href"),h=$(this).prev("a").attr("data-size"),i,f,n,u;if(i=window.matchMedia("(max-width: 575px)").matches?$(this).prev("a").attr("data-product-page-mobile"):$(this).prev("a").attr("data-product-page"),$(this).closest(".ecFieldimageComp").find(".img_zommed")!=null&&$(this).closest(".ecFieldimageComp").find(".img_zommed")[0]){$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlusDestroy();f=$(this).closest(".ecFieldimageComp").find(".img_zommed").attr("data-gallery");const n=f.split(";");$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlus(parseInt(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),parseInt(n[8]))}t.attr("href",r).attr("data-size",h);t.parent().find("img").attr("src",r);n=i.split("?");n.length==1&&(u=r.split("?"),u.length>1&&n.push(u[1]));var e=n[0].substring(0,n[0].lastIndexOf("."))+".webp"+(n.length>1?"?"+n[1]:""),o=t.parent().find("source[srcset*='.webp']"),s=t.parent().find("source[srcset*='.jpeg']");o.length>0&&o.each(function(n,t){var i=$(t);i.data("srcset")&&i.attr("data-srcset",e);i.attr("srcset",e)});s.length>0&&s.each(function(n,t){var r=$(t);r.data("srcset")&&r.attr("data-srcset",i);r.attr("srcset",i)});t.attr("data-index",$(this).closest("figure").attr("data-index"))});$(".ecFieldimageComp .primaryProductImage .carousel-control-prev, .ecFieldimageComp .primaryProductImage .carousel-control-next").click(function(n){n.preventDefault();n.stopPropagation();n.stopImmediatePropagation();var i=$(this).parents(".ecFieldimageComp").first().find(".link-to-lb"),t=i.attr("data-index");return(t==undefined||t==null)&&(t=0),$(this).hasClass("carousel-control-next")?(t++,$(this).parents(".ecFieldimageComp").first().find(".carousel-item > [data-index='"+t+"'] a").length==0&&(t=0)):(t--,t<0&&(t=$(this).parents(".ecFieldimageComp").first().find(".carousel-item > [data-index]").last().attr("data-index"))),$(this).parents(".ecFieldimageComp").first().find(".carousel-item > [data-index='"+t+"'] img").mouseenter(),!1})}else $(".ecFieldimageComp").each(function(){$(this).find("a[rel^='prettyPhoto']").prettyPhoto({social_tools:"",theme:"pp_default",slideshow:3e3,show_title:!1,deeplinking:!1})}),$('.imagegalleryComp ul:not(".pager")').each(function(){$(this).data("social")?$(this).find("a[rel^='prettyPhoto']").prettyPhoto({theme:$(this).data("theme"),slideshow:3e3,deeplinking:!1}):$(this).find("a[rel^='prettyPhoto']").prettyPhoto({social_tools:"",theme:$(this).data("theme"),slideshow:3e3,deeplinking:!1})})},PWLightBox=function(){},PWLightBox.init=function(){$(".pw-lightbox").each(function(n,t){$(t).hasClass("pw-loaded")||($(t).load(urlFileStatici+"/Web/MDBPro/mdb-addons/mdb-lightbox-ui.html"),$(t).addClass("pw-loaded"))})},PWLightBox.reload=function(){$(".mdb-lightbox").addClass("loading");setTimeout(function(){try{initPhotoSwipeFromDOM(".mdb-lightbox")}catch(n){}PWLightBox.init();$(".mdb-lightbox").removeClass("loading")},1)},w=function(){},w.keepBranchOpen=function(n,t,i,r){n!=undefined&&(r==2?$.ajax({url:"/Async/keepMenuItemOpen/",data:{_menuId:n,_entryId:t,_open:i},async:!1,dataType:"json",type:"post",success:function(){}}):$.ajax({url:"/Async/keepMenuItemOpen/",data:{_menuId:n,_entryId:t,_open:i},dataType:"json",type:"post",success:function(){}}))},w.toggleAccordion=function(){var n=$(this),u=n.hasClass("fa-caret-down"),t,i,r;n.data("parent")!=""&&(t=$(n.data("parent")),t.find(".accordion").removeClass("fa-caret-up").addClass("fa-caret-down"),t.find(".accordion-target").hide());i=parseInt(n.data("fadetime"));r=n.data("collapse");u?($(r).show(i),n.removeClass("fa-caret-down").addClass("fa-caret-up")):($(r).hide(i),n.removeClass("fa-caret-up").addClass("fa-caret-down"))},w.toggleBranch=function(n){var i,r,e,f;if(_isResponsive&&(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault()),i=$(this).parents('[data-menu="1"]'),r=parseInt($(i).data("fadetime")),$(i).data("closeopenedbranch")&&(e=$(this).parent().attr("id"),$(this).parent().siblings("li").find(".toggleBranch.openedBranch").each(function(){if(e!=$(this).parent().attr("id")){$(this).removeClass("openedBranch");$(i).data("has-imageopenbranch")?$(this).children("img").attr("src",$(i).data("imageopenbranch")):_isResponsive?$(this).html('<i class="fa fa-plus" aria-hidden="true"><\/i>'):$(this).text("[+]");_isResponsive?$(this).parent().children("ul").addClass("d-none",r):$(this).parent().children("ul").hide(r);var n=w.getParamsId($(this).parent().attr("id"));w.keepBranchOpen(n.menuId,n.entryId,!1,$(i).data("openbranchonclick"))}})),$(this).hasClass("openedBranch"))$(this).removeClass("openedBranch"),$(i).data("has-imageopenbranch")?$(this).children("img").attr("src",$(i).data("imageopenbranch")):_isResponsive?$(this).html('<i class="fa fa-plus" aria-hidden="true"><\/i>'):$(this).text("[+]"),_isResponsive?($(this).parent().children("ul").hasClass("collapse")&&$(this).parent().children("ul").hide(r).removeClass("show_sub_menu").removeClass("show"),$(this).parent().children("ul").addClass("d-none",r)):$(this).parent().children("ul").hide(r),($(i).hasClass("cmsCategoriesmenuComp")||$(i).hasClass("menuComp")||$(i).hasClass("ecContextualcategorymenuComp"))&&(f=w.getParamsId($(this).parent().attr("id")),w.keepBranchOpen(f.menuId,f.entryId,!1,$(i).data("openbranchonclick")));else{if($(this).addClass("openedBranch"),$(i).data("has-imageclosebranch")?$(this).children("img").attr("src",$(i).data("imageclosebranch")):_isResponsive?$(this).html('<i class="fa fa-minus" aria-hidden="true"><\/i>'):$(this).text("[-]"),$(i).data("onrequest")==1&&$(this).parent().find("ul").length==0){var u=$(this).parent(),o=w.getParamsId(u.data("entry-id")),s=$(u).attr("data-root-id")?u.data("root-id"):0,h=$(i).data("class-ul"),c=$(i).data("collector");$.ajax({url:"/Async/loadComponentMenuItem/",type:"post",data:{_pageId:t.getParamsId($("body").attr("id")).id,_componentId:o.menuId,_typeComponent:0,_entryId:o.entryId,_rootId:s,_collector:c},dataType:"json",success:function(n){_isResponsive?($(u).append('<ul class="'+h+'">'+n.data+"<\/ul>"),$(u).find("ul").removeClass("d-none").show(r).css({display:""})):($(u).append('<ul style="display: none;">'+n.data+"<\/ul>"),$(u).find("ul").show(r));$('[data-has-openbranchonclick="true"] .toggleBranch').next("a").off("click",w.bindMenuVoice);$('[data-has-openbranchonclick="true"] .toggleBranch').next("a").on("click",w.bindMenuVoice);$('[data-keepbranchesopen="true"] a').on("mouseover",w.bindVoiceOver())}})}else _isResponsive?($(this).parent().children("ul").hasClass("collapse")&&$(this).parent().children("ul").show(r).addClass("show_sub_menu").addClass("show"),$(this).parent().children("ul").removeClass("d-none").show(r).css({display:""})):$(this).parent().children("ul").show(r);($(i).hasClass("cmsCategoriesmenuComp")||$(i).hasClass("menuComp")||$(i).hasClass("ecContextualcategorymenuComp"))&&(f=w.getParamsId($(this).parent().attr("id")),w.keepBranchOpen(f.menuId,f.entryId,!0,$(i).data("openbranchonclick")))}},w.bindMenuVoice=function(n){n.preventDefault();$(this).prev(".toggleBranch").click();var t=$(this).parents('[data-menu="1"]');$(t).data("openbranchonclick")==2&&(window.location=$(this).attr("href"))},w.bindVoiceOver=function(){$(this).parent("li").siblings("li").each(function(){$(this).children("ul").hasClass("s")&&($(this).children("ul").removeClass("s"),$(this).children("ul").css("visibility","hidden"),$(this).children("ul").find(".s").removeClass("s").css("visibility","hidden"))});$(this).siblings("ul").each(function(){$(this).hasClass("s")||($(this).addClass("s"),$(this).css("visibility","visible"))})},w.getParamsId=function(n){var t=/menu_entry_([0-9]+)_([0-9]+)/.exec(n);return t!=null?{htmlId:t[0],menuId:t[1],entryId:t[2]}:null},w.registerHandlers=function(){if(_isResponsive){$(document).off("click",".cmsBookindexComp.listresponsive i.accordion",w.toggleAccordion);$(document).on("click",".cmsBookindexComp.listresponsive i.accordion",w.toggleAccordion);$(document).off("click",".cmsCategoriesmenuComp.listresponsive i.accordion",w.toggleAccordion);$(document).on("click",".cmsCategoriesmenuComp.listresponsive i.accordion",w.toggleAccordion);$(document).off("click",".ecContextualcategorymenuComp.listresponsive i.accordion",w.toggleAccordion);$(document).on("click",".ecContextualcategorymenuComp.listresponsive i.accordion",w.toggleAccordion)}$(document).off("click",".cmsBookindexComp .toggleBranch, .cmsCategoriesmenuComp .toggleBranch, .menuComp .toggleBranch, .ecContextualcategorymenuComp .toggleBranch",w.toggleBranch);$(document).on("click",".cmsBookindexComp .toggleBranch, .cmsCategoriesmenuComp .toggleBranch, .menuComp .toggleBranch, .ecContextualcategorymenuComp .toggleBranch",w.toggleBranch);$('[data-has-openbranchonclick="true"] .toggleBranch').next("a").off("click",w.bindMenuVoice);$('[data-has-openbranchonclick="true"] .toggleBranch').next("a").on("click",w.bindMenuVoice);$('[data-keepbranchesopen="true"] a').on("mouseover",w.bindVoiceOver())},w.init=function(){},et=function(){},et.modify=function(n){n!="0"&&$.ajax({type:"POST",url:"/Async/Orders/Modify",data:{_id:n},dataType:"json",error:t.onAsyncError,success:function(n){TrackerPW.TP.productToCart(n,tipologiaCart.cart);n.redirect!=null&&(window.location.href="/"+n.redirect)}})},et.cancel=function(n){n!="0"&&t.showConfirm(null,Site.orders.confirmCancel,n)},et.confirmCancel=function(n){$.ajax({type:"POST",url:"/Async/Orders/Cancel",data:{_id:n},error:t.onAsyncError,success:function(){t.closeJgrowl();e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.orders],null),null,!1,null,null)}})},et.cancelModify=function(n){n!=0&&$.ajax({type:"POST",url:"/Async/Orders/StopModify",data:{_id:n},dataType:"json",error:t.onAsyncError,success:function(n){TrackerPW.TP.productToCart(n,tipologiaCart.cart);e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.cart,tipologiaRefresh.minicart,tipologiaRefresh.giftselection],tipologiaCart.cart),null,!0,null,null)}})},et.addArticlesToCart=function(n){$.ajax({type:"POST",url:"/Async/Orders/AddArticlesOrder",data:{_id:n},dataType:"json",error:t.onAsyncError,success:function(n){n.errore?n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio):(TrackerPW.TP.productToCart(n,tipologiaCart.cart),n.redirect!=null&&(window.location.href="/"+n.redirect))}})},et.handleAction=function(){switch($(this).data("action")){case"activeOrder":window.location.href="?t=1";break;case"waybillOrder":window.location.href="?t=2";break;case"billOrder":window.location.href="?t=3";break;case"rmaOrder":window.location.href="?t=4";break;case"creditOrder":window.location.href="?t=5";break;case"reservation":window.location.href="?t=6";break;case"matriciOrder":window.location.href="?t=7";break;case"cancelReservation":Site.reservation.cancel($(this).data("entryid"));break;case"modifyOrders":et.modify($(this).data("entryid"));break;case"cancelOrders":Site.orders.cancel($(this).data("entryid"));break;case"createRma":Site.rma.create($(this).data("entryid"))}},et.registerHandlers=function(){$(document).on("click",".ecOrdersComp [data-action]",et.handleAction)},et.init=function(){$(".ecOrdersComp").each(function(){_isResponsive?($($(this).find(".tabsComp-tabs").find("li").get($(this).data("index-tab"))).find(".nav-link").addClass("active"),$(this).find(".tabsComp-tabs-select").val("#"+$(this).find(".tabsComp-tabs").find(".nav-link.active").attr("id")),$(this).find(".tabsComp-tabs").tab()):($(this).find(".tabsComp-tabs").tabs(),$(this).find(".tabsComp-tabs").tabs("option","active",$(this).data("index-tab")));$(this).data("is-check-reservation")&&Site.reservation.check()})},a=function(){},a.size=function(n,t){var e=0,u=[],i=0,r,f;return t?(i=$("[id="+n+"_quantity]:visible").val(),i==""&&(i=1),r=$("[id="+n+"_quantity]:visible").closest(".sizeminimal").find("[id="+n+"_quantity_size]"),r!=null&&(r.data("ddslick")!=null&&r.data("ddslick").selectedData!=null&&r.data("ddslick").selectedData.value!=""?u.push([r.data("ddslick").selectedData.value,i]):r.val()!=""&&u.push([r.val(),i]),u.length>0&&(e=i))):$("."+n+"_quantity_size:visible").each(function(){i=$(this).val();i!=""&&i!=0&&(u.push([$(this).attr("id").replace(n+"_quantity_",""),i]),e+=parseInt(i))}),f={},f.size=u,f.quantity=e,f},a.isSizeMandatory=function(n,t,i){var r=t?"#"+n+"_quantity_size":"."+n+"_quantity_size";$(r).each(function(){var n=$(this).css("background-color"),t;$(this).animate({backgroundColor:i},600,function(){$(this).animate({backgroundColor:n},600,function(){$(this).css({"background-color":""},600)})});$(this).find(".dd-select").length>0&&(n=$(this).find(".dd-select").css("background-color"),t=$(this).find(".dd-select"),t.animate({backgroundColor:i},600,function(){t.animate({backgroundColor:n})}))})},a.checkQuantity=function(n,t,i){var f,r,u;($(t).attr("data-min")!=null||$(t).attr("data-max")!=null)&&(f=parseFloat($(t).attr("data-min")),r=parseFloat($(t).attr("data-max")),$(t).hasClass("size")?(u=Site.product.size((_isResponsive?$(t).data("identifier")+"-":"")+i,!1),u.quantity>r&&($(n).val()>u.quantity-r?$(n).val($(n).val()-(u.quantity-r)):$(n).val(0)),u.quantity<f&&$(n).val(f-u.quantity)):(parseFloat($(n).val().replace(",","."))<f&&$(n).val(f),parseFloat($(n).val().replace(",","."))>r&&$(n).val(r)))},a.checkQtaBoxArticles=function(n,t,i){$(document).on("change","#"+n+" .quantity",function(){var u=$(this).closest(".ecSetproductsboxComp-cell").data("cellidentifier"),r=$(this).closest(".ecFieldaddtocartComp"),t;r.length>0&&(a.checkQuantity(this,r,u),t=0,$("#"+n+" .ecSetproductsboxComp-cell").each(function(){var n=$(this).data("cellidentifier");$("input[name^='"+n+"_quantity']:visible").each(function(){t+=parseFloat($(this).val().replace(",","."))})}),t>i&&(parseFloat($(this).val())>=t-i&&$(this).val(parseFloat($(this).val())-(t-i)),$("#"+n+" .ecSetproductsboxComp-range").length>0&&$("#"+n+" .ecSetproductsboxComp-range")[0].innerText!=""&&$.jGrowl($("#"+n+" .ecSetproductsboxComp-range")[0].innerText,{life:3e3})),a.updateInfoBox(n))})},a.updateInfoBox=function(n){var t=Site.product.qtaBoxArticles(n,!1);$.ajax({type:"POST",url:"/Async/EcSetproductsbox/SetBoxConfig",data:{_articles:JSON.stringify(t.articles)},error:Site.global.onAsyncError,success:function(){var t=[],n;$(".primarypriceproduct").each(function(){t.push($(this).closest(".ecFieldpriceComp"))});dt.refreshPrice(t,!1,1);n=[];$(".availabilityprocuct").each(function(){n.push($(this).closest(".ecMexalAvailabilityComp"))});ei.refreshAvailability(n)}})},a.qtaBoxArticles=function(n,t){var i=!0,u=[],f=$("#"+n+" .ecSetproductsboxComp-cells").data("minglobalqta"),e=$("#"+n+" .ecSetproductsboxComp-cells").data("maxglobalqta"),r=0;return $("#"+n+" .ecSetproductsboxComp-cell").each(function(){var e=$(this).data("cellidentifier"),n=$(this).find(".ecFieldaddtocartComp:visible"),o,f;n.length>0?$("input[name^='"+e+"_quantity']").length>0?(o=0,$("input[name^='"+e+"_quantity']").each(function(){o+=parseFloat($(this).val())}),(o>0||!(parseFloat($(n).attr("data-min"))==0))&&(f=a.qtaArticle((_isResponsive?$(n).data("identifier")+"-":"")+e,$(n).hasClass("size"),!1,$(n).hasClass("structure"),!1,$(n).hasClass("options"),t?$(n).attr("data-animation"):null,t),f.success||!t?parseFloat(f.quantity)>0&&u.push({id:$(n).attr("data-pid"),tagliestr:JSON.stringify(f.size),struttura:f.structure,opzioni:f.options,quantita:f.quantity.toString().replace(",","."),idPadreStruttura:$(n).attr("data-pidpadre"),unitaMisuraSecondaria:$(n).attr("data-ums")}):i=!1,r+=parseFloat(f.quantity))):parseFloat($(n).attr("data-min"))==0||(i=!1):i=!1}),(r<parseFloat(f)||r>parseFloat(e))&&(i=!1),{articles:u,success:i}},a.qtaTableArticles=function(n,t){var i=0,r=0,u=[];return $("#configtable_"+n+" .configuratorTableData").each(function(){var e=$(this).data("cellidentifier"),n=$(this).find(".ecFieldaddtocartComp:visible"),o,f;n.length>0&&$("input[name^='"+e+"_quantity']").length>0&&(o=0,$("input[name^='"+e+"_quantity']").each(function(){o+=parseFloat($(this).val())}),o>0&&(f=a.qtaArticle((_isResponsive?$(n).data("identifier")+"-":"")+e,$(n).hasClass("size"),!0,$(n).hasClass("structure"),!1,$(n).hasClass("options"),t?$(n).attr("data-animation"):null,t),i++,f.success&&parseFloat(f.quantity)>0&&(r++,u.push({id:$(n).attr("data-pid"),tagliestr:JSON.stringify(f.size),struttura:f.structure,opzioni:f.options,quantita:f.quantity.toString().replace(",",".")}),success=!0)))}),{articles:u,success:i>0&&i==r}},a.qtaArticle=function(n,i,r,u,f,e,o,s){var d=null,y=null,p=null,v=null,l=0,h=!0,g=t.getParamsIdentifier(n),c=g!=null?g.id:n,w,b,k;return i?(w=a.size(n,r),d=w.size,l=w.quantity,l==0&&(a.isSizeMandatory(n,r,o),h=!1)):l=$("[id="+n+"_quantity]:visible").val(),u&&($("#configtable_"+c).length>0&&$("#configtable_"+c).is(":visible")?(b=a.qtaTableArticles(c,s),h=b.success,p=b.articles,l=1):(y=a.getStructure(c,s),y==null&&(h=!1))),e&&($("#"+n+"_options").length>0?v=$("#"+n+"_options").val():$("#optionsform_"+c).length>0&&(v=st.sumbitForm(c),v==null&&(h=!1))),f&&$(".ecSetproductsboxComp").length>0&&(k=a.qtaBoxArticles($($(".ecSetproductsboxComp")[0]).attr("id"),!0),h=k.success,p=k.articles),{size:d,structure:y,quantity:l,options:v,articles:p,success:h}},a.getStructure=function(n,t){var r=null;if($("#"+n+"_structure").length>0)r=$("#"+n+"_structure").val();else{var u="GetStructure_",i=window[u+n],f=[t,!0,!1,!0];typeof i=="function"?r=i.apply(this,f):$.each(window,function(n){if(n.match("^"+u))return i=window[n],typeof i=="function"&&(r=i.apply(this,f)),!0})}return r},a.availabilityComparator=function(n){$("."+n).each(function(){$(this).click()})},a.availability=function(n,i,r,u,f,e,o,s,h){$("#ecMexalAvailability_"+i+"_"+n+"_availability").html(_isResponsive?'<i class="fa fa-spinner fa-spin"><\/i>':'<img src="'+urlFileStatici+'/Web/common/img/common-loader.gif"/>');$.ajax({type:"POST",url:"/Async/MexalAvailability/GetAvailability",data:{_component:i,_article:u,_articlePadre:f,_boxconfiguration:e,_box:o,_boxtable:s,_sizeid:h},dataType:"html",error:t.onAsyncError,success:function(t){$("#ecMexalAvailability_"+i+"_"+n+"_availability").fadeOut(200,function(){$("#ecMexalAvailability_"+i+"_"+n+"_availability").html(t);$("#ecMexalAvailability_"+i+"_"+n+"_availability").fadeIn("fast")})}})},a.setAvailability=function(n){$(".ecMexalAvailabilityComp").each(function(){n!=null?($(this).children().children(".ecMexalAvailabilityComp-button").children(".availability_product").val(n),$(this).children().children(".ecMexalAvailabilityComp-availability").html(""),$(this).children().children(".ecMexalAvailabilityComp-button").show(),$(this).children().children(".ecMexalAvailabilityComp-availability").show()):($(this).children().children(".ecMexalAvailabilityComp-button").hide(),$(this).children().children(".ecMexalAvailabilityComp-availability").hide())})},a.changeImage=function(n,t,i){n!=undefined&&(i==null?($("div.primaryProductImage img").each(function(){var i,r,u;if($(this).attr("src",n),i=$(this).attr("data-src"),i!=undefined&&i!=""&&(r=i.split("?"),$(this).attr("data-src",n+(r.length>1?"?"+r[1]:""))),$(this).parent().attr("href",t),$(this).closest(".ecFieldimageComp").find(".img_zommed")!=null&&$(this).closest(".ecFieldimageComp").find(".img_zommed")[0]){$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlusDestroy();u=$(this).closest(".ecFieldimageComp").find(".img_zommed").attr("data-gallery");const n=u.split(";");$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlus(parseInt(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),parseInt(n[8]))}}),$("div.primaryProductImage a.productimage").each(function(){var n=$(this).attr("href"),i;n!=undefined&&n!=""&&(i=n.split("?"),$(this).attr("href",t+(i.length>1?"?"+i[1]:"")))})):($(".ecFieldimageComp div.primaryProductImage img").each(function(){var i,r,u;if($(this).attr("src",n),i=$(this).attr("data-src"),i!=undefined&&i!=""&&(r=i.split("?"),$(this).attr("data-src",n+(r.length>1?"?"+r[1]:""))),$(this).attr("href",t),$(this).closest(".ecFieldimageComp").find(".img_zommed")!=null&&$(this).closest(".ecFieldimageComp").find(".img_zommed")[0]){$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlusDestroy();u=$(this).closest(".ecFieldimageComp").find(".img_zommed").attr("data-gallery");const n=u.split(";");$(this).closest(".ecFieldimageComp").find(".img_zommed").ezPlus(parseInt(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),parseInt(n[8]))}}),$(".ecFieldimageComp div.primaryProductImage a.productimage").each(function(){var i=$(this).attr("href"),n;i!=""&&(n=i.split("?"),$(this).attr("href",t+(n.length>1?"?"+n[1]:"")))}),$(".ecFieldimageComp div.primaryProductImage source").each(function(){var r=$(this).attr("srcset"),t,i;r!=""&&(t=r.split("?"),i=n.substring(0,n.lastIndexOf("."))+".webp"+(t.length>1?"?"+t[1]:""),$(this).attr("srcset",i),$(this).attr("data-srcset",i))})))},a.handleAction=function(){var r,n,i,f,e;switch($(this).data("action")){case"availabilityComparator":a.availabilityComparator($(this).data("identifier"));break;case"availability":$(this).data("product-elementc")!=null?a.availability($(this).data("identifier"),$(this).data("componentid"),$(this).data("productid"),$(this).data("product-elementc"),$(this).data("product-padrec"),$(this).data("boxconfiguration"),$(this).data("box"),$(this).data("boxtable"),$(this).data("sizeid")):a.availability($(this).data("identifier"),$(this).data("componentid"),$(this).data("productid"),$("#"+$(this).data("product-element")).val(),$("#"+$(this).data("product-padre")).val(),$(this).data("boxconfiguration"),$(this).data("box"),$(this).data("boxtable"),$(this).data("sizeid"));break;case"changeImage":a.changeImage($(this).data("product-page"),$(this).data("zoom"),$(this).data("identifier"));break;case"collapseSetAttribute":$("."+$(this).data("row-group")).hide();$(this).hide();$(this).next().show();break;case"expandSetAttribute":$("."+$(this).data("row-group")).show();$(this).hide();$(this).prev().show();break;case"collapseGroup":r=$(this).attr("id");n=r.split("_");$("."+$(this).data("row-group")+"_"+n[1]).toggle();break;case"scrollSetAttribute":var o=$(this).attr("href"),n=o.split("#"),u=n[1],s=$("#"+u).offset(),h=s.top;return t.scrollTo(h),$("#"+$(this).data("class-identifier")+"_uldiv").slideUp("slow"),i=u.substr(2),$(""+$(this).data("row-group")+"_"+i).css("display")=="none"&&$("."+$(this).data("row-group")+"_"+i).toggle(),!1;case"jumpSetAttribute":return f=$(this).offset().top-$("#"+$(this).data("class-identifier")).offset().top+$(this).height(),e=$(this).offset().left-$("#"+$(this).data("class-identifier")).offset().left,$("#"+$(this).data("class-identifier")+"_uldiv").css({top:f,left:e,float:"left",position:"absolute"}).slideDown("slow"),!1}},a.registerHandlers=function(){$(document).on("click",".ecMexalAvailabilityComp [data-action]",a.handleAction);$(document).on("mouseover",".ecFieldimageComp [data-action]",a.handleAction);$(document).on("click",".ecFieldsetattributeComp",function(){$("#"+$(this).attr("id")+"_uldiv").slideUp("slow")});$(document).on("click",".ecFieldsetattributeComp [data-action]",a.handleAction)},a.init=function(){$('.ecSetproductsboxComp [data-action="checkQtaBoxArticles"]').each(function(){a.checkQtaBoxArticles($(this).data("componentid"),$(this).data("minglobalqta"),$(this).data("maxglobalqta"))})},k=function(){},k.check=function(){$.ajax({url:"/Async/Orders/CheckReservation",dataType:"json",type:"post",success:function(n){try{n.reloadOrdini&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.orders],null),null,!1,null,null);n.continuaCheck&&setTimeout("Reservation.check()",12e4)}catch(t){}}})},k.cancel=function(n){n!="0"&&t.showConfirm(null,Site.reservation.confirmCancel,n)},k.confirmCancel=function(n){$.ajax({type:"POST",url:"/Async/Reservations/Cancel",data:{_id:n},error:t.onAsyncError,success:function(){t.closeJgrowl();e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.orders],null),null,!1,null,null)}})},k.gotoPayPalCheckoutExpress=function(n){var i={_idPagamento:$("#payPalCheckoutExpressPaymentId").val(),_pid:n,_pricepaypal:$("#pricepaypal").val()};$.ajax({type:"POST",url:"/Async/Cart/goToPayPalCheckoutExpressReservation",data:i,dataType:"json",error:t.onAsyncError,success:function(n){n[1]!=""?$.jGrowl(n[1]):window.location.href=n[0]}})},k.goToStep=function(n,t){_isResponsive?($(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")?$(t).removeClass("active"):$(t).slideUp("fast")}),$($(n).find(".card").get(parseInt(t,10))).children().slideDown("slow"),$($(n).find(".card").get(parseInt(t,10))).children(".card-header").addClass("active")):$(n).accordion("option","active",t)},k.showContent=function(n){_isResponsive?alert("TODO Reservation.showContent"):$("."+$(this).data("class")+'Comp-accordion[data-action="checkout-accordion"]').accordion("option","active",n)},k.handleAction=function(){var t,n;switch($(this).data("action")){case"validppcheckoutexpress":$.ajax({type:"POST",url:"/Async/Reservation/ValidPayPalExpressCheckout/",data:{_code:$(".codepp").val(),_payerId:$(".pppayerid").val()},dataType:"json",error:Site.global.onAsyncError,success:function(n){n[1]!=null&&n[1]!=""?($.jGrowl(n[1]),$(".codepp").val("")):window.location.href=n[0]}});break;case"loadPlanning":t=$(this).parents('[data-action="checkout-accordion"]');Site.horeca.loadPlanning($(t).data("class"));break;case"applyvoucher":t=$(this).parents('[data-action="checkout-accordion"]');k.useVoucher($(this),$(t).data("class"));break;case"gotostepcheckout":n=$(this).parents('[data-action="checkout-accordion"]');switch($(this).data("name-step")){case"DateTimeTrattamento":$(this).parent().hasClass("prevStep")?k.goToStep(n,$(this).data("prev-step")):$($(n).find(".oratrattamento")).val()!=""&&($(n).data("has-content-payment")?k.goToStep(n,$(this).data("next-step")):Site.horeca.showReservation($(n).data("class")));break;case"MethodPayment":$(this).parent().hasClass("prevStep")?k.goToStep(n,$(this).data("prev-step")):($(n).data("has-webtracking")&&Site.PWT.loadStepCheckoutReservation(2,2),Site.horeca.showReservation($(n).data("class")));break;case"MenuReservation":$(this).parent().hasClass("prevStep")?k.goToStep(n,$(this).data("prev-step")):$($(n).find(".oratrattamento")).val()!=""&&Site.horeca.menuCheckSelectedTables($(n).data("class"))&&Site.horeca.menuShowReservation($(n).data("class"))}break;case"confirmReservation":Site.horeca.confirmReservation($(this).data("reservationid"),$(this).data("condition"),$(this).data("class"));break;case"menuTurns":n=$(this).parents('[data-action="checkout-accordion"]');Site.horeca.menuTurns($(n).data("class"));break;case"menuCheckTables":n=$(this).parents('[data-action="checkout-accordion"]');Site.horeca.menuCheckTables($(n).data("class"));break;case"confirmReservationMenu":Site.horeca.confirmReservationMenu($(this).data("reservationid"),$(this).data("condition"),$(this).data("class"))}},k.handleActionCenter=function(){var s,c;switch($(this).data("action")){case"select-center":var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion"),u=$(r).find(".infoprenotazione"),y=$(this).data("date-min"),p=$(this).data("date-max");$(u).find("input[name=center_selected]").val($(this).val());$(u).find("input[name=date_min]").val(y);$(u).find("input[name=date_max]").val(p);$(u).find("input[name=date_from]").val()==""&&$(u).find("input[name=date_from]").val($(u).find("input[name=date_min]").val());$(u).find("input[name=date_to]").val()==""&&$(u).find("input[name=date_to]").val($(u).find("input[name=date_min]").val());var s=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/,a=y.match(s),v=p.match(s);$(u).find("div.field_date").datepicker("option","minDate",new Date(parseInt(a[3],10),parseInt(a[2],10)-1,parseInt(a[1],10)));$(u).find("div.field_date").datepicker("option","maxDate",new Date(parseInt(v[3],10),parseInt(v[2],10)-1,parseInt(v[1],10)));$(u).find("div.field_date").datepicker("option","beforeShowDay",function(n){var f=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/,t=$(".infoprenotazione").find("input[name=date_from]").val().match(f),i=$(".infoprenotazione").find("input[name=date_to]").val().match(f),r=t?new Date(parseInt(t[3],10),parseInt(t[2],10)-1,parseInt(t[1],10)):null,u=i?new Date(parseInt(i[3],10),parseInt(i[2],10)-1,parseInt(i[1],10)):null;return[!0,r&&(n.getTime()==r.getTime()||u&&n>=r&&n<=u)?n.getTime()==r.getTime()||n.getTime()==u.getTime()?"selected":"interval":""]});$(u).find("div.field_date").datepicker("option","onSelect",function(n){var r=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/,u=n.match(r),t=$(".infoprenotazione").find("input[name=date_from]").val().match(r),i=$(".infoprenotazione").find("input[name=date_to]").val().match(r),f=t?new Date(parseInt(t[3],10),parseInt(t[2],10)-1,parseInt(t[1],10)):null,e=i?new Date(parseInt(i[3],10),parseInt(i[2],10)-1,parseInt(i[1],10)):null,o=new Date(parseInt(u[3],10),parseInt(u[2],10)-1,parseInt(u[1],10));!f||e?($(".infoprenotazione").find("input[name=date_from]").val(n),$(".infoprenotazione").find("input[name=date_to]").val(""),$(this).datepicker()):o<f?($(".infoprenotazione").find("input[name=date_to]").val($(".infoprenotazione").find("input[name=date_from]").val()),$(".infoprenotazione").find("input[name=date_from]").val(n),$(this).datepicker()):($(".infoprenotazione").find("input[name=date_to]").val(n),$(this).datepicker())});$(u).find("input[name=date_from]").val()!=""&&(s=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/,c=$(u).find("input[name=date_from]").val().match(s),$(u).find("div.field_date").datepicker("setDate",new Date(parseInt(c[3],10),parseInt(c[2],10)-1,parseInt(c[1],10))));break;case"menu-center":var f=$(this).data("item-index"),e=$(this).parents("ul.nav-pills").first(),n=$(e).data("identifier"),t=$(e).data("class"),r=$("#"+t+"Comp-"+n+"-accordion");for(i=0;i<6;i++)i>f?($(e).find(".menu-item-"+i+" a").addClass("disabled"),$(e).find(".menu-item-"+i+" a").removeClass("active"),$(r).find(".infoprenotazione").find(".panel-"+i).hide()):i<f?($(e).find(".menu-item-"+i+" a").removeClass("disabled"),$(e).find(".menu-item-"+i+" a").removeClass("active"),$(r).find(".infoprenotazione").find(".panel-"+i).hide()):i==f&&($(e).find(".menu-item-"+i+" a").removeClass("disabled"),$(e).find(".menu-item-"+i+" a").addClass("active"),$(r).find(".infoprenotazione").find(".panel-"+i).show());f==3&&h.menuCheckCenter(t,n);break;case"go-step":var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion"),f=$(this).data("index"),l=!1;$(this).data("step")=="centers"?(h.saveInfoPrenotazioneResource($(this).data("step"),t,n),l=!0):$(this).data("step")=="date"?(h.saveInfoPrenotazioneResource($(this).data("step"),t,n),l=!0):$(this).data("step")=="customer"?h.updateInfoUser(t,n,f):$(this).data("step")=="payment"&&(h.showReservationResource(t,n),l=!0);l&&$(".card-header li[data-item-index="+(parseInt(f,10)+1)+"]").find("a").hasClass("disabled")&&($(".card-header li[data-item-index="+(parseInt(f,10)+1)+"]").find("a").removeClass("disabled"),$(".card-header li[data-item-index="+(parseInt(f,10)+1)+"]").find("a").click());$("html,body").animate({scrollTop:$(r).offset().top},"slow");break;case"select-resource":$(this).addClass("resourceCellSelected");var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion"),o=$(r).find(".resource-variantion");$(o).find("input[name=resource_code]").val($(this).data("resource"));$(o).find("input[name=article_code]").val($(this).data("article"));$(o).find("input[name=structure_code]").val($(this).data("structure"));h.getResourceVariation(t,n,o);break;case"close-resource":var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion");h.saveInfoPrenotazioneResource($(this).data("step"),t,n);$(r).find("[data-resource='"+$(r).find("input[name=resource_code]").val()+"']").removeClass("resourceCellSelected");$(r).find("[data-resource='"+$(r).find("input[name=resource_code]").val()+"']").data("structure",null);break;case"confirm-resource":var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion"),o=$(r).find(".resource-variantion");$(r).find("[data-resource='"+$(r).find("input[name=resource_code]").val()+"']").data("structure",$(o).find("input[name=structure_code]").val());h.saveInfoPrenotazioneResource($(this).data("step"),t,n);$(o).modal("hide");h.getPaymentModes($(this).data("index"),t,n);$("html,body").animate({scrollTop:$(r).offset().top},"slow");break;case"add-resource":var n=$(this).data("identifier"),t=$(this).data("class"),r=$("#"+t+"Comp-"+n+"-accordion"),o=$(r).find(".resource-variantion");$(r).find("[data-resource='"+$(r).find("input[name=resource_code]").val()+"']").data("structure",$(o).find("input[name=structure_code]").val());h.saveInfoPrenotazioneResource($(this).data("step"),t,n);$(o).modal("hide");break;case"confirm-reservation":h.confirmReservationResource($(this).data("reservationid"),$(this).data("condition"),$(this).data("class"))}},k.registerHandlers=function(){$(document).on("click",'.ecReservationComp [data-action="applyvoucher"], .ecReservationCustomComp [data-action="applyvoucher"]',k.handleAction);$(document).on("click",'.ecReservationComp [data-action="validppcheckoutexpress"], .ecReservationComp [data-action="gotostepcheckout"], .ecReservationComp [data-action="confirmReservation"], .ecReservationCustomComp [data-action="validppcheckoutexpress"], .ecReservationCustomComp [data-action="gotostepcheckout"], .ecReservationCustomComp [data-action="confirmReservation"] ',k.handleAction);$(document).on("change",'.ecReservationComp [data-action="loadPlanning"], .ecReservationCustomComp [data-action="loadPlanning"]',k.handleAction);$(document).on("change",".ecReservationComp input[type=radio][name=billing], .ecReservationCustomComp input[type=radio][name=billing], .ecReservationResourceCustomComp input[type=radio][name=billing]",function(){$(".billingcard").hide("slow");$("#billingcard_"+$(this).val()).show("slow");$(".divPaymentBraintree").hide("slow");$("#divPaymentBraintree_"+$(this).val()).show("slow")});$(document).on("click",'.ecReservationComp [data-action="toggleDetails"], .ecReservationCustomComp [data-action="toggleDetails"], .ecReservationResourceCustomComp [data-action="toggleDetails"]',t.toggleDetails);$(document).on("click",'.ecReservationMenuComp [data-action="validppcheckoutexpress"], .ecReservationMenuComp [data-action="gotostepcheckout"], .ecReservationMenuComp [data-action="confirmReservationMenu"], .ecReservationMenuCustomComp [data-action="validppcheckoutexpress"], .ecReservationMenuCustomComp [data-action="gotostepcheckout"], .ecReservationMenuCustomComp [data-action="confirmReservationMenu"]',k.handleAction);$(document).on("change",".ecReservationMenuComp [data-action], .ecReservationMenuCustomComp [data-action]",k.handleAction);$(document).on("change",".ecReservationResourceCustomComp [data-action]",k.handleActionCenter);$(document).on("click",".ecReservationResourceCustomComp [data-action]",k.handleActionCenter)},k.init=function(){$('.ecReservationComp-accordion[data-action="checkout-accordion"], .ecReservationCustomComp-accordion[data-action="checkout-accordion"]').each(function(){_isResponsive?($(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")||$(t).hide()}),k.goToStep($(this),0)):$(this).accordion({event:!1,heightStyle:"content",autoHeight:!1});Site.horeca.loadPlanning($(this).data("class"));$(this).data("has-webtracking")&&Site.PWT.loadStepCheckoutReservation(1,0);$(this).show()});$('.ecReservationMenuComp-accordion[data-action="checkout-accordion"], .ecReservationMenuCustomComp-accordion[data-action="checkout-accordion"]').each(function(){$(this).find(".inputqty").each(function(){$(this).limitkeypress({numberRexp:0})});_isResponsive?($(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")||$(t).hide()}),k.goToStep($(this),0)):$(this).accordion({event:!1,heightStyle:"content",autoHeight:!1});Site.horeca.menuInfo($(this).data("class"));$(this).data("has-webtracking")&&Site.PWT.loadStepCheckoutReservation(1,0);$(this).show()});$('.ecReservationResourceComp-accordion[data-action="booking-accordion"], .ecReservationResourceCustomComp-accordion[data-action="booking-accordion"]').each(function(){$(this).find(".card").children().each(function(n,t){$(t).hasClass("card-header")||$(t).hide()});$(this).find(".nav-item").children().each(function(n,t){$(t).hasClass("nav-link")&&$(t).addClass("disabled")});Site.horeca.centerInfo($(this).data("class"),$(this).data("identifier"));$(this).data("has-webtracking")&&Site.PWT.loadStepCheckoutReservation(1,0)});$('.ecReservationComp-accordion[data-action="checkout-detail"], .ecReservationCustomComp-accordion[data-action="checkout-detail"]').each(function(){$(this).data("has-webtracking")&&Site.PWT.loadStepCheckoutReservation($(this).data("stepgaconfirm"),3)});$('.ecReservationComp-accordion[data-action="loadTransactionReservation"], .ecReservationCustomComp-accordion[data-action="loadTransactionReservation"]').each(function(){$(this).data("has-webtracking")&&Site.PWT.loadTransactionReservation($(this).data("analytics-ecommerce"),$(this).data("analytics-orderid"))})},k.useVoucher=function(n,i){var r=t.getParamsId($("."+i+"Comp").attr("id")).id,u;$("#"+i+"Comp-"+r+"-errorvoucher").hide();u=$("#"+i+"Comp-"+r+"-voucher").val();u!=null&&$.ajax({type:"POST",url:"/Async/Reservation/VerifyVoucher",data:{_voucher:u,_trattamento:$("#treatmentId").val()},dataType:"json",async:!1,error:t.onAsyncError,success:function(t){t.isValido?$(n).find(".voucher-checkicon").fadeIn("slow").delay(2e3).fadeOut("slow"):$("#"+i+"Comp-"+r+"-errorvoucher").show();t.totale==0?$("#"+i+"Comp-billing-container").hide():$("#"+i+"Comp-billing-container").show()}})},ht=function(){},ht.create=function(n){n!=0&&$.ajax({type:"POST",url:"/Async/Rma/ShowRma",data:{_id:n},dataType:"json",error:t.onAsyncError,success:function(n){n.returnedId!=null?window.location.href="/store/return/progress?id="+n.returnedId:n.returnedError&&$.jGrowl(n.returnedError)}})},ht.confirm=function(n,i,r,u){if($("#"+u+"Comp-errornocheckitems").hide(),$("#"+u+"Comp-errorcondition").hide(),!i||$("#"+u+"Comp-checkcondition").is(":checked")){var o=t.getParamsId($("."+u+"Comp").attr("id")).id,f={_idReso:n,_nota:$("."+u+"Comp-rmaDetail #rmaGlobalNote").val(),_extApp:$("."+u+"Comp-rmaDetail #rmaExtApp").length>0?$("."+u+"Comp-rmaDetail #rmaExtApp option:selected").val():"",_componentId:o},e=0;$("."+u+"Comp-rmaDetail .checkitem").each(function(){var n,i,u;if($(this).is(":checked")){n=t.getParamsRow($(this).attr("id")).id;switch(r){case tipologiaRmaMain.rma:f["rmaQty-"+n]=$("#rmaQty-"+n).val();f["rmaNote-"+n]=$("#rmaNote-"+n).val();break;case tipologiaRmaMain.rmacustom:i=$("[name=quantita-"+n+"]:visible");u=$("[name=nota-"+n+"]:visible");i.length>0&&(f["rmaQty-"+n]=i.val(),i.attr("placeholdervalue")!=null&&i.attr("placeholdervalue")==f["rmaQty-"+n]&&(f["rmaQty-"+n]=""),f["rmaNote-"+n]=u.val(),u.attr("placeholdervalue")!=null&&u.attr("placeholdervalue")==f["rmaNote-"+n]&&(f["rmaNote-"+n]=""))}e++}});e==0?$("#"+u+"Comp-errornocheckitems").fadeIn("slow"):$("."+u+"Comp-error:visible").length==0?$.ajax({type:"POST",url:"/Async/Rma/ConfirmRma",data:f,dataType:"json",error:t.onAsyncError,success:function(n){n!=null&&(window.location.href=n)}}):t.scrollTo($($("."+u+"Comp-error:visible")[0]).offset().top)}else $("#"+u+"Comp-errorcondition").fadeIn("slow")},ht.item=function(n){if(_isResponsive){var t=$(n).parents(".row").first();$(n).is(":checked")?(t.find(".fieldtextlabel").each(function(){$(this).hide()}),t.find(".fieldtextinput").each(function(){$(this).show()})):(t.find(".fieldtextinput").each(function(){$(this).hide()}),t.find(".fieldtextlabel").each(function(){$(this).show()}))}$(n).is(":checked")?($($(n).parent().parent()).find(".fieldtextlabel").each(function(){$(this).hide()}),$($(n).parent().parent()).find(".fieldtextinput").each(function(){$(this).show()})):($($(n).parent().parent()).find(".fieldtextinput").each(function(){$(this).hide()}),$($(n).parent().parent()).find(".fieldtextlabel").each(function(){$(this).show()}))},ht.handleAction=function(){switch($(this).data("action")){case"confirm":ht.confirm($(this).data("rmaid"),$(this).data("textcondition"),$(this).data("tipologia"),$(this).data("class"));break;case"rmaItem":ht.item($(this))}},ht.registerHandlers=function(){$(document).on("click",".ecRmaComp [data-action], .ecRmaCustomComp [data-action]",ht.handleAction);$(document).on("click",'.ecRmaCustomComp [data-action="editAttachment"], .ecRmaCustomComp [data-action="removeAttachment"], .ecRmaCustomComp [data-action="manageAttachment"], .ecRmaCustomComp [data-action="saveAttachment"]',r.handleAction);$(document).on("change",'.ecRmaCustomComp [data-action="updateAttachment"]',r.handleAction)},ht.init=function(){$(".ecRmaComp .inputqty, .ecRmaCustomComp .inputqty").each(function(){$(this).limitkeypress({numberRexp:$(this).data("numberrexp"),change:!0});$(this).on("change",function(){var n=parseFloat($(this).val().replace(",","."));n<1&&$(this).val(1);n>$(this).data("quantity")&&$(this).val($(this).data("quantity"))})})},si=function(){},si.init=function(){$(".rssComp-animation").each(function(){$jScroller.add("#"+$(this).attr("id"),"#"+$(this).find(".rss-animation").attr("id"),$(this).data("animation"),1,!0);$jScroller.start()})},pt=function(){},pt.filter=function(n,i,r){(r==null||r==""||r=="/")&&(r=location.pathname);i!=null&&i!=""?$.ajax({type:"POST",url:"/ASync/SiteFilter/Add",data:{_pageId:t.getParamsId($("body").attr("id")).id,_filterId:n,_filters:i,_location:r},dataType:"json",error:t.onAsyncError,success:function(){r!=undefined&&r!=null&&window.location.pathname!=r?window.location=r:(o.filter(e.collectClassesComponent([tipologiaRefresh.sitesearch],null)),e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.sitesearch],null),null,!1,null,null))}}):window.location=r},pt.copyFilters=function(n){var i=$(n).closest(".searchandfilterComp-form"),r,u;i.length!=0&&(r=$(i).find(":not([name=form_sent]):not([name=__RequestVerificationToken])").serialize(),u={pid:t.getParamsId($("body").attr("id")).id,fid:$(i).data("identifier"),fcv:r,typ:"s"},gt.copy($.param(u),n))},pt.handleAction=function(){switch($(this).data("action")){case"search":return $(this).find(":text").each(function(){$(this).attr("defaultvalue")!=""&&$(this).attr("defaultvalue")==$(this).val()&&$(this).val("")}),$(this).data("has-cmssearch")?(Site.cms.filter($(this).data("identifier"),$("#cmsSearchandfilter_"+$(this).data("identifier")).children("form").serialize(),$(this).attr("action")),!1):($(this).data("has-gasearch")&&Site.PWT.sendTermsSearch($(this),null,$(this).data("has-cmssearch")?2:0,$(this).data("userid")!=null?$(this).data("userid"):null),pt.filter($(this).data("identifier"),$("#searchandfilter_"+$(this).data("identifier")).children("form").serialize(),$(this).attr("action")),!1);case"searchandfilter":return Site.catalog.filter($(this).parent(),$(this).data("filter-action"),$(this).data("cascaded"),!0),!1;case"copyFilters":Site.search.copyFilters(this);break;case"copyCmsFilters":Site.cms.copyFilters(this);break;case"copyCatalogFilters":Site.catalog.copyFilters(this)}},pt.registerHandlers=function(){$(document).on("submit",".searchandfilterComp [data-action], .ecCatalogsearchandfilterComp [data-action]",pt.handleAction);$(document).on("click",'.searchandfilterComp [data-action="copyFilters"], .cmsSearchandfilterComp [data-action="copyCmsFilters"], .ecCatalogsearchandfilterComp [data-action="copyCatalogFilters"]',pt.handleAction)},wt=function(){},wt.timeout=null,wt.init=function(n){n&&(t.addLoadingPanel(".sliderCompLoading"),$(".sliderCompLoading").length>0&&(wt.timeout=setTimeout(function(){Site.slider.timeout=null;Site.slider.init(!1)},1e3)));n&&!_isResponsive&&($('.sliderComp [data-action="sliderMain"]').each(function(){$(this).data("has-segments")?$(this).wsSlider({loop:$(this).data("loop"),pauseTime:$(this).data("pausetime"),transitionTime:$(this).data("transition-time"),transitionEasing:$(this).data("transition-easing"),transitionFx:$(this).data("transition-fx"),jumpTime:$(this).data("jumptime"),segments:$(this).data("segments"),direction:$(this).data("direction"),centered:$(this).data("centered"),loopThrough:$(this).data("loopthrough"),loopThroughAll:$(this).data("loopthroughall"),pauseOnHover:$(this).data("pauseonhover"),enableTouchGestures:$(this).data("enable-touchgestures"),enableSceneAnimations:$(this).data("enable-sceneanimations"),resetOnResize:$(this).data("resetonresize")}):$(this).wsSlider({loop:$(this).data("loop"),pauseTime:$(this).data("pausetime"),transitionTime:$(this).data("transition-time"),transitionEasing:$(this).data("transition-easing"),transitionFx:$(this).data("transition-fx"),jumpTime:$(this).data("jumptime"),direction:$(this).data("direction"),centered:$(this).data("centered"),loopThrough:$(this).data("loopthrough"),loopThroughAll:$(this).data("loopthroughall"),pauseOnHover:$(this).data("pauseonhover"),enableTouchGestures:$(this).data("enable-touchgestures"),enableSceneAnimations:$(this).data("enable-sceneanimations"),resetOnResize:$(this).data("resetonresize")});$(this).data("looponce")&&$(this).runLoopOnce()}),$('.slidercontrolComp [data-action="sliderControl"]').each(function(){$(this).data("has-hover")?$(this).parent().wsSliderControl({imgOn:$(this).data("img-on"),imgOff:$(this).data("img-off"),boundToSlider:$(this).data("boundtoslider"),controlAction:$(this).data("control-action"),controlGoTo:$(this).data("control-goto")}):$(this).parent().wsSliderControl({imgOff:$(this).data("img-off"),boundToSlider:$(this).data("boundtoslider"),controlAction:$(this).data("control-action"),controlGoTo:$(this).data("control-goto")})}));_isResponsive&&!n&&$('.sliderComp [data-action="sliderMain"]').each(function(){var i,n,r;if($(this).hasClass("sliderCompLoaded")){i=$(this).slick("getSlick");i.setHeight();t.removeLoadingPanel($(this).closest(".sliderComp"));return}$(this).addClass("sliderCompLoaded");$(this).closest(".sliderComp").removeClass("sliderCompLoading");$(this).closest(".sliderComp").removeClass("sliderCompLoadingPlaceholder");t.removeLoadingPanel($(this).closest(".sliderComp"));n={};r=$(this).data("buttons");n.cssEase=$(this).data("transition-fx");n.infinite=$(this).data("loop");n.pauseOnFocus=$(this).data("pauseonhover");n.pauseOnHover=$(this).data("pauseonhover");n.pauseOnDotsHover=$(this).data("pauseonhover");n.centerMode=$(this).data("centered");n.focusOnSelect=!0;n.dots=$(this).data("dots");n.speed=$(this).data("transition-time");n.slidesToShow=$(this).data("itemstoshow");n.slidesToScroll=$(this).data("itemstoscroll");n.slidesToShow>1?n.fade=!1:$(this).data("fade")=="fade"&&(n.fade=!0);$(this).data("direction")=="V"&&(n.vertical=!0);$(this).data("autoplay")&&(n.autoplay=!0,n.autoplaySpeed=$(this).data("pausetime"));$(this).data("adaptiveheight")=="1"&&(n.adaptiveHeight=!0);$(this).data("rows")!="1"&&(n.rows=parseInt($(this).data("rows"),10),n.slidesPerRow=parseInt($(this).data("itemsperrows"),10));$(this).data("thumbnail")!=""&&(n.asNavFor=$(this).data("thumbnail"));n.nextArrow=$(this).parent().find(".slick-next");n.prevArrow=$(this).parent().find(".slick-prev");n.accessibility=!1;n.responsive=[{breakpoint:972,settings:{slidesToShow:n.slidesToShow>2?2:n.slidesToShow,slidesToScroll:n.slidesToScroll>2?2:n.slidesToScroll}},{breakpoint:768,settings:{slidesToShow:1,slidesToScroll:1}}];$(this).slick(n);r||$(this).closest(".sliderComp").find(".slick-next, .slick-prev").remove();$($(this).slick("getSlick").$slides[0]).find(".animated-component-slider").each(function(n,t){var i=$(t),r,u;i.removeClass("animated-component-slider").addClass("animated-component");i.hide();r=i.attr("data-animation");i.hasClass("animated")||(i.data("oldStyles",i.attr("style")),i.attr("style",i.attr("style")+" -webkit-backface-visibility: hidden; -webkit-animation-delay: "+i.attr("data-animation-delay")+"s; -webkit-animation-duration: "+i.attr("data-animation-duration")+"s; -webkit-animation-timing-function: ease; -webkit-animation-fill-mode: both; -moz-animation-delay: "+i.attr("data-animation-delay")+"s; -moz-animation-duration: "+i.attr("data-animation-duration")+"s; -moz-animation-timing-function: ease; -moz-animation-fill-mode: both; -ms-animation-delay: "+i.attr("data-animation-delay")+"s; -ms-animation-duration: "+i.attr("data-animation-duration")+"s; -ms-animation-timing-function: ease; -ms-animation-fill-mode: both; -o-animation-delay: "+i.attr("data-animation-delay")+"s; -o-animation-duration: "+i.attr("data-animation-duration")+"s; -o-animation-timing-function: ease; -o-animation-fill-mode: both; animation-delay: "+i.attr("data-animation-delay")+"s; animation-duration: "+i.attr("data-animation-duration")+"s; animation-timing-function: ease; animation-fill-mode: both;"));u=i.attr("data-animation-delay")*1e3+i.attr("data-animation-duration")*1e3;i.show().addClass(r+" animated").removeClass(r,u+10)});$(this).on("beforeChange",function(n,t,i,r){$(t.$slides[r]).find(".animated-component-slider").each(function(n,t){var i=$(t),r,u;i.removeClass("animated-component-slider").addClass("animated-component");i.hide();r=i.attr("data-animation");i.hasClass("animated")||(i.data("oldStyles",i.attr("style")),i.attr("style",i.attr("style")+" -webkit-backface-visibility: hidden; -webkit-animation-delay: "+i.attr("data-animation-delay")+"s; -webkit-animation-duration: "+i.attr("data-animation-duration")+"s; -webkit-animation-timing-function: ease; -webkit-animation-fill-mode: both; -moz-animation-delay: "+i.attr("data-animation-delay")+"s; -moz-animation-duration: "+i.attr("data-animation-duration")+"s; -moz-animation-timing-function: ease; -moz-animation-fill-mode: both; -ms-animation-delay: "+i.attr("data-animation-delay")+"s; -ms-animation-duration: "+i.attr("data-animation-duration")+"s; -ms-animation-timing-function: ease; -ms-animation-fill-mode: both; -o-animation-delay: "+i.attr("data-animation-delay")+"s; -o-animation-duration: "+i.attr("data-animation-duration")+"s; -o-animation-timing-function: ease; -o-animation-fill-mode: both; animation-delay: "+i.attr("data-animation-delay")+"s; animation-duration: "+i.attr("data-animation-duration")+"s; animation-timing-function: ease; animation-fill-mode: both;"));u=i.attr("data-animation-delay")*1e3+i.attr("data-animation-duration")*1e3;i.show().addClass(r+" animated").removeClass(r,u+10)})});$(this).data("thumbnail")!=""&&$($(this).data("thumbnail")).slick({slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,centerMode:!0,accessibility:!1,asNavFor:"#"+$(this).attr("id")});$('.slidercontrolComp [data-action="sliderControl"]').each(function(){$(this).data("has-hover")?$(this).parent().wsSliderControl({imgOn:$(this).data("img-on"),imgOff:$(this).data("img-off"),boundToSlider:$(this).data("boundtoslider"),controlAction:$(this).data("control-action"),controlGoTo:$(this).data("control-goto")}):$(this).parent().wsSliderControl({imgOff:$(this).data("img-off"),boundToSlider:$(this).data("boundtoslider"),controlAction:$(this).data("control-action"),controlGoTo:$(this).data("control-goto")})})})},tt=function(){},tt.init=function(){_isResponsive||$(".tabsComp .tabsComp-tabs").tabs();$(document).off("click",".tab-switch .nav-link",tt.switch);$(document).on("click",".tab-switch .nav-link",tt.switch);$(document).off("change",".tabsComp .tabsComp-tabs .tabsComp-tabs-select",tt.selectChange);$(document).on("change",".tabsComp .tabsComp-tabs .tabsComp-tabs-select",tt.selectChange);$(document).off("change",".ecOrdersComp .tabsComp-tabs-select",tt.selectChangeOrder);$(document).on("change",".ecOrdersComp .tabsComp-tabs-select",tt.selectChangeOrder);$(document).off("change",".ecFieldsetattributeComp .tabsComp-tabs-select",tt.selectChangeSetAttribute);$(document).on("change",".ecFieldsetattributeComp .tabsComp-tabs-select",tt.selectChangeSetAttribute);$(document).off("shown.bs.tab",".tabsComp .tabsComp-tabs",tt.checkActive);$(document).on("shown.bs.tab",".tabsComp .tabsComp-tabs",tt.checkActive)},tt.switch=function(){o.hashElements=history.pushState?o.getQueryStringParams(location.search):o.getHashParams(location.hash);var n=t.getParamsId($("body").attr("id")).id,i=t.getParamsId($(this).parents(".tabsComp").attr("id")).id,r={};r["p"+n]=o.hashElements["p"+n]!=null?o.hashElements["p"+n]:1;r["o"+n]=o.hashElements["o"+n]!=null?o.hashElements["o"+n]:0;r["p"+i]=o.hashElements["p"+i]!=null?o.hashElements["p"+i]:1;r["o"+i]=o.hashElements["o"+i]!=null?o.hashElements["o"+i]:0;r.tabSelected=$(this).data("entryid");Site.updaters.refreshComponent($(this).parents(".tabsComp").first(),r,null,null)},tt.selectChange=function(){$(this).closest(".tabsComp").find(".tabsComp-tabs ul li a.nav-link[href = '"+$(this).val()+"']").click()},tt.selectChangeOrder=function(){$(this).closest(".ecOrdersComp").find($(this).val()).click()},tt.selectChangeSetAttribute=function(){$(this).closest(".ecFieldsetattributeComp").find($(this).val()).click()},tt.checkActive=function(n){$($(n.relatedTarget).attr("href")).removeClass("active");$(this).find(".slick-slider").each(function(){$(this).get(0).slick.setPosition()})},y=function(){},y.rbNewsletter=function(n,t){if(n!=undefined){var i=n.replace("rbnewsletter_","");$("input[name="+n+"]:checked").val()=="si"?$("."+t+" ."+i).show():$("."+t+" ."+i).hide()}},y.formatCAP=function(n,i,r,u){$.ajax({type:"POST",url:"/Form/GetFormatCAP",data:{_nation:n},dataType:"json",error:t.onAsyncError,success:function(n){i&&parseInt($("."+r+" [name=cap"+u+"]").attr("maxlength"),10)>parseInt(n.length,10)&&$("."+r+" [name=cap"+u+"]").val().length>parseInt(n.length,10)&&$("."+r+" [name=cap"+u+"]").val("");$("."+r+" [name=cap"+u+"]").attr("maxlength",n.length);$("."+r+" [name=cap"+u+"]").attr("pattern",n.regex);$("."+r+" [name=cap"+u+"]").attr("title",n.example)}})},y.getDistrict=function(n,i,r,u){$.ajax({type:"POST",url:"/Form/GetDistrict",data:{_nation:n,_selected:!0},dataType:"json",error:t.onAsyncError,success:function(n){var t,f;for($("."+i+" [name=district"+r+"]").find("option:gt(0)").remove(),t=0;t<n.length;t++)f=$("<option><\/option>").attr("value",n[t].entry_text).text(n[t].entry_text),n[t].entry_selected&&f.attr("selected","selected"),$("."+i+" [name=district"+r+"]").append(f);u!=null&&u.address!=""&&($("."+i+" [name=district"+r+"]").val(u.province),$("."+i+" [name=address"+r+"]").change())}})},y.recoveryPassword=function(n){$("#recoverypasswordsuccess_"+n).hide();$("#recoverypassworderror_"+n).hide();var i=$("#recoverypasswordtext_"+n).val();i!=null&&i!=""?$.ajax({type:"POST",url:"/Async/RecoveryPassword/RecoveryPassword",data:{_email:i},dataType:"json",error:t.onAsyncError,success:function(t){t?($("#recoverypasswordsuccess_"+n).show(),$("#recoverypassworderror_"+n).hide(),$("#recoverypasswordtext_"+n).val("")):($("#recoverypassworderror_"+n).show(),$("#recoverypasswordsuccess_"+n).hide())}}):($("#recoverypassworderror_"+n).show(),$("#recoverypasswordsuccess_"+n).hide())},y.deleteProfile=function(n){t.showConfirm(null,Site.user.confirmDeleteProfile,$(n).attr("id"))},y.confirmDeleteProfile=function(n){$.ajax({type:"POST",url:"/Async/Profile/DeleteProfile",dataType:"json",data:{__RequestVerificationToken:$("#antiforgerytoken [name=__RequestVerificationToken]").val()},error:t.onAsyncError,success:function(i){t.closeJgrowl();i&&($("#"+n).submit(),$(".useraddressbookComp, .userloginComp, .userbarComp").each(function(n,t){Site.updaters.refreshComponent($(t),null,null,null)}))}})},y.handleAction=function(n){switch($(this).data("action")){case"recoverycredential":n.handled!==!0&&(Site.user.recoveryPassword($(this).data("identifier")),n.handled=!0);break;case"deleteprofile":n.preventDefault();var t=$(this).closest("#userprofile_"+$(this).data("identifier")+"-form");y.deleteProfile(t)}},y.logout=function(n){var t=$(n).parent().parent(),r=$.cookie(".ASPXAUTH"),i;if(r!=null){$(n).attr("disabled","disabled");i=_isResponsive?$(t).closest(".userbarComp").first().find("#dialog_remember").clone().html():$(t).next().clone().html();$.jGrowl(i,{sticky:!0,theme:"jgrowlblack"});$(document).on("click","#logout_logoutforce",function(){$("div.jGrowl-notification").trigger("jGrowl.close");Site.forms.submit($(t).attr("id"),$(t).data("class")+"_"+$(t).data("identifier"),$(t).data("identifier"),$(t).data("pageid"),null)});$(document).on("click","#logout_logoutdelete",function(){$("div.jGrowl-notification").trigger("jGrowl.close")});$(n).removeAttr("disabled")}else Site.forms.submit($(t).attr("id"),$(t).data("class")+"_"+$(t).data("identifier"),$(t).data("identifier"),$(t).data("pageid"),null)},y.registerHandlers=function(){$(document).on("click",'.recoverypasswordComp [data-action="recoverycredential"]',y.handleAction);$(document).on("click",".userbarComp .userbarComp-logout input[type=button]",function(){t.LogoutCartCheck(y.logout,this)});$(document).on("submit",".userregistrationComp-form, .userprofileComp-form, .userloginComp-form, .changepasswordComp-form",function(n){var i=$(this).hasClass("userloginComp-form"),t;$(this).data("submittype")==0?Site.forms.clearPlaceholder($(this).attr("id")):(n.preventDefault(),Site.forms.clearPlaceholder($(this).attr("id")),t=$(this),Site.forms.submit($(this).attr("id"),$(this).data("class")+"_"+$(this).data("identifier"),$(this).data("identifier"),$(this).data("pageid"),i?function(){if(_isApp)try{window.PWBAppController&&window.PWBAppController.loginDone({a:$($(t).find("input[name=username]")).val(),b:$($(t).find("input:password")).val()})}catch(n){}}:null))});$(".typeaccount:checked").click();$("input[type='radio'][name='shipping']").length>0?(ii=!1,$("input[type='radio'][name='shipping']:checked").click()):$("#ecCheckoutCustomComp-dlstores").hide();$(document).on("click",'.userprofileComp-form [data-action="deleteprofile"]',y.handleAction);$(document).on("click","[name=accounttype], [name=choice_electrinvoice], [name=choice_publiccompany], [name=choice_physicalperson]",function(){var t=$(this).attr("name"),n;switch(t){case"accounttype":n=$(this).closest("form").attr("id");l.checkAccoutType($(this).val(),n);break;case"choice_physicalperson":n=$(this).closest("form").attr("id");l.checkPhysicalPerson($(this).val(),n)}l.CheckCondition(this)});$(document).on("change",".userprofileComp [name=state]",function(){$(this).val()!=""&&(y.formatCAP($(this).val(),!0,"userprofileComp",""),y.getDistrict($(this).val(),"userprofileComp","",null))});$(document).on("change",".userregistrationComp [name=state], .userregistrationComp [name=state2], .userregistrationComp [name=state3], .userregistrationComp [name=state4]",function(){if($(this).val()!=""){var t=$(this).closest(".userregistrationComp").attr("id"),i=$(this).attr("name").replace("state",""),r=new Array(i),u=new Array(i);if(i=="")for(n=2;n<=4;n++)$(".userregistrationComp[id="+t+"] [name=state"+n+"]").length==0&&($(".userregistrationComp[id="+t+"] [name=cap"+n+"]").length>0&&r.push(n),$(".userregistrationComp[id="+t+"] [name=district"+n+"]").length>0&&u.push(n));for(n=0;n<r.length;n++)y.formatCAP($(this).val(),!0,"userregistrationComp[id="+t+"]",r[n]);for(n=0;n<u.length;n++)y.getDistrict($(this).val(),"userregistrationComp[id="+t+"]",u[n],null)}});$(document).on("change",".userregistrationComp .rbnewsletter input[type=radio]",function(){y.rbNewsletter($(this).attr("name"),"userregistrationComp")});$(document).on("change",".userprofileComp .rbnewsletter input[type=radio]",function(){y.rbNewsletter($(this).attr("name"),"userprofileComp")});$(document).on("click",".userregistrationComp [name=create_account]",function(){$(this).is(":checked")?($(this).parents(".userregistrationComp").find("[name=password], [name=password_confirm]").each(function(n,t){$($(t).parents(".passwordfieldComp")).show()}),$(this).parents("form").data("sameusernamemail")==undefined||$(this).parents("form").data("sameusernamemail")||$(this).parents(".userregistrationComp").find("[name=username]").each(function(n,t){$($(t).parents(".textfieldComp")).show()})):($(this).parents(".userregistrationComp").find("[name=password], [name=password_confirm]").each(function(n,t){$($(t).parents(".passwordfieldComp")).hide()}),$(this).parents("form").data("sameusernamemail")==undefined||$(this).parents("form").data("sameusernamemail")||$(this).parents(".userregistrationComp").find("[name=username]").each(function(n,t){$($(t).parents(".textfieldComp")).hide()}))});$(document).on("click",".userregistrationComp [name=same_shipaddress], .userregistrationComp [name=choice_address]",function(){var i="",n=$(this);$(this).parents(".userregistrationComp").find("input[name^=address]").each(function(n,t){return i=$(t).attr("name").replace("address",""),i!=""?!1:void 0});$(this).is("[name=same_shipaddress]")&&$(this).is(":checked")||$(this).is("[name=choice_address]")&&$("input[name=choice_address]:checked").val()!="NA"?($(this).parents(".userregistrationComp").find("[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4], [name=bookAddressShipping]").each(function(n,t){$($(t).parents(".selectfieldComp")).hide();$($(t).find("option:selected")).prop("selected",!1);$($(t).find("option:first")).prop("selected",!0)}),$(this).parents(".userregistrationComp").find("[name=address2], [name=address3], [name = address4], [name = city2], [name = city3], [name = city4], [name = cap2], [name = cap3], [name = cap4], [name = phone_address2], [name = phone_address3], [name = phone_address4], [name = fax_address2], [name = fax_address3], [name = fax_address4], [name = mail_address2], [name = mail_address3], [name = mail_address4], [name = nominative_address2], [name = nominative_address3], [name = nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).hide();$(t).val("")}),$($(n).parents(".userregistrationComp").find("[name=bookAddressBilling]")).length>0?$($(n).parents(".userregistrationComp").find("[name=bookAddressBilling]")).change():$($(n).parents(".userregistrationComp").find("[name=address]")).change()):(i!=""&&$.ajax({type:"POST",url:"/Async/Checkout/GetUserInfoGeneric",data:{_address:null,_isPrimario:!1,_addressData:null},dataType:"json",error:t.onAsyncError,success:function(t){if(t[3].length>0){var r=t[3][parseInt(i)-2];$($(n).parents(".userregistrationComp").find("[name=address"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=address"+i+"]")).val(r.address);$($(n).parents(".userregistrationComp").find("[name=city"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=city"+i+"]")).val(r.city);$($(n).parents(".userregistrationComp").find("[name=cap"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=cap"+i+"]")).val(r.postalCode);$($(n).parents(".userregistrationComp").find("[name=state"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=state"+i+"]")).val(r.state);$($(n).parents(".userregistrationComp").find("[name=phone_address"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=phone_address"+i+"]")).val(r.phone_number);$($(n).parents(".userregistrationComp").find("[name=fax_address"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=fax_address"+i+"]")).val(r.fax_number);$($(n).parents(".userregistrationComp").find("[name=mail_address"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=mail_address"+i+"]")).val(r.fax_number);$($(n).parents(".userregistrationComp").find("[name=nominative_address"+i+"]")).length>0&&$($(n).parents(".userregistrationComp").find("[name=nominative_address"+i+"]")).val(r.contact);y.getDistrict(r.state,"userregistrationComp[id="+$(n).parents(".userregistrationComp").attr("id")+"]",i,r);$($(n).parents(".userregistrationComp").find("[name=bookAddressShipping]")).length>0&&($($(n).parents(".userregistrationComp").find("[name=bookAddressShipping]")).val(r.id),$($(n).parents(".userregistrationComp").find("[name=bookAddressShipping]")).change())}}}),$($(n).parents(".userregistrationComp").find("[name=bookAddressShipping]")).length>0?$($($(n).parents(".userregistrationComp").find("[name=bookAddressShipping]")).parents(".selectfieldComp")).show():($(this).parents(".userregistrationComp").find("[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4]").each(function(n,t){$($(t).parents(".selectfieldComp")).show()}),$(this).parents(".userregistrationComp").find("[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).show()})))})},y.init=function(){$(".userprofileComp [name=cap], .userprofileComp [name=cap2], .userprofileComp [name=cap3], .userprofileComp [name=cap4]").each(function(){var n=$(this).attr("name").replace("cap","");$(".userprofileComp [name=state"+n+"]").length>0&&$(".userprofileComp [name=state"+n+"]").val()!=""?y.formatCAP($(".userprofileComp [name=state"+n+"]").val(),!1,"userprofileComp",n):y.formatCAP("",!1,"userprofileComp","")});$(".userregistrationComp [name=cap], .userregistrationComp [name=cap2], .userregistrationComp [name=cap3], .userregistrationComp [name=cap4]").each(function(){var n=$(this).attr("name").replace("cap","");$(".userregistrationComp [name=state"+n+"]").length>0&&$(".userregistrationComp [name=state"+n+"]").val()!=""?y.formatCAP($(".userregistrationComp [name=state"+n+"]").val(),!1,"userregistrationComp",n):n!=""&&$(".userregistrationComp [name=state]").length>0&&$(".userregistrationComp [name=state]").val()!=""?y.formatCAP($(".userregistrationComp [name=state]").val(),!1,"userregistrationComp",n):y.formatCAP("",!1,"userregistrationComp",n)});$(".userregistrationComp [name=create_account]").each(function(){$(this).is(":checked")?($(this).parents(".userregistrationComp").find("[name=password], [name=password_confirm]").each(function(n,t){$($(t).parents(".passwordfieldComp")).show()}),$(this).parents("form").data("sameusernamemail")==undefined||$(this).parents("form").data("sameusernamemail")||$(this).parents(".userregistrationComp").find("[name=username]").each(function(n,t){$($(t).parents(".textfieldComp")).show()})):($(this).parents(".userregistrationComp").find("[name=password], [name=password_confirm]").each(function(n,t){$($(t).parents(".passwordfieldComp")).hide()}),$(this).parents("form").data("sameusernamemail")==undefined||$(this).parents("form").data("sameusernamemail")||$(this).parents(".userregistrationComp").find("[name=username]").each(function(){$(this).val("");$($(this).parents(".textfieldComp")).hide()}))});$(".userregistrationComp [name=same_shipaddress], .userregistrationComp [name=choice_address]").each(function(){($(this).is("[name=same_shipaddress]")&&$(this).is(":checked")||$(this).is("[name=choice_address]")&&$("input[name=choice_address]:checked").val()!="NA")&&($(this).parents(".userregistrationComp").find("[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4], [name=bookAddressShipping]").each(function(){$($(this).parents(".selectfieldComp")).hide()}),$(this).parents(".userregistrationComp").find("[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(){$($(this).parents(".textfieldComp")).hide()}))});$(".userregistrationComp [name=bookAddressShipping]").each(function(){var n,t;$("[name=same_shipaddress]").length>0&&$("[name=same_shipaddress]").is(":checked")||$("[name=choice_address]").length>0&&$("[name=choice_address]:checked").val()!="NA"||($(this).find("option:selected")!=undefined&&$(this).find("option:selected").val()!=""?(n=$(this).find("option:selected").val(),$(this).parents(".userregistrationComp").find("[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4]").each(function(n,t){$($(t).parents(".selectfieldComp")).hide()}),$(this).parents(".userregistrationComp").find("[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).hide()}),t=$(this).parents('[data-action="checkout-accordion"]'),$("#"+$(t).data("class")+"Comp-"+$(t).data("identifier")+"-address").find("option").remove().end().append($("<option><\/option>").attr("value",n).text(n).attr("selected","selected")).val(n)):$(this).find("option:selected")!=undefined&&$(this).find("option:selected").val()==""&&($(this).parents(".userregistrationComp").find("[name=state2], [name=state3], [name=state4], [name=district2], [name=district3], [name=district4]").each(function(n,t){$($(t).parents(".selectfieldComp")).show()}),$(this).parents(".userregistrationComp").find("[name=address2], [name=address3], [name=address4], [name=city2], [name=city3], [name=city4], [name=cap2], [name=cap3], [name=cap4], [name=phone_address2], [name=phone_address3], [name=phone_address4], [name=fax_address2], [name=fax_address3], [name=fax_address4], [name=mail_address2], [name=mail_address3], [name=mail_address4], [name=nominative_address2], [name=nominative_address3], [name=nominative_address4]").each(function(n,t){$($(t).parents(".textfieldComp")).show()})))});$(".userregistrationComp [name=bookAddressBilling]").each(function(){var n,t;$(this).find("option:selected")!=undefined&&$(this).find("option:selected").val()!=""?(n=$(this).find("option:selected").val(),$(this).parents(".userregistrationComp").find("[name=state], [name=district]").each(function(n,t){$($(t).parents(".selectfieldComp")).hide()}),$(this).parents(".userregistrationComp").find("[name=address], [name=city], [name=cap]").each(function(n,t){$($(t).parents(".textfieldComp")).hide()}),t=$(this).parents('[data-action="checkout-accordion"]'),($("input[name=choice_address]").length>0&&$("input[name=choice_address]:checked").val()=="SA"||$("input[name=choice_address]").length==0)&&$("#"+$(t).data("class")+"Comp-"+$(t).data("identifier")+"-address").find("option").remove().end().append($("<option><\/option>").attr("value",n).text(n).attr("selected","selected")).val(n)):$(this).find("option:selected")!=undefined&&$(this).find("option:selected").val()==""&&($(this).parents(".userregistrationComp").find("[name=state], [name=district]").each(function(n,t){$($(t).parents(".selectfieldComp")).show()}),$(this).parents(".userregistrationComp").find("[name=address], [name=city], [name=cap]").each(function(n,t){$($(t).parents(".textfieldComp")).show()}))});$(".userregistrationComp .rbnewsletter").each(function(){y.rbNewsletter($(this).find("input[type=radio]").attr("name"),"userregistrationComp")});$(".userprofileComp .rbnewsletter").each(function(){y.rbNewsletter($(this).find("input[type=radio]").attr("name"),"userprofileComp")});$(".userregistrationComp .searchcribis").each(function(){var n=$(this).closest(".userregistrationComp"),i=$(this).closest(".textfieldComp"),r=$(this);$(this).autocomplete({appendTo:"#"+i.attr("id")+" .containerCribis",search:function(n){r.hasClass("autocompleteActive")?r.removeClass("autocompleteActive"):n.preventDefault()},source:function(r,u){t.addLoadingPanel(n);$.ajax({type:"POST",url:"/Form/GetListaAziende",dataType:"json",data:{_vatOrTaxCode:r.term},success:function(r){t.removeLoadingPanel(n);(r==null||r.length==0)&&i.find(".errorcribis").show();u(r)},error:function(r,u,f){t.removeLoadingPanel(n);t.onAsyncError(r,u,f);i.find(".errorcribis").show()}})},minLength:11,select:function(t,i){i.item!=null&&(r.val(i.item.value),n.find("[name = company_name]").val(i.item.optgroup.name),n.find("[name = vat_number]").val(i.item.optgroup.vatCode),n.find("[name = fiscal_code]").val(i.item.optgroup.taxCode),n.find("[name = phone_number]").val(i.item.optgroup.telephoneNumber),n.find("[name = state]").val(i.item.optgroup.address.nazionePassweb),n.find("[name = district]").val(i.item.optgroup.address.nomeProvince),n.find("[name = city]").val(i.item.optgroup.address.town),n.find("[name = cap]").val(i.item.optgroup.address.zipCode),n.find("[name = address]").val(i.item.optgroup.address.fullAddress),n.find("[name = nominative_address2]").val(i.item.optgroup.name))}}).data("ui-autocomplete")._renderItem=function(n,t){return $('<li class="list-group-item" id="'+t.value+'">').append(t.label).appendTo(n)}});$(document).on("click",".userregistrationComp .pulsanteCribis",function(){$(this).closest(".textfieldComp").find(".errorcribis").hide();$(this).closest(".textfieldComp").find(".searchcribis").addClass("autocompleteActive");$(this).closest(".textfieldComp").find(".searchcribis").autocomplete("search")});$(document).on("keyup",".userregistrationComp .searchcribis",function(){this.value.length>=11?$(this).closest(".textfieldComp").find(".pulsanteCribis").removeAttr("disabled"):$(this).closest(".textfieldComp").find(".pulsanteCribis").attr("disabled","disabled")})},v=function(){},v.tryAddItem=function(n,t,i,r,f,e,o,s,h,c,l,v,y,p){var b,k,d,w;try{if(b=[],$("#"+r+"_menu_wishlist").length>0?$("#"+r+"_menu_wishlist:visible input[type=checkbox]:checked").each(function(){b.push($(this).val())}):b.push("0"),b.length>0)if(k=bt.closestToOffset($("#"+r+"_wishlist").offset(),$("#"+i+" .addtocartproduct_"+n)),k!=null&&k.length>0){if(d="",_isResponsive){var g=k.attr("id").replace("_","-"),nt=r.substring(0,r.indexOf("-"))+"Comp",tt=$("#"+r+"_wishlist").closest("."+nt).attr("id").replace("_","-");d=r.replace(tt,g)}else d=r;w=a.qtaArticle(d,f,$(k).hasClass("sizeminimal"),e,s,c,$(k).attr("data-animation"),!0);w.success&&u.addItem(n,w.quantity,w.size,w.structure,o,w.options,w.articles,h,r,tipologiaCart.wishlist,v,y,p,null,!1,null,b,null,null)}else f||e||l?t!=""&&(window.location.href=t):u.addItem(n,1,null,null,o,null,null,null,r,tipologiaCart.wishlist,v,y,p,null,!1,null,b,null,null)}catch(it){}},v.update=function(n,r,f,s,h){var l=[],c=[],a=r==tipologiaWishlistMain.wishlist?"Wishlist":"WishlistCustom",v=$("#wishlistDetailTable"+n).hasClass("current"),y=f!=null?[f]:$("#wishlistDetailTable"+n+" .ec"+a+"Comp-wishlistDetailTableRow");$(y).each(function(){var f=$(this).attr("id"),n=$(this).find(".wishlistQtyElement:visible"),e=!0,t,i;n.length>0&&(t={idrow:f,quantity:0,size:null,note:null,priority:null},$(n).hasClass("rowQty")?(t.quantity=$(n).val().replace(",","."),t.quantity.trim()==""&&(t.quantity="1")):(i=[],$(n).children("li").each(function(){n=u.getParamsSize($(this).attr("id"));$(this).find(".rowQtySize").length>0&&(i.push([n.sizeId,$(this).find(".rowQtySize").val()]),parseInt($(this).find(".rowQtySize").val())==0&&(r==tipologiaWishlistMain.wishlist&&c.push("wishlistSizeElement-"+n.rowId+"-"+n.sizeId),c.push($(this).attr("id"))))}),i.length==0&&(e=!1),t.size=JSON.stringify(i)),n=$(this).find("[name=nota-"+f+"]"),n.length>0&&($(n).attr("placeholdervalue")==null||$(n).attr("placeholdervalue")!=null&&$(n).attr("placeholdervalue")!=n.val())&&(t.note=$.trim(n.val())),n=$(this).find("[name=priorita-"+f+"]"),n.length>0&&(t.priority=$(n).val()),e&&l.push(t))});$.ajax({type:"POST",url:"/Async/WishList/UpdateWishList",data:{_articles:JSON.stringify(l)},dataType:"html",error:t.onAsyncError,success:function(t){if(t!=""&&$.jGrowl(t),v&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.minicart],tipologiaCart.wishlist),null,!0,null,null),r==tipologiaWishlistMain.wishlistcustom&&$("#"+h+" .ecFieldpriceComp").length>0&&$("#"+h+"_paging").length>0){var u={wishlist:n,changepage:!0},f=$("#"+h+"_paging").data("identifier");u["p"+f]=o.getElementValue("p"+f);e.refreshComponent($("#"+h+"_paging"),u,null,null)}for(i=0;i<c.length;i++)$("#"+c[i]).remove();s&&$("#wishlistDetailTable"+n).animate({opacity:.2},300,function(){$(this).animate({opacity:1},300)})}})},v.removeItem=function(n,i,r,u,f,o){n!=0&&$.ajax({type:"POST",url:"/Async/Cart/Remove",data:{_id:n,_tipologia:tipologiaCart.wishlist},error:t.onAsyncError,dataType:"json",success:function(n){n!=null&&(n.messaggio!=null&&n.messaggio!=""&&$.jGrowl(n.messaggio),r&&n.rimosso&&$(".cell_"+n.articolo).removeClass("inwishlist"));r&&e.collectListComponent(e.collectClassesComponent([tipologiaRefresh.minicart],tipologiaCart.wishlist),null,!0,null,null);i!=null&&v.viewWishlist(i,r,!1,!0,u,f,o)}})},v.viewWishlist=function(n,i,r,u,f,e,o){$.ajax({type:"POST",url:"/Async/WishList/GetWishList",data:{_wishlist:n,_current:i,_pageId:f,_componentId:e},dataType:"html",error:Site.global.onAsyncError,success:function(s){u?$("#"+o+"Comp-detail").html(s):($("#"+o+"Comp-detail").hide(),$("#"+o+"Comp-settings").hide(),$("#"+o+"Comp-share").hide(),$("#"+o+"Comp-detail").html(s),i&&$("#"+o+"Comp-settings").length>0&&v.editWishlist(n,i,r,f,e,o),r?$("."+o+"Comp-wishlistDetailTable").animate({opacity:.2},300,function(){$(this).animate({opacity:1},300)}):$("#"+o+"Comp-detail").show("blind",{},1e3),$("."+o+"Comp-wishlistDetailHead").length>0&&t.scrollTo($("."+o+"Comp-wishlistDetailHead").offset().top))}})},v.editWishlist=function(n,i,r,u,f,e){$.ajax({type:"POST",url:"/Async/WishList/EditWishList",data:{_wishlist:n,_current:i,_pageId:u,_componentId:f},dataType:"html",error:Site.global.onAsyncError,success:function(n){$("#"+e+"Comp-settings").hide();$("#"+e+"Comp-share").hide();$("#"+e+"Comp-settings").html(n);$("#wishlisttype_"+f).click();i?$("#"+e+"Comp-settings").show():($("#"+e+"Comp-detail").hide(),$("#"+e+"Comp-settings").show("blind",{},1e3));$("."+e+"Comp-wishlistSettingsHead").length>0&&t.scrollTo($("."+e+"Comp-wishlistSettingsHead").offset().top);v.bindFile();l.bindDates()}})},v.shareWishlist=function(n,i,r,u){$.ajax({type:"POST",url:"/Async/WishList/ShareWishList",data:{_wishlist:n,_pageId:i,_componentId:r},dataType:"html",error:Site.global.onAsyncError,success:function(n){$("#"+u+"Comp-share").hide();$("#"+u+"Comp-detail").hide();$("#"+u+"Comp-settings").hide();$("#"+u+"Comp-share").html(n);$("#"+u+"Comp-share").show("blind",{},1e3);$("."+u+"Comp-wishlistShareHead").length>0&&t.scrollTo($("."+u+"Comp-wishlistShareHead").offset().top)}})},v.removeWishlist=function(n,t){$.ajax({type:"POST",url:"/Async/WishList/RemoveWishList",data:{_wishlist:n},dataType:"html",error:Site.global.onAsyncError,success:function(n){Site.global.closeJgrowl();n==""?Site.updaters.refreshComponent($("#"+t),null,null,null):$.jGrowl(n)}})},v.cartWishlist=function(n,t,i,r){var f="#"+i+"-settings",e=!1,o="'"+t+"'";if($(f+" .formfield_error").hide(),$(f+" .requiredfield").each(function(){if($(this).is(":visible")&&$(this).val().trim()==""){e=!0;$("#"+$(this).attr("id")+"_error").show();var n=$(this).css("background-color");$(this).animate({backgroundColor:o},600,function(){$(this).animate({backgroundColor:n},600,function(){$(this).css({"background-color":""},600)})})}}),!e){var u=$("#wishlisttype_"+r).length>0,s=u?parseInt($("#wishlisttype_"+r).val()):0,h={id:$("#wishlistid_"+r).val(),name:$("#wishlistcart_"+r).val(),type:s,title:u?$("#wishlisttitle_"+r).val():"",hosts:u?$("#wishlisthosts_"+r).val():"",location:u?$("#wishlistlocation_"+r).val():"",description:u?$("#wishlistdescription_"+r).val():"",date:u?$("#wishlistdate_"+r).val():"",image:u?$("#wishlistimage_"+r).val():"",address:u&&$("#wishlistaddress_"+r).is(":visible")&&$("#wishlistaddress_"+r).val()!=null?$("#wishlistaddress_"+r).val():0};$.ajax({type:"POST",url:"/Async/WishList/SaveWishList",data:{_settings:JSON.stringify(h),_componentid:r},dataType:"html",error:Site.global.onAsyncError,success:function(n){n==""?Site.updaters.refreshComponent($("#"+i),null,null,null):$.jGrowl(n)}})}},v.sendWishlist=function(n,i,r,u){var f="#"+r+"-share",e=!1,o="'"+i+"'";$(f+" .sendresult").hide();$(f+" .formfield_error").hide();$(f+" .requiredfield").each(function(){if($(this).is(":visible")&&$(this).val().trim()==""){e=!0;$("#"+$(this).attr("id")+"_error").show();var n=$(this).css("background-color");$(this).animate({backgroundColor:o},600,function(){$(this).animate({backgroundColor:n},600,function(){$(this).css({"background-color":""},600)})})}});e||(t.addLoadingPanel($(f)),$.ajax({type:"POST",url:"/Async/WishList/SendWishList",data:{_address:$("#emailaddress_"+u).val(),_message:$("#emailmessage_"+u).val(),_wishlist:n},dataType:"json",error:function(n,i,r){t.removeLoadingPanel($(f));t.onAsyncError(n,i,r)},success:function(n){t.removeLoadingPanel($(f));n?$(f+" .sendcomplete").show():$(f+" .senderror").show()}}))},v.handleAction=function(){switch($(this).data("action")){case"removeItem":v.removeItem($(this).data("rowid"),$(this).data("identifier")!=undefined?$(this).data("identifier"):null,$(this).data("wl-current")!=undefined?$(this).data("wl-current"):!0,$(this).data("pageid")!=undefined?$(this).data("pageid"):null,$(this).data("componentid")!=undefined?$(this).data("componentid"):null,$(this).data("class")!=undefined?$(this).data("class"):null);break;case"addtowishlist":v.tryAddItem($(this).data("productid"),$(this).data("permalink"),$(this).data("collector"),$(this).data("identifiercontrol"),$(this).data("has-size"),$(this).data("has-structure"),$(this).data("parentid"),$(this).data("has-box"),$(this).data("boxid"),$(this).data("has-options"),$(this).data("has-mandatoryoptions"),$(this).data("redirect"),$(this).data("message"),$(this).data("timeoutmessage"));break;case"viewWishlist":v.viewWishlist($(this).data("wishlist"),$(this).data("wl-current"),$(this).data("wl-update"),!1,$(this).data("pageid"),$(this).data("identifier"),$(this).data("class"));break;case"editWishlist":v.editWishlist($(this).data("wishlist"),$(this).data("wl-current"),$(this).data("wl-update"),$(this).data("pageid"),$(this).data("identifier"),$(this).data("class"));break;case"shareWishlist":v.shareWishlist($(this).data("wishlist"),$(this).data("pageid"),$(this).data("identifier"),$(this).data("class"));break;case"removeWishlist":t.showConfirm(null,Site.wishlist.removeWishlist,$(this).data("wishlist"),$(this).data("class")+"_"+$(this).data("identifier"));break;case"cartWishlist":v.cartWishlist($(this).data("wishlist"),$(this).data("animation-color"),$($(this).parents(".wishlistComp-main").parent()).attr("id"),$(this).data("id"));break;case"sendWishlist":v.sendWishlist($(this).data("wishlist"),$(this).data("animation-color"),$($(this).parents(".wishlistComp-main").parent()).attr("id"),$(this).data("id"));break;case"emptyWishlist":Site.cart.empty(1,$(this).data("identifier")!=undefined?$(this).data("identifier"):null,$(this).data("wl-current")!=undefined?$(this).data("wl-current"):!0);break;case"updateRow":$(this).data("typeupdate")==0?$("#"+$(this).data("cart-identifier")).addClass("modified"):v.update($(this).data("cartid"),tipologiaWishlistMain.wishlistcustom,$("#"+$(this).data("rowid")),!1,$(this).data("cart-identifier"));break;case"updateWishlist":v.update($(this).data("identifier"),$(this).data("wl-custom"),null,!0,$(this).data("cart-identifier"));break;case"addWholeWishlist":Site.cart.addWholeWishlist($(this).data("identifier"),0,$(this).data("removeafteraddtocart"));break;case"addItemFromWishlist":Site.cart.addItemFromWishlist($(this).data("identifier"),$(this).data("rowid"),"wishlistitem_"+$(this).data("productid"),0);break;case"editImage":if(_isApp)try{window.PWBAppController&&(window.PWBAppController.onInputPicker($(this).closest(".wishlistimage").find("input[type='file']").data("id"),!0)||v.editImage(this))}catch(n){}else v.editImage(this);break;case"deleteImage":v.deleteImage(this,$(this).data("id"));break;case"downloadImage":v.downloadImage($(this).data("id"));break;case"changeType":v.changeType(this,$(this).data("id"))}},v.changeType=function(n,t){if($(n).val()==1)$("#giftoptions_"+t).slideUp();else{$("#giftoptions_"+t).slideDown();var i=$("#"+$(n).attr("id")+" option[value='"+$(n).val()+"']");$(i).data("shippingaddress")?$("#giftoptions_"+t+" .wishlistshippingaddress").show():$("#giftoptions_"+t+" .wishlistshippingaddress").hide()}},v.editImage=function(n){$(n).closest(".wishlistimage").find("input[type='file']").click()},v.deleteImage=function(n,i){$.ajax({type:"POST",url:"/Form/DeleteFile",data:{_id:i},dataType:"json",error:t.onAsyncError,success:function(t){if(t){var i=$(n).closest(".wishlistimage");$(i).find("input[type=file]").val("");$(i).find("input[type=hidden]").val("");$(i).find(".filedelete").hide();$(i).find(".filename").hide();$(i).find(".selectfile").show();$(i).find(".formfield_error").hide();$(i).find(".formfield_error").html("");$(i).find("img").attr("src","");$(i).find("img").hide()}}})},v.downloadImage=function(n){$.download("/Form/DownloadFile",{_id:n},"post",t.callbackDownload)},v.registerHandlers=function(){$(document).on("click",'.ecWishlistComp [data-action][data-action!="updateRow"], .ecWishlistCustomComp [data-action][data-action!="updateRow"], .ecFieldaddtowishlistComp [data-action], .ecMiniwishlistComp [data-action]',v.handleAction);$(document).on("change",'.ecWishlistCustomComp [data-action="updateRow"]',v.handleAction);$(document).on("click",".ecFieldaddtowishlistComp .dropdown-item",function(n){if(!$(n.target).is("input[type=checkbox]")){var t=$(this).find("input[type=checkbox]");if(t!=null)return $(t).prop("checked",!$(t).is(":checked")),!1}});$(document).on("click",".socialshare",function(){var n=screen.width-100,t=screen.height-100,i;n>530&&(n=530);t>400&&(t=400);i=screen.width/2-n/2;window.open($(this).data("href"),$(this).data("title"),"top=100,left="+i+",width="+n+",height="+t)});v.bindFile()},v.bindFile=function(){$('.wishlistimage input[type="file"]').each(function(){$(this).ajaxfileupload({params:{_id:$(this).data("id")},action:"/Async/Wishlist/UploadImage",validate_extensions:!1,onComplete:function(n){var t=$(this).closest(".wishlistimage");$(t).find(".filecontrol").removeClass("progressfile");$(t).find(".fileloading").hide();$(t).find("input[type=file]").val("");n.messaggio==""?($(t).find("input[type=hidden]").val(n.nomefile),$(t).find(".filename").text(n.nomefile),$(t).find(".filename").show(),$(t).find(".filedelete").show(),$(t).find(".selectfile").hide(),$(t).find(".formfield_error").hide(),$(t).find(".formfield_error").html(""),$(t).find("img").attr("src","/Async/Wishlist/PreviewImage/"+$(this).data("id")+"?"+Date.now()),$(t).find("img").show()):($(t).find(".formfield_error").html(n.messaggio),$(t).find(".formfield_error").show(),$(t).find(".selectfile").show(),$(t).find("img").attr("src",""),$(t).find("img").hide())},onStart:function(){var n=$(this).closest(".wishlistimage");$(n).find(".filecontrol").addClass("progressfile");$(n).find(".selectfile").hide();$(n).find(".fileloading").show()}})})},v.init=function(){$(".ecWishlistComp .inputqty, .ecWishlistCustomComp .inputqty").each(function(){$(this).limitkeypress({numberRexp:$(this).data("numberrexp")})});$(".ecWishlistComp .inputqtysize, .ecWishlistCustomComp .inputqtysize").each(function(){$(this).limitkeypress({numberRexp:1})})},t=function(){},t.name_cookiePrivacy="cookie-technical-agreed",t.selector_cookiePrivacyPopup="#cookiePrivacyPopup",t.delay_popup_cookiePrivacy=500,t.getParamsId=function(n){var t=/^([A-Za-z]+)_([0-9]+)([_A-Za-z]*)$/.exec(n);return t!=null?{htmlId:t[0],"class":t[1],id:t[2]}:null},t.getParamsIdentifier=function(n){var t=/^([A-Za-z]+)-([0-9]+)-(.*)$/.exec(n);return t!=null?{htmlId:t[0],"class":t[1],componentId:t[2],id:t[3]}:null},t.getParamsRow=function(n){var t=/^([A-Za-z]+)-([0-9]+)$/.exec(n);return t!=null?{identifierId:t[0],"class":t[1],id:t[2]}:null},t.LogoutCartCheck=function(n,i){var r={articoliInCart:!1,messaggio:null};$.ajax({type:"POST",url:"/Async/Cart/CheckArticlesInCart",data:{_areaRiservata:!1},dataType:"json",async:!1,error:t.onAsyncError,success:function(n){r=n}});r.articoliInCart&&r.messaggio!=null?t.showConfirm(r.messaggio,n,i):n(i)},t.checkBraintree=function(n){return new Promise(t=>{$("#"+n+"Comp-billing:visible input[name=billing]:radio:checked").closest("li").find(".divPaymentBraintree").length>0&&typeof braintree_dropininstance!="undefined"?braintree_dropininstance.requestPaymentMethod({threeDSecure:typeof braintree_threeDSecureParameters!="undefined"?braintree_threeDSecureParameters:null},function(n,i){if(n){console.error(n);return}t(i)}):t(null)})},t.toggleDetails=function(){$("."+$(this).data("identifier")).hasClass("dtls_close")?($("."+$(this).data("identifier-master")).each(function(n,t){$(t).hasClass("dtls_open")&&($(t).removeClass("dtls_open"),$(t).addClass("dtls_close"),$(t).hide())}),$("."+$(this).data("identifier")).removeClass("dtls_close"),$("."+$(this).data("identifier")).addClass("dtls_open"),$("."+$(this).data("identifier")).show()):($("."+$(this).data("identifier")).removeClass("dtls_open"),$("."+$(this).data("identifier")).addClass("dtls_close"),$("."+$(this).data("identifier")).hide())},t.enableAnimations=function(){$(".animated-component").each(function(){var t,n,i;$(this).closest(".sliderComp-section").length?_isResponsive&&$(this).removeClass("animated-component").addClass("animated-component-slider"):($(this).hide(),supportsTransitions()?(n=$(this).attr("data-animation"),$(this).hasClass("animated")||($(this).data("oldStyles",$(this).attr("style")),$(this).attr("style",$(this).attr("style")+" -webkit-backface-visibility: hidden; -webkit-animation-delay: "+$(this).attr("data-animation-delay")+"s; -webkit-animation-duration: "+$(this).attr("data-animation-duration")+"s; -webkit-animation-timing-function: ease; -webkit-animation-fill-mode: both; -moz-animation-delay: "+$(this).attr("data-animation-delay")+"s; -moz-animation-duration: "+$(this).attr("data-animation-duration")+"s; -moz-animation-timing-function: ease; -moz-animation-fill-mode: both; -ms-animation-delay: "+$(this).attr("data-animation-delay")+"s; -ms-animation-duration: "+$(this).attr("data-animation-duration")+"s; -ms-animation-timing-function: ease; -ms-animation-fill-mode: both; -o-animation-delay: "+$(this).attr("data-animation-delay")+"s; -o-animation-duration: "+$(this).attr("data-animation-duration")+"s; -o-animation-timing-function: ease; -o-animation-fill-mode: both; animation-delay: "+$(this).attr("data-animation-delay")+"s; animation-duration: "+$(this).attr("data-animation-duration")+"s; animation-timing-function: ease; animation-fill-mode: both;")),_isResponsive?(i=$(this).attr("data-animation-delay")*1e3+$(this).attr("data-animation-duration")*1e3,$(this).show().addClass(n+" animated").removeClass(n,i+10)):$(this).show().addClass(n+" animated")):(n=$(this).attr("data-animation"),$(this).hasClass("animated")||(t=this,window.setTimeout(function(){$(t).fadeIn(parseInt($(t).attr("data-animation-duration"))*1e3)},parseInt($(t).attr("data-animation-delay"))*1e3))))})},t.enablePopups=function(){try{if(_isResponsive){$(document).off("click",".modalPopup,.modalPage");$(document).on("click",".modalPopup,.modalPage",function(n){var u;n.preventDefault();$("#spinner-modal").remove();$("body").append('<div id="spinner-modal"><i class="fa fa-spinner fa-3x fa-pulse" aria-hidden="true"><\/i><\/div>');var t=$(this),i=t.hasClass("modalPopup")?"modalPopup":"modalPage",r=t.data("dlg");return r!=undefined&&r!=null&&$("[data-dlg-id='"+r+"']").remove(),u=$(this).attr("href").replace("/loadModal/",""),$.get($(this).attr("href"),function(n){var r=$(n);r.addClass(i+"_id");r.attr("data-dlg-id",i+"_id_"+u);t.attr("data-dlg",i+"_id_"+u);$("body").append(r);r.modal({keyboard:!1});try{e.bindRefreshComponent();y.init()}catch(f){}}).always(function(){$("#spinner-modal").remove()}),!1})}else $(".modalPopup").colorbox({fastIframe:!1,speed:500,onComplete:function(){$.colorbox.resize({width:$("#websiteContainerModal").width()+2})},fixed:!0}),$(".modalPage").colorbox({iframe:!0,transition:"none",width:"80%",height:"80%",fixed:!0})}catch(n){}},t.enableJsLoading=function(){var n=[];$(".jsloading").each(function(t,i){n.push(i)});n.sort(function(n,t){return+$(n).data("jsloadingpriority")-+$(t).data("jsloadingpriority")});e.refreshListComponent(n,null,0,!1,null)},t.enableDDSlick=function(){$(".ddslickcontrol").each(function(){$(this).ddslick({viewAsList:$(this).data("list")!=null,horizontalList:!0,onSelected:function(n){n.original.hasClass("ddslickfilter")?ct.ddslickSelection(n):n.original.hasClass("ddslicksize")&&nt.ddslickSelection(n)}})})},t.onError=function(){},t.onAsyncError=function(n){switch(n.status){case 500:$.jGrowl(n.responseText,{sticky:!0});break;case 401:if($("#popup_session_expired_passweb").length>0){var t=$("#popup_session_expired_passweb").html();$.jGrowl(t,{close:function(){window.location.reload()},group:"jGrowlSessione-notification container-fluid",position:"jGrowlSessione center"})}else window.location.reload()}},t.changeDevice=function(n){$.ajax({type:"POST",url:"/ChangeDevice",dataType:"json",data:{_device:n,_permalink:window.location.pathname},error:t.onAsyncError,success:function(n){n?window.location.reload():window.location.href="/"}})},t.showConfirm=function(n,i,r,u){$(document).off("click","#confirmDialogButtonOk");$(document).on("click","#confirmDialogButtonOk",function(){_isResponsive?$("#confirmDialog").modal("hide"):Site.global.closeJgrowl();i(r,u)});_isResponsive?(n!=null?($("#confirmDialog").find("#confirmDialogCustomizeMessage").html(n),$("#confirmDialog").find("#confirmDialogCustomizeMessage").show(),$("#confirmDialog").find("#confirmDialogDefaultMessage").hide()):($("#confirmDialog").find("#confirmDialogCustomizeMessage").hide(),$("#confirmDialog").find("#confirmDialogDefaultMessage").show()),$("#confirmDialog").modal("show")):$.ajax({type:"POST",url:"/GetConfirm",dataType:"json",error:t.onAsyncError,success:function(t){t!=null&&$.jGrowl("<span>"+(n!=null?n:t.message)+" <a href='#' id='confirmDialogButtonOk'>"+t.text_confirm+"<\/a> | <a href='javascript:Site.global.closeJgrowl()'>"+t.text_end+"<\/a><\/span>",{sticky:!0})}})},t.closeJgrowl=function(){$("div.jGrowl-notification").trigger("jGrowl.close")},t.trkPolling,t.setTrk=function(){t.cacheEnabled()||(t.trkPolling=setInterval(function(){$.ajax({url:"/ASync/pollTracker",type:"post"})},18e4))},t.unsetTrk=function(){clearInterval(t.trkPolling)},t.attachPrivacyCookie=function(){$("body").not(".privacy-sliding-popup-processed").addClass("privacy-sliding-popup-processed").each(function(){try{if(!t.cookiesEnabled())return!1;var n=t.getCurrentStatusCookiePrivacy();n==0?t.showPopupCookiePrivacy():t.disableCookiePreventiveBlock()}catch(i){return!1}})},t.showPopupCookiePrivacy=function(){var i;if($(t.selector_cookiePrivacyPopup).length>0){var n=$(t.selector_cookiePrivacyPopup),f=n.height(),r=n.data("position"),u={position:"relative"};u[r]=-1*f;i={};i[r]=0;n.fadeIn("slow").css(u).animate(i,t.delay_popup_cookiePrivacy).css({position:"fixed"});t.attachEventsCookiePrivacy()}},t.attachEventsCookiePrivacy=function(){$(document).on("click",".find-more-button",function(){$("#privacy_cookie_link_popup")[0].click()});$(document).on("click",".hide-popup-button",function(){t.changeStatusCookiePrivacy(1)})},t.changeStatusCookiePrivacy=function(n){var u=t.getCurrentStatusCookiePrivacy(),i,r;if(u===n)return!1;i=$(t.selector_cookiePrivacyPopup).data("position");r={};r[i]=$(t.selector_cookiePrivacyPopup).height()*-1;$(".sliding-popup-"+i).animate(r,t.delay_popup_cookiePrivacy,function(){u===0&&$(t.selector_cookiePrivacyPopup).remove()});$.cookie(t.name_cookiePrivacy,n,{expires:100,path:"/",Secure:""});t.disableCookiePreventiveBlock()},t.disableCookiePreventiveBlock=function(){$("script.passweb_ck_block:not(.passweb_ck_unblock)").each(function(){$(this).addClass("passweb_ck_unblock");$(this).attr("type","text/javascript");$(this).replaceWith($(this)[0].cloneNode(!0))});$("iframe.passweb_ck_block:not(.passweb_ck_unblock)").each(function(){$(this).addClass("passweb_ck_unblock");$(this).attr("src",$(this).attr("suppressedsrc")).removeAttr("suppressedsrc")})},t.cookiesEnabled=function(){var n=navigator.cookieEnabled;return typeof navigator.cookieEnabled!="undefined"||n||(document.cookie="testcookie",n=document.cookie.indexOf("testcookie")!==-1),n},t.cacheCheck=function(){$.ajax({type:"POST",url:"/Async/CacheCheck",dataType:"json",data:{_location:window.location.pathname},error:t.onAsyncError,success:function(n){for(i=0;i<n.length;i++){for(f=0;f<n[i].filtri.length;f++){var t=$("[id$='_"+n[i].filtri[f]+"']");t.length>0&&e.refreshComponent(t,null,null,null)}e.collectListComponent(e.collectClassesComponent(n[i].tipologia==0?[tipologiaRefresh.sitesearch]:n[i].tipologia==1?[tipologiaRefresh.cms]:[tipologiaRefresh.catalog],null),null,!1,null,null)}}})},t.cacheEnabled=function(){try{return _caching!=undefined&&_caching!=null&&_caching}catch(n){return!1}},t.httpMethodCache=function(){try{return"POST"}catch(n){return"POST"}},t.addTokenCacheUrl=function(){try{if(_chtkn!=undefined&&_chtkn!=null)$(document).on("click","a",function(){var n=$(this).attr("href");if(!/^https?:\/\//i.test(n)){var t="chtkn",i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),r=n.indexOf("?")!==-1?"&":"?";n=n.match(i)?n.replace(i,"$1"+t+"="+_chtkn+"$2"):n+r+t+"="+_chtkn}$(this).attr("href",n)})}catch(n){}},t.addTimeStampUrl=function(){try{}catch(n){}},t.getCurrentStatusCookiePrivacy=function(){return $.cookie(t.name_cookiePrivacy)?1:0},t.registerHandlers=function(){$(document).on("click",'[data-action="changeDevice"]',function(){t.changeDevice($(this).data("device"))})},t.initGoogleMaps=function(){$(".googlemapComp,.storelocatorComp,.ecCartComp,.ecCartCustomComp,.ecCheckoutComp,.ecCheckoutCustomComp").each(function(){try{window["initMap_"+t.getParamsId($(this).attr("id")).id]()}catch(n){}})},t.initGoogleRecaptcha=function(){$(".captchafieldComp").each(function(){try{window["captchafield_"+t.getParamsId($(this).attr("id")).id+"_Callback"]()}catch(n){}})},t.callbackDownload=function(){},t.removeTimer=[],t.addLoadingPanel=function(n,i){_isResponsive?(i==undefined&&(i=null),i!=null&&t.removeTimer[i]!=undefined&&t.removeTimer[i]!=null&&(clearTimeout(t.removeTimer[i]),t.removeTimer[i]=null),$(".componentLoadingDiv").length==0&&$(n).prepend("<div class='componentLoadingDiv'><\/div>")):$(n).prepend("<div class='componentLoadingDiv'><\/div>")},t.removeLoadingPanel=function(n,i){_isResponsive?(i==undefined&&(i=null),i!=null?(t.removeTimer[i]!=undefined&&t.removeTimer[i]!=null&&(clearTimeout(t.removeTimer[i]),t.removeTimer[i]=null),t.removeTimer[i]=setTimeout(function(n,t){$(n).children(".componentLoadingDiv").remove();Site.global.removeTimer[t]=null},1e3,n,i)):$(n).children(".componentLoadingDiv").remove()):$(n).children(".componentLoadingDiv").remove()},t.scrollTo=function(n){$([document.documentElement,document.body]).animate({scrollTop:n-100-($(".stickyContent").length>0&&$(".stickyContent").first()!=undefined?$($(".stickyContent").first()).outerHeight():0)},300)},ui=function(){},ui.registerHandlers=function(){$(".stickyContent").each(function(n,t){var r=$(t),u=r.data("pw-init"),f,i,e;(u==undefined||u==null||u=="")&&(u=!1);u||(r.data("pw-init",!0),f={},i=r.data("sticky-top"),i==undefined&&i==null&&(i=0),i>0&&(f.topSpacing=i),e=r.data("sticky-stop"),e!=undefined&&e!=null&&e!=""&&(f.stopper=e),f.stickyClass="pw-sticky",r.sticky(f))})},bt=function(){},bt.isCAP=function(n){var t,n;return n||(n=window.event),n.keyCode?t=n.keyCode:n.which&&(t=n.which),t==8||t==46||t==37||t==39?!0:t<48||t>57?!1:!0},bt.isExternalReference=function(n){var t,n;return(n||(n=window.event),n.keyCode?t=n.keyCode:n.which&&(t=n.which),t>=48&&t<=57)?!0:t>=65&&t<=90?!0:t>=97&&t<=122?!0:t==47||t==45||t==95||t==46?!0:t!=8&&t!=9&&t!=13&&t!=37&&t!=39&&t!=46?!1:t==37&&n.shiftKey?!1:!0},bt.closestToOffset=function(n,t){if(t.length==1)return $(t[0]);var r=null,i,u=n.left,f=n.top,e,o,s,h;return t.each(function(){if(i=$(this).offset(),u>=i.left&&u<=i.right&&f>=i.top&&f<=i.bottom)return r=$(this),!1;var n=[[i.left,i.top],[i.right,i.top],[i.left,i.bottom],[i.right,i.bottom]];for(off in n)o=n[off][0]-u,s=n[off][1]-f,e=Math.sqrt(o*o+s*s),(h===undefined||e<h)&&(h=e,r=$(this))}),r},kt=function(){},kt.register=function(){_isResponsive&&$(".resCarousel").not(".initexecuted").length>0&&window.ResCarouselOnInit!=undefined&&window.ResCarouselOnInit()},kt.loadAll=function(n,t){n.stopImmediatePropagation();n.stopPropagation();n.preventDefault();var i=$("#"+$(t).data("loadall")),r=$(t).data("loadall")+"_carousel",u=$(t).hasClass("leftRs")?-1:1;window.__carouselState[r]=u;e.refreshComponent(i,null,null,null)},kt.onSlideListener=function(n){var t=$(n.currentTarget);t.carousel("pause")},PwCollapse=function(){},PwCollapse.register=function(){$(".pw-collapse").off("shown.bs.collapse");$(".pw-collapse").on("shown.bs.collapse",function(n){$(this).children(".pw-collapse-button").data("target")=="#"+$(n.target).attr("id")&&$(this).addClass("pw-collapsed")});$(".pw-collapse").off("hidden.bs.collapse");$(".pw-collapse").on("hidden.bs.collapse",function(n){$(this).children(".pw-collapse-button").data("target")=="#"+$(n.target).attr("id")&&$(this).removeClass("pw-collapsed")})},e=function(){},e.refreshComponent=function(n,i,r,u){var l;$(n).hasClass("sliderautoplay")||t.addLoadingPanel(r!=null?$(r):n);var c=t.getParamsId($("body").attr("id")),s=t.getParamsId($(n).attr("id")),f={_pageId:c.id,_pageType:c.class,_componentId:s.id},h=$("#"+s.htmlId+"_carousel").data("reqrow");h==undefined||h==null||isNaN(h)||(f._requestedrows=parseInt(h,10));i!=null&&(f=$.extend(f,i));_permalinkProduct!=null&&(f._permalink=_permalinkProduct);_permalinkCms!=null&&(f._permalinkCms=_permalinkCms);$(n).hasClass("searchcmsrelatedproducts")&&(f.cmsNewsdetailCollector=!0);l=t.httpMethodCache(n);$.ajax({type:l,url:"/Async/RefreshComponent",data:f,dataType:"json",async:!_isReact,error:function(u,f,e){t.removeLoadingPanel(r!=null?$(r):n);i.showMore&&i.showMore>0&&$("[id="+$(n).attr("id")+"] .showmorecells").removeClass("paginationprogress");t.onAsyncError(u,f,e)},success:function(f){var h,c;if(f.returnedCode=="success"){h=$(window).scrollTop();_isReact?$.fn.__FindReactComponent($(n)).refreshComponent(!0):(c=r!=null?r:i!=null&&i.showMore&&i.showMore>0?"[id="+$(n).attr("id")+"] .showmorecells":"[id="+$(n).attr("id")+"]",$(c).each(function(){if(i!=null&&i.showMore&&i.showMore>0){var u=o.getIdentifier(n,s.id);$(this).append(f.data);$(this).removeClass("paginationprogress");$(this).data("numberpageshowmore",i["p"+u]);t.removeLoadingPanel(r!=null?$(r):n)}else $(this).replaceWith(f.data)}),e.bindRefreshComponent());try{i.showMore&&$(window).scrollTop(h)}catch(l){}u&&typeof u=="function"&&u();e.refreshComponentEndCallback&&$.isFunction(e.refreshComponentEndCallback)&&e.refreshComponentEndCallback(s.htmlId)}else t.removeLoadingPanel(r!=null?r:"#"+s.htmlId)}})},e.refreshListComponent=function(n,i,r,u,f){var o=n[r],c=t.getParamsId($("body").attr("id")),s=t.getParamsId($(o).attr("id")),h,l;s!=null?(h={_pageId:c.id,_pageType:c.class,_componentId:s.id},i!=null&&(h=$.extend(h,i)),_permalinkProduct!=null&&(h._permalink=_permalinkProduct),_permalinkCms!=null&&(h._permalinkCms=_permalinkCms),$(o).hasClass("searchcmsrelatedproducts")&&(h.cmsNewsdetailCollector=!0),t.addLoadingPanel(o),l=t.httpMethodCache(o),$.ajax({type:l,url:"/Async/RefreshComponent"+window.location.search,data:h,dataType:"json",error:function(n,i,r){t.removeLoadingPanel("#"+s.htmlId);t.onAsyncError(n,i,r)},success:function(h){var a,c,l;_isReact?$.fn.__FindReactComponent($(o)).refreshComponent(!0):h.location!=null?window.location=h.location:($(o).hasClass("ecCatalogsearchandfilterComp")&&Site.fieldfilter.bindFieldFilter(),i!=null&&i.lazy!=null&&$(o).hasClass("cmsNewsdetailComp")&&$(o).find(".cmsFieldarticleComp").length>0?($(h.data).appendTo(o),t.removeLoadingPanel("#"+s.htmlId)):(a=!1,$(o).hasClass("ecGiftselectionComp")&&!$(o).is(":visible")&&(a=!0),$(o).replaceWith(h.data),a&&$("#"+s.htmlId).is(":visible")&&t.scrollTo($("#"+s.htmlId).offset().top)));u&&($(o).is('[class^="ecMini"]')?(c=$("#"+s.htmlId).css("background-color"),(c==""||c==null)&&(c="#ffffff"),l=$("#"+s.htmlId).children("form").children("input.animationColor").val(),(l==""||l==null)&&(l="#ff0000"),$("#"+s.htmlId).animate({backgroundColor:l},600,function(){$("#"+s.htmlId).animate({backgroundColor:c},150,function(){$("#"+s.htmlId).css({"background-color":c},600)})})):($(o).is('[class^="ecCart"]')||$(o).is('[class^="ecWishlist"]')||$(o).is('[class^="ecAcomparator"]'))&&$("#"+s.htmlId+" .detailTable").animate({opacity:.2},300,function(){$(this).animate({opacity:1},300)}));e.refreshComponentEndCallback&&$.isFunction(e.refreshComponentEndCallback)&&e.refreshComponentEndCallback(s.htmlId);e.refreshNextComponent(n,i,r,u,f)}})):e.refreshNextComponent(n,i,r,u,f)},e.refreshNextComponent=function(n,t,i,r,u){i++;i<n.length?e.refreshListComponent(n,t,i,r,u):(e.bindRefreshComponent(),u&&typeof u=="function"&&u())},e.collectListComponent=function(n,t,i,r,u){var f=!1,o=[];for(c=0;c<n.length;c++)!f&&e.isClassToRefreshInApp(n[c])&&(f=!0),$("."+n[c]).each(function(){(u==null||$.inArray($(this).attr("id"),u)==-1)&&o.push(this)});try{f&&window.PWBAppController&&window.PWBAppController.refreshApp()}catch(s){}o.length>0?e.refreshListComponent(o,t,0,i,r):r&&typeof r=="function"&&r()},e.isClassToRefreshInApp=function(n){if(!_isApp)return!1;switch(n){case"ecCartComp":case"ecCartCustomComp":case"ecWishlistComp":case"ecWishlistCustomComp":case"ecAcomparatorComp":case"ecMinicartComp":case"ecMiniwishlistComp":case"ecMinicomparatorComp":return!0}return!1},e.collectClassesComponent=function(n,t){var i=[];for(c=0;c<n.length;c++)switch(n[c]){case tipologiaRefresh.catalog:i=i.concat(["ecCatalogComp","ecCatalogsearchresultsboxComp","cmsRelatedproductsComp"]);break;case tipologiaRefresh.cart:switch(t){case tipologiaCart.cart:i=i.concat(["ecCartComp","ecCartCustomComp"]);break;case tipologiaCart.wishlist:i=i.concat(["ecWishlistComp","ecWishlistCustomComp"]);break;case tipologiaCart.comparator:i=i.concat(["ecAcomparatorComp"])}break;case tipologiaRefresh.minicart:switch(t){case tipologiaCart.cart:i=i.concat(["ecMinicartComp"]);break;case tipologiaCart.wishlist:i=i.concat(["ecMiniwishlistComp"]);break;case tipologiaCart.comparator:i=i.concat(["ecMinicomparatorComp"])}break;case tipologiaRefresh.popularity:i=i.concat(["purchasedtogether"]);break;case tipologiaRefresh.orders:i=i.concat(["ecOrdersComp"]);break;case tipologiaRefresh.checkout:i=i.concat(["ecCheckoutComp","ecCheckoutCustomComp"]);break;case tipologiaRefresh.cms:i=i.concat(["cmsNewsarchiveComp","cmsSearchandfilterComp","cmsTimeperiodsmenuComp","cmsCalendarComp","searchandfilterresultsComp"]);break;case tipologiaRefresh.cmsdetail:i=i.concat(["cmsNewsdetailComp:not(.nojsrefresh)","cmsBookComp:not(.nojsrefresh)","cmsRelatedcontentComp:not(.nojsrefresh)"]);break;case tipologiaRefresh.giftselection:i=i.concat(["ecGiftselectionComp"]);break;case tipologiaRefresh.checkoutOnePage:i=i.concat(["userloginComp","userbarComp","ecMinicartComp"]);break;case tipologiaRefresh.sitesearch:i=i.concat(["searchandfilterresultsComp","searchandfilterComp"]);break;case tipologiaRefresh.catalogsearch:i=i.concat(["ecCatalogsearchandfilterComp"])}return i},e.refreshComponentEndCallback=function(){},e.bindRefreshComponent=function(){t.enableAnimations();t.enableDDSlick();ti.init();nt.init();ut.init();u.init();d.init();r.init();ct.bindFieldFilter();l.bindControls();rt.init();lt.init();et.init();tt.init();y.init();v.init();TrackerPW.TP.init();kt.register();PwCollapse.register();PWLightBox.reload();wt.timeout!=null&&(clearTimeout(wt.timeout),wt.timeout=null);wt.init(!1);ui.registerHandlers();fi.init()},it=function(){},it.manageShowWhen=function(n){var t=$(window).scrollTop(),i=n.data("showwhen"),r;if(i==undefined||i==null){if(i=n.data("showwhenselector"),r=$(i).first(),r.length==1&&r.offset()!=undefined){var u=r.offset().top,e=u+r.outerHeight(),f=t,o=f+$(window).height();if(e>f&&u<o){console.log(i+"-> "+e.toString()+" > "+f.toString()+" && "+u.toString()+" < "+o.toString());it.showPopup(n);return}}n.attr("data-onscroll",!0)}else switch(i){case"Middle":if(t+=$(window).height()/2,t>$(document).height()/2){console.log("Middle-> "+t.toString()+" > "+($(document).height()/2).toString());it.showPopup(n);return}n.attr("data-onscroll",!0);break;case"Bottom":if(t+=$(window).height(),t>$(document).height()-100){console.log("Bottom-> "+t.toString()+" > "+($(document).height()-100).toString());it.showPopup(n);return}n.attr("data-onscroll",!0);break;case"BeforeExit":n.attr("data-onexit",!0)}},it.showPopup=function(n){if(n.closest(".popupComp").is(":visible")){var t=n.data("showdelay");t>0?setTimeout(function(){it.setCookie(n);n.click()},t):(it.setCookie(n),n.click())}},it.setCookie=function(n){if(n.data("cookie")){var i=n.data("cookieexpire"),t=n.data("cookiename");if($.cookie(t))return;$.cookie(t,!0,{expires:i,path:"/",Secure:""});n.closest(".popupComp").attr("popup-set",!0)}},it.init=function(){var n=!1,t=!1;if($(".popupComp .popupComp-Auto").each(function(i,r){var u=$(r),o,e,f;if(!u.data("cookie")||(o=u.data("cookieexpire"),e=u.data("cookiename"),!$.cookie(e))){if(f=u.data("showwhen"),f==undefined||f==null){if(f=u.data("showwhenselector"),!(f==undefined||f==null)){n=!0;it.manageShowWhen(u);return}}else if(f!="Top"){if(f=="BeforeExit"){t=!0;it.manageShowWhen(u);return}n=!0;it.manageShowWhen(u);return}u.closest(".popupComp").children(".popupComp-Dialog").on("hidden.bs.modal",function(){$(this).closest(".popupComp").removeAttr("popup-set")});it.showPopup(u)}}),$(".popupComp .videoComp").each(function(n,t){$(t).closest(".modal").on("hidden.bs.modal",function(){var n=$(this).find(".videoComp iframe").get(0);n.src=n.src})}),$(window).off("scroll",Site.pwpopup.onScroll),n)$(window).on("scroll",Site.pwpopup.onScroll);if($(window).off("beforeunload",Site.pwpopup.onExit),t)$(window).on("beforeunload",Site.pwpopup.onExit)},it.onScroll=function(){$(".popupComp-Auto[data-onscroll]").each(function(n,t){$(t).removeAttr("data-onscroll");it.manageShowWhen($(t))})},it.onExit=function(){var n=$(".popupComp-Auto[data-onexit]").length>0;return n&&it.showPopup($(".popupComp-Auto[data-onexit]").first()),n},fi=function(){},fi.init=function(){if(_isResponsive&&!("ontouchstart"in document.documentElement)){$('[data-toggle="tooltip"]').tooltip();$(".clipboard").on("hidden.bs.tooltip",function(){$(".clipboard").attr("data-original-title","Copy")})}},gt=function(){},gt.copy=function(n,t){var i=$("<input>");$("body").append(i);i.val(n).select();document.execCommand("copy");i.remove();t!=null&&$(t).attr("data-original-title","Clipboard: "+n).tooltip("show")},ni=function(){},ni.init=function(){if(_isResponsive){var n=o.getQueryStringParams(location.search);if(n.pwbcache!=null&&(JSON.parse(n.pwbcache)?sessionStorage.setItem("buttonmarkcache",!0):sessionStorage.setItem("buttonmarkcache",!1)),sessionStorage.getItem("buttonmarkcache")!=null&&JSON.parse(sessionStorage.getItem("buttonmarkcache"))){$("body").append('<button type="button" class="btn markcache" data-toggle="tooltip" title="Cache"><\/button>');ni.mark(!0);$(document).on("click",".markcache",function(){sessionStorage.setItem("markcache",sessionStorage.getItem("markcache")!=null?!JSON.parse(sessionStorage.getItem("markcache")):!0);ni.mark(!1)})}}},ni.mark=function(n){sessionStorage.getItem("markcache")!=null&&JSON.parse(sessionStorage.getItem("markcache"))?($("[data-cache]").addClass("cacheelement"),$(".markcache").addClass("active")):n||($("[data-cache]").removeClass("cacheelement"),$(".markcache").removeClass("active"))},li=function(){},li.init=function(){$(document).on("click",".sw-notification-close",function(){return $(this).closest(".sw-notification").slideUp("slow",function(){$(this).remove()}),!1});$(document).on("click",".sw-notification-open",function(){var n={idcontent:$(this).closest(".sw-notification").data("content-id"),token:localStorage.getItem("fbtoken")};return $.ajax({type:"POST",url:"pwbappapi/topicread",data:n,dataType:"json",contentType:"application/x-www-form-urlencoded",error:function(){},success:function(){}}),$(this).closest(".sw-notification").find(".sw-notification-close").first().click(),!0})},{accordion:ti,tabs:tt,pwSticky:ui,rss:si,addressbook:b,product:a,catalog:d,cart:u,currencychange:oi,wishlist:v,comparator:vt,rma:ht,checkout:r,orders:et,reservation:k,user:y,cms:p,fieldaddtocart:nt,fieldcomments:ut,fieldavatar:at,fieldfile:ot,fieldfilter:ct,fieldrating:rt,fieldcommentvote:ri,fieldnotificationoutstock:ft,search:pt,slider:wt,global:t,misc:bt,pagination:o,updaters:e,forms:l,imagegallery:lt,menu:w,horeca:h,pwlightbox:PWLightBox,pwpopup:it,pwcarousel:kt,setoptions:st,giftcard:g,PWT:TrackerPW.TP,startUpEnv:function(){o.registerHandlers();o.check();t.enableAnimations();t.enablePopups();t.enableJsLoading();t.registerHandlers();t.attachPrivacyCookie();t.addTokenCacheUrl();t.enableDDSlick();ui.registerHandlers();ti.init();b.registerHandlers();hi.registerHandlers();u.init();u.registerHandlers();d.init();d.registerHandlers();r.init();r.registerHandlers();p.init();p.registerHandlers();vt.registerHandlers();oi.registerHandlers();nt.init();nt.registerHandlers();at.registerHandlers();ot.registerHandlers();ut.init();ut.registerHandlers();ri.registerHandlers();ct.init();ct.registerHandlers();ft.init();ft.registerHandlers();rt.init();rt.registerHandlers();l.init();l.registerHandlers();l.bindControls();h.init();lt.init();w.registerHandlers();et.init();et.registerHandlers();a.init();a.registerHandlers();k.registerHandlers();k.init();ht.init();ht.registerHandlers();si.init();pt.registerHandlers();tt.init();y.init();y.registerHandlers();v.init();v.registerHandlers();TrackerPW.TP.registerHandlers();TrackerPW.TP.init();kt.register();PWLightBox.init();PwCollapse.register();u.initAutoComplete();li.init();wt.init(!0);it.init();fi.init();st.init();g.registerHandlers();yt.registerHandlers();ni.init()}}}();window.addEventListener("load",Site.global.setTrk);window.addEventListener("beforeunload",Site.global.unsetTrk);$(document).ready(function(){Site.startUpEnv()});$(document).on("click",function(n){$(".jGrowl-notification").is(n.target)||$(".jGrowl-notification").has(n.target).length!==0||$(n.target).hasClass("addtocart")||$(n.target).hasClass("addtowishlist")||$(n.target).hasClass("addtocomparator")||Site.global.closeJgrowl()})